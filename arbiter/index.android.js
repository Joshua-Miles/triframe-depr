module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=22)}([function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t){e.exports=require("triframe/core")},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){var r=n(23),o=n(8);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?o(e):t}},function(e,t,n){var r=n(12);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t,n){var r=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.updateResource=t.createCache=t.upstreamMerge=t.rollbackPatches=t.mergeBatch=t.createBatch=t.mergePatches=t.stageNewPatches=t.unstageLatentMutations=t.stageLatentMutations=t.initializeResource=void 0;var o=r(n(16)),a=r(n(19)),i=r(n(11)),u=n(29),c=n(2),s=n(32);t.initializeResource=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.defineProperty(e,"[[attributes]]",{writable:!0,enumerable:!1,value:n}),Object.defineProperty(e,"[[base]]",{writable:!0,enumerable:!1,value:u.jsonpatch.deepClone(n)}),Object.defineProperty(e,"[[patches]]",{writable:!0,enumerable:!1,value:[]}),Object.defineProperty(e,"[[batch]]",{writable:!0,enumerable:!1,value:1}),Object.defineProperty(e,"[[syncRate]]",{writable:!0,enumerable:!1,value:0}),Object.defineProperty(e,"toJSON",{value:function(){return this["[[attributes]]"]}}),v(e,n),e.on("Δ.change",(function(){t&&clearTimeout(t),t=setTimeout((function(){e.uid&&e.emit("Δ.sync",new s.SyncEvent({resource:e}))}),e["[[syncRate]]"])})),e.on("Δ.sync",(function(t){var n=t.socket,r=t.patches,o=t.batchId;t.resource;y[e.uid]&&y[e.uid].forEach((function(e){var t=e.socket,o=e.resource;if(n!=t)try{p(o,r),t.emit(o.uid+".mergePatches",r)}catch(e){}})),n&&n.emit(e.uid+".mergeBatch",o)})),f[e.uid]&&u.jsonpatch.applyPatch(n,f[e.uid])};var f={};t.stageLatentMutations=function(e,t){var n;f[e.uid]=f[e.uid]||[],(n=f[e.uid]).push.apply(n,(0,i.default)(t))};t.unstageLatentMutations=function(e,t){f[e.uid]=f[e.uid].filter((function(e){return!t.includes(e)}))};t.stageNewPatches=function(e){if(!e["[[patches]]"])return[];var t=[];return e["[[patches]]"].forEach((function(n){var r=!n.staged;n.batchId||(n.batchId=e["[[batch]]"]),r&&(n.staged=!0,t.push(n))})),t};var p=function(e,t){return e["[[patches]]"]=u.JSONPatchOT.transform(e["[[patches]]"],t),d(e,t)};t.mergePatches=p;t.createBatch=function(e){return e["[[batch]]"]++};t.mergeBatch=function(e,t){var n=e["[[patches]]"].filter((function(e){return e.batchId===t}));return e["[[patches]]"]=e["[[patches]]"].filter((function(e){return e.batchId!==t})),d(e,n)};t.rollbackPatches=function(e,t){var n=JSON.stringify(t);e["[[patches]]"]=e["[[patches]]"].filter((function(e){return!n.includes(JSON.stringify(e))}));var r=u.jsonpatch.deepClone(e["[[base]]"]);u.jsonpatch.applyPatch(r,e["[[patches]]"]),e["[[attributes]]"]=r,v(e,r)};var l=function(e,t){var n;return e&&e["[[patches]]"]?(u.jsonpatch.applyPatch(e["[[attributes]]"],t),(n=e["[[patches]]"]).push.apply(n,(0,i.default)(t)),t):[]},d=function(e,t){u.jsonpatch.applyPatch(e["[[base]]"],t);var n=u.jsonpatch.deepClone(e["[[base]]"]);return u.jsonpatch.applyPatch(n,e["[[patches]]"]),e["[[attributes]]"]=n,v(e,n),e.emit("Δ.rebase",e["[[base]]"]),t},h=function(e,t){var n=u.jsonpatch.deepMerge(e["[[attributes]]"],t["[[attributes]]"]),r=u.jsonpatch.deepMerge(e["[[base]]"],t["[[base]]"]);u.jsonpatch.applyPatch(n,e["[[patches]]"]),e["[[base]]"]=r,e["[[attributes]]"]=n,v(e,n),e.emit("Δ.rebase",e["[[base]]"])};t.upstreamMerge=h;var v=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,c.each)(t,(function(t,r){r&&r.on&&(r.on("Δ.rebase",(function(r){var o=e["[[base]]"];!1!==n&&(o=o[n]),o[t]=r})),r.on("Δ.change",(function(n){var r,o=n.map((function(e){return{op:e.op,path:"/"+t+e.path,value:e.value}}));(r=e["[[patches]]"]).push.apply(r,(0,i.default)(o)),e.emit("Δ.change",o)})))}))},y={};t.createCache=function(e){var t={},n=e.session;return{cache:function(r){t[r.uid]?h(t[r.uid],r):(y[r.uid]=y[r.uid]||[],y[r.uid].push({resource:r,socket:e}),t[r.uid]=r,e.on(r.uid+".sync",(function(t,o){var i,u,c,f,p;return a.default.async((function(l){for(;;)switch(l.prev=l.next){case 0:return i=t.batchId,u=t.patches,t.attributes,l.next=3,a.default.awrap(b(r,u,n));case 3:c=l.sent,f=c.updateSuccessful,p=c.invalidPatches,o({updateSuccessful:f,invalidPatches:p}),r.emit("Δ.sync",new s.SyncEvent({resource:r,batchId:i,socket:e}));case 8:case"end":return l.stop()}}))})))},getCached:function(e){return a.default.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t[e]);case 1:case"end":return n.stop()}}))}}};var b=function(e,t,n){var r,i,u;return a.default.async((function(s){for(;;)switch(s.prev=s.next){case 0:return r=[],i=[],s.next=4,a.default.awrap((0,c.eachAsync)(t,(function(t,u){var s,f,p,l,d;return a.default.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=u.path.split("/").slice(1),f=(0,o.default)(s,1),p=f[0],l=(0,c.getMetadata)(e,p),d=l.writeAccessTest,l.namespace,void 0!==d){t.next=6;break}r.push(u),t.next=10;break;case 6:return t.next=8,a.default.awrap(d.call(e,{session:n,resource:e}));case 8:t.sent?r.push(u):i.push(u);case 10:case"end":return t.stop()}}))})));case 4:return l(e,r),u=r.length===t.length,s.abrupt("return",{updateSuccessful:u,validPatches:r,invalidPatches:i});case 7:case"end":return s.stop()}}))};t.updateResource=b},function(e,t,n){var r=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.Resource=void 0;var o,a=r(n(15)),i=r(n(3)),u=r(n(4)),c=r(n(8)),s=r(n(9)),f=r(n(5)),p=r(n(1)),l=r(n(13)),d=r(n(10)),h=n(2),v=n(6),y=Symbol(),b=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.default)(this,t),e=(0,u.default)(this,(0,p.default)(t).call(this)),(0,v.initializeResource)((0,c.default)(e),n),e}return(0,f.default)(t,e),(0,s.default)(t,[{key:"emit",value:function(e){for(var n,r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return this[y]&&"Δ.change"==e?null:(n=(0,l.default)((0,p.default)(t.prototype),"emit",this)).call.apply(n,[this,e].concat(o))}},{key:"startBatchUpdate",value:function(){this[y]=!0}},{key:"commitBatchUpdate",value:function(){this[y]=!1,this.emit("Δ.change")}}],[{key:"on",value:function(e,t){var n=this;return e=Array.isArray(e)?e.map((function(e){return n.name+"."+e})):this.name+"."+e,this.events.on(e,t)}},{key:"emit",value:function(e){var t;console.log("Emitting: "+this.name+"."+e);for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return(t=this.events).emit.apply(t,[this.name+"."+e].concat(r))}},{key:"nowAndOn",value:function(e,t){var n=this;return e=Array.isArray(e)?e.map((function(e){return n.name+"."+e})):this.name+"."+e,this.events.nowAndOn(e,t)}}]),(0,s.default)(t,[{key:"set",value:function(e){var t,n=[];(0,h.each)(e,(function(e,t){var r={op:"replace",path:"/"+e,value:t};n.push(r)})),this.emit("Δ.change",n),(t=this["[[patches]]"]).push.apply(t,n),(0,a.default)(this["[[attributes]]"],e)}},{key:"uid",get:function(){return void 0!==this.id?this.constructor.name+"."+this.id:null}},{key:"validation",get:function(){return this["[[validation]]"].for(this)}}]),t}(h.EventEmitter);t.Resource=b,(0,d.default)(b,"events",new h.EventEmitter),Object.defineProperty(b.prototype,"[[validation]]",{writable:!0,enumerable:!1,value:(o={},{handlers:o,for:function(e){e["[[validationState]]"]||Object.defineProperty(e,"[[validationState]]",{enumerable:!1,value:{}});var t=e["[[validationState]]"],n=function(e){return r(e).length>0},r=function(t){var n=o[t];if(void 0!==n){var r=e[t],a=[],i=(0,h.toTitleCase)(t);return n.forEach((function(t){return t.call(e,{property:r,label:i,errors:a,resource:e})})),a}return[]},a={addHandler:function(e,t){o[e]=o[e]||[],o[e].push(t)},errorMessageFor:function(e){var t=r(e);if(0===t.length)return" ";if(1===t.length)return(0,h.toTitleCase)(e)+" "+t[0];var n=t.pop();return(0,h.toTitleCase)(e)+" "+t.join(", ")+" and "+n},shouldShowErrorsFor:function(e){return!0===t[e]&&n(e)},showErrorsFor:function(n){t[n]=!0,e.emit("Δ.change")},hideErrorsFor:function(e){t[e]=!1},showAllErrors:function(){(0,h.each)(o,(function(e){t[e]=!0})),e.emit("Δ.change")},hideAllErrors:function(){(0,h.each)(o,(function(e){t[e]=!1})),e.emit("Δ.change")},get isInvalid(){var e=!1;return(0,h.each)(o,(function(t){e=e||n(t)})),e},get isValid(){return!a.isInvalid}};return a}})})},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){var r=n(27),o=n(20),a=n(28);e.exports=function(e){return r(e)||o(e)||a()}},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t,n){var r=n(24);function o(t,n,a){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=o=Reflect.get:e.exports=o=function(e,t,n){var o=r(e,t);if(o){var a=Object.getOwnPropertyDescriptor(o,t);return a.get?a.get.call(n):a.value}},o(t,n,a||t)}e.exports=o},function(e,t,n){var r=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.List=void 0;var o=r(n(11)),a=r(n(3)),i=r(n(9)),u=r(n(4)),c=r(n(8)),s=r(n(1)),f=r(n(13)),p=r(n(5)),l=r(n(30)),d=n(2),h=function(e){function t(){var e,n;(0,a.default)(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=(0,u.default)(this,(e=(0,s.default)(t)).call.apply(e,[this].concat(o))),Object.defineProperty((0,c.default)(n),"[[patches]]",{enumerable:!1,value:[]}),Object.defineProperty((0,c.default)(n),"[[events]]",{enumerable:!1,value:new d.EventEmitter}),n}return(0,p.default)(t,e),(0,i.default)(t,[{key:"on",value:function(){var e;return(e=this["[[events]]"]).on.apply(e,arguments)}},{key:"emit",value:function(){var e;return(e=this["[[events]]"]).emit.apply(e,arguments)}},{key:"push",value:function(){for(var e,n,r=this.length,a=arguments.length,i=new Array(a),u=0;u<a;u++)i[u]=arguments[u];var c=i.map((function(e){return{op:"add",path:"/"+r++,value:e}}));(e=this["[[patches]]"]).push.apply(e,(0,o.default)(c)),this.emit("Δ.change",c),(n=(0,f.default)((0,s.default)(t.prototype),"push",this)).call.apply(n,[this].concat(i))}},{key:"_splice",value:function(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=(0,f.default)((0,s.default)(t.prototype),"splice",this)).call.apply(e,[this].concat(r))}},{key:"splice",value:function(e,n){for(var r,a,i=arguments.length,u=new Array(i>2?i-2:0),c=2;c<i;c++)u[c-2]=arguments[c];(r=(0,f.default)((0,s.default)(t.prototype),"splice",this)).call.apply(r,[this,e,n].concat(u));for(var p=Math.min(n+e,u.length+e),l=[],d=e;d<p;d++)l.push({op:"replace",path:"/"+d,value:u[d-e]});for(var h=[],v=p;v<e+n;v++)h.push({op:"remove",path:"/"+v});for(var y=[],b=p;b<e+u.length;b++)h.push({op:"add",path:"/"+b,value:u[b-e]});var m=[].concat(l,h,y);(a=this["[[patches]]"]).push.apply(a,(0,o.default)(m)),this.emit("Δ.change",m)}},{key:"insert",value:function(e,n){(0,f.default)((0,s.default)(t.prototype),"splice",this).call(this,n,0,e);var r={op:"add",path:"/"+n,value:e};this["[[patches]]"].push(r),this.emit("Δ.change",[r])}},{key:"replace",value:function(e,t){this[e]=t;var n={op:"replace",path:"/"+e,value:t};this["[[patches]]"].push(n),this.emit("Δ.change",[n])}},{key:"map$",value:function(e){var t,n=this,r=[];this.forEach((function(t,o){var a=e(t,o);if(a!=t){n[o]=a;var i={op:"replace",path:"/"+o,value:a};r.push(i)}})),(t=this["[[patches]]"]).push.apply(t,r),this.emit("Δ.change",r)}},{key:"remove",value:function(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==r&&(r=e),(0,f.default)((0,s.default)(t.prototype),"splice",this).call(this,e,1+r-e);for(var o=[],a=e;a<=r;a++)o.push({op:"remove",path:"/"+e});(n=this["[[patches]]"]).push.apply(n,o),this.emit("Δ.change",o)}}]),t}((0,l.default)(Array));t.List=h},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}e.exports=n},function(e,t,n){var r=n(17),o=n(25),a=n(18);e.exports=function(e,t){return r(e)||o(e,t)||a()}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){e.exports=n(26)},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t,n){var r=n(12);function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function a(t,n,i){return o()?e.exports=a=Reflect.construct:e.exports=a=function(e,t,n){var o=[null];o.push.apply(o,t);var a=new(Function.bind.apply(e,o));return n&&r(a,n.prototype),a},a.apply(null,arguments)}e.exports=a},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Resource",{enumerable:!0,get:function(){return r.Resource}}),Object.defineProperty(t,"List",{enumerable:!0,get:function(){return o.List}}),Object.defineProperty(t,"serialize",{enumerable:!0,get:function(){return a.serialize}}),Object.defineProperty(t,"createUnserializer",{enumerable:!0,get:function(){return i.createUnserializer}}),Object.defineProperty(t,"serve",{enumerable:!0,get:function(){return u.serve}}),Object.defineProperty(t,"getPatchesFor",{enumerable:!0,get:function(){return c.getPatchesFor}}),Object.defineProperty(t,"archivePatchesFor",{enumerable:!0,get:function(){return c.archivePatchesFor}}),Object.defineProperty(t,"Connection",{enumerable:!0,get:function(){return s.Connection}});var r=n(7),o=n(14),a=n(33),i=n(34),u=n(37),c=n(6),s=n(38)},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t,n){var r=n(1);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}},function(e,t){e.exports=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}return n}}},function(e,t){e.exports=require("regenerator-runtime")},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t,n){var r=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.JSONPatchOT=t.jsonpatch=void 0;var o=r(n(10)),a=(n(14),n(7),n(2));function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var u=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){var n=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},r=Object.prototype.hasOwnProperty;function u(e,t){return r.call(e,t)}function c(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var r in e)u(e,r)&&t.push(r);return t}function s(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function f(e,t){var n;for(var r in e)if(u(e,r)){if(e[r]===t)return s(r)+"/";if("object"==typeof e[r]&&""!=(n=f(e[r],t)))return s(r)+"/"+n}return""}function p(e,t){var n=[e];for(var r in t){var o="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==o&&n.push(r+": "+o)}return n.join("\n")}t.hasOwnProperty=u,t._objectKeys=c,t.deepMerge=function e(t,n){switch(typeof n){case"object":return t?t["[[attributes]]"]?(t.attributes=e(t["[[attributes]]"],n["[[attributes]]"]),t.base=e(t["[[base]]"],n["[[base]]"]),t):Array.isArray(n)?n.map((function(n,r){return t[r]&&t[r].uid==n.uid?e(t[r],n):n})):function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{},(0,a.map)(n,(function(n,r){return e(t[n],r)}))):t||n;case"undefined":return null;default:return n}},t._deepClone=function e(t){switch(typeof t){case"object":return t?t["[[attributes]]"]?t:Array.isArray(t)?t.map(e):(0,a.map)(t,(function(t,n){return e(n)})):t;case"undefined":return null;default:return t}},t.isInteger=function(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0},t.escapePathComponent=s,t.unescapePathComponent=function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},t._getPathRecursive=f,t.getPath=function(e,t){if(e===t)return"/";var n=f(e,t);if(""===n)throw new Error("Object not found in root");return"/"+n},t.hasUndefined=function e(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0}else if("object"==typeof t){var o=c(t),a=o.length;for(n=0;n<a;n++)if(e(t[o[n]]))return!0}return!1};var l=function(e){function t(t,n,r,o,a){e.call(this,p(t,{name:n,index:r,operation:o,tree:a})),this.name=n,this.index=r,this.operation=o,this.tree=a,this.message=p(t,{name:n,index:r,operation:o,tree:a})}return n(t,e),t}(Error);t.PatchError=l},function(e,t,n){var r={strict:!0},o=n(3),a=function(e,t){return o(e,t,r)},i=n(0);t.JsonPatchError=i.PatchError,t.deepClone=i._deepClone,t.deepMerge=i.deepMerge;var u={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=f(n,this.path);r&&(r=i._deepClone(r));var o=p(n,{op:"remove",path:this.from}).removed;return p(n,{op:"add",path:this.path,value:o}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=f(n,this.from);return p(n,{op:"add",path:this.path,value:i._deepClone(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:a(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}};function c(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"function"==typeof e._splice?e._splice.apply(e,n):e.splice.apply(e,n)}var s={add:function(e,t,n){return i.isInteger(t)?c(e,t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:c(e,t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:u.move,copy:u.copy,test:u.test,_get:u._get};function f(e,t){if(""==t)return e;var n={op:"_get",path:t};return p(e,n),n.value}function p(e,n,r,o,c,p){if(void 0===r&&(r=!1),void 0===o&&(o=!0),void 0===c&&(c=!0),void 0===p&&(p=0),r&&("function"==typeof r?r(n,0,e,n.path):d(n,0)),""===n.path){var l={newDocument:e};if("add"===n.op)return l.newDocument=n.value,l;if("replace"===n.op)return l.newDocument=n.value,l.removed=e,l;if("move"===n.op||"copy"===n.op)return l.newDocument=f(e,n.from),"move"===n.op&&(l.removed=e),l;if("test"===n.op){if(l.test=a(e,n.value),!1===l.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",p,n,e);return l.newDocument=e,l}if("remove"===n.op)return l.removed=e,l.newDocument=null,l;if("_get"===n.op)return n.value=e,l;if(r)throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",p,n,e);return l}o||(e=i._deepClone(e));var h=(n.path||"").split("/"),v=e,y=1,b=h.length,m=void 0,g=void 0,O=void 0;for(O="function"==typeof r?r:d;;){if(g=h[y],c&&"__proto__"==g)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===m&&(void 0===v[g]?m=h.slice(0,y).join("/"):y==b-1&&(m=n.path),void 0!==m&&O(n,0,e,m)),y++,Array.isArray(v)){if("-"===g)g=v.length;else{if(r&&!i.isInteger(g))throw new t.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",p,n,e);i.isInteger(g)&&(g=~~g)}if(y>=b){if(r&&"add"===n.op&&g>v.length)throw new t.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",p,n,e);if(!1===(l=s[n.op].call(n,v,g,e)).test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",p,n,e);return l}}else if(g&&-1!=g.indexOf("~")&&(g=i.unescapePathComponent(g)),y>=b){if(!1===(l=u[n.op].call(n,v,g,e)).test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",p,n,e);return l}v=v[g]}}function l(e,n,r,o,a){if(void 0===o&&(o=!0),void 0===a&&(a=!0),r&&!Array.isArray(n))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");o||(e=i._deepClone(e));for(var u=new Array(n.length),c=0,s=n.length;c<s;c++)u[c]=p(e,n[c],r,!0,a,c),e=u[c].newDocument;return u.newDocument=e,u}function d(e,n,r,o){if("object"!=typeof e||null===e||Array.isArray(e))throw new t.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",n,e,r);if(!u[e.op])throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,e,r);if("string"!=typeof e.path)throw new t.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",n,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new t.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",n,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new t.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",n,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",n,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&i.hasUndefined(e.value))throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",n,e,r);if(r)if("add"==e.op){var a=e.path.split("/").length,c=o.split("/").length;if(a!==c+1&&a!==c)throw new t.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",n,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==o)throw new t.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",n,e,r)}else if("move"===e.op||"copy"===e.op){var s=h([{op:"_get",path:e.from,value:void 0}],r);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new t.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",n,e,r)}}function h(e,n,r){try{if(!Array.isArray(e))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(n)l(i._deepClone(n),i._deepClone(e),r||!0);else{r=r||d;for(var o=0;o<e.length;o++)r(e[o],o,n,void 0)}}catch(e){if(e instanceof t.JsonPatchError)return e;throw e}}t.getValueByPointer=f,t.applyOperation=p,t.applyPatch=l,t.applyReducer=function(e,n,r){var o=p(e,n);if(!1===o.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",r,n,e);return o.newDocument},t.validator=d,t.validate=h},function(e,t,n){var r=n(0),o=n(1),a=n(1);t.applyOperation=a.applyOperation,t.applyPatch=a.applyPatch,t.applyReducer=a.applyReducer,t.getValueByPointer=a.getValueByPointer,t.validate=a.validate,t.validator=a.validator;var i=n(0);t.JsonPatchError=i.PatchError,t.deepClone=i._deepClone,t.deepMerge=i.deepMerge,t.escapePathComponent=i.escapePathComponent,t.unescapePathComponent=i.unescapePathComponent;var u=new WeakMap,c=function(e){this.observers=new Map,this.obj=e},s=function(e,t){this.callback=e,this.observer=t};function f(e){var t=u.get(e.object);p(t.value,e.object,e.patches,""),e.patches.length&&o.applyPatch(t.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function p(e,t,n,o){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=r._objectKeys(t),i=r._objectKeys(e),u=!1,c=i.length-1;c>=0;c--){var s=e[l=i[c]];if(!r.hasOwnProperty(t,l)||void 0===t[l]&&void 0!==s&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(n.push({op:"remove",path:o+"/"+r.escapePathComponent(l)}),u=!0):(n.push({op:"replace",path:o,value:t}),!0);else{var f=t[l];"object"==typeof s&&null!=s&&"object"==typeof f&&null!=f?p(s,f,n,o+"/"+r.escapePathComponent(l)):s!==f&&(!0,n.push({op:"replace",path:o+"/"+r.escapePathComponent(l),value:r._deepClone(f)}))}}if(u||a.length!=i.length)for(c=0;c<a.length;c++){var l=a[c];r.hasOwnProperty(e,l)||void 0===t[l]||n.push({op:"add",path:o+"/"+r.escapePathComponent(l),value:r._deepClone(t[l])})}}}t.unobserve=function(e,t){t.unobserve()},t.observe=function(e,t){var n,o=function(e){return u.get(e)}(e);if(o){var a=function(e,t){return e.observers.get(t)}(o,t);n=a&&a.observer}else o=new c(e),u.set(e,o);if(n)return n;if(n={},o.value=r._deepClone(e),t){n.callback=t,n.next=null;var i=function(){f(n)},p=function(){clearTimeout(n.next),n.next=setTimeout(i)};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",p),window.addEventListener("keyup",p),window.addEventListener("mousedown",p),window.addEventListener("keydown",p),window.addEventListener("change",p)):(document.documentElement.attachEvent("onmouseup",p),document.documentElement.attachEvent("onkeyup",p),document.documentElement.attachEvent("onmousedown",p),document.documentElement.attachEvent("onkeydown",p),document.documentElement.attachEvent("onchange",p)))}return n.patches=[],n.object=e,n.unobserve=function(){f(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(o,n),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",p),window.removeEventListener("keyup",p),window.removeEventListener("mousedown",p),window.removeEventListener("keydown",p)):(document.documentElement.detachEvent("onmouseup",p),document.documentElement.detachEvent("onkeyup",p),document.documentElement.detachEvent("onmousedown",p),document.documentElement.detachEvent("onkeydown",p)))},o.observers.set(t,new s(t,n)),n},t.generate=f,t.compare=function(e,t){var n=[];return p(e,t,n,""),n}},function(e,t,n){var r=Array.prototype.slice,o=n(5),a=n(4),i=e.exports=function(e,t,n){return n||(n={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?n.strict?e===t:e==t:function(e,t,n){var s,f;if(u(e)||u(t))return!1;if(e.prototype!==t.prototype)return!1;if(a(e))return!!a(t)&&(e=r.call(e),t=r.call(t),i(e,t,n));if(c(e)){if(!c(t))return!1;if(e.length!==t.length)return!1;for(s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}try{var p=o(e),l=o(t)}catch(e){return!1}if(p.length!=l.length)return!1;for(p.sort(),l.sort(),s=p.length-1;s>=0;s--)if(p[s]!=l[s])return!1;for(s=p.length-1;s>=0;s--)if(f=p[s],!i(e[f],t[f],n))return!1;return typeof e==typeof t}(e,t,n))};function u(e){return null==e}function c(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}},function(e,t){var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function r(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function o(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=n?r:o).supported=r,t.unsupported=o},function(e,t){function n(e){var t=[];for(var n in e)t.push(n);return t}(e.exports="function"==typeof Object.keys?Object.keys:n).shim=n}]);t.jsonpatch=u;var c=function(){var e=e||{};e.transform=function(e,n){var r=[];r=r.concat.apply(r,n);var o=JSON.parse(JSON.stringify(e));return r.reduce(t,o)},e.transformAgainstSingleOp=function(e,t){};var t=function(e,t){if(void 0===t.value&&("add"===t.op||"replace"===t.op||"test"===t.op))throw new Error("'value' MUST be defined");if(void 0===t.from&&("copy"===t.op||"move"===t.op))throw new Error("'from' MUST be defined");if(n[t.op])if("function"==typeof n[t.op])n[t.op](t,e);else for(var r=e.length,o=0;o<r;){var a=e[o];o++,n[t.op][a.op]&&n[t.op][a.op](t,a)}return e},n={remove:function(e,t){for(var n,a=t.length,i=0;n=t[i];)("add"!==n.op&&"test"!==n.op||e.path!==n.path)&&(n.from&&(n.from===e.path||0===n.from.indexOf(e.path+"/"))||e.path===n.path||0===n.path.indexOf(e.path+"/"))&&(callSplice(t,i,1),a--,i--),i++;var u=e.path.lastIndexOf("/");if(u>-1){var c=e.path.substr(u+1),s=e.path.substr(0,u+1);if(o(c))for(a=t.length,i=0;i<a;)n=t[i],i++,0===n.path.indexOf(s)&&(n.path=r(n.path,s,c,-1)),n.from&&0===n.from.indexOf(s)&&(n.from=r(n.from,s,c,-1))}},add:function(e,t){for(var n,a=t.length,i=0;n=t[i];)("add"!==n.op&&"test"!==n.op||e.path!==n.path)&&(n.from&&(n.from===e.path||0===n.from.indexOf(e.path+"/"))||e.path===n.path||0===n.path.indexOf(e.path+"/"))&&(callSplice(t,i,1),a--,i--),i++;var u=e.path.lastIndexOf("/");if(u>-1){var c=e.path.substr(u+1),s=e.path.substr(0,u+1);if(o(c))for(a=t.length,i=0;i<a;)n=t[i],i++,0===n.path.indexOf(s)&&(n.path=r(n.path,s,c,1)),n.from&&0===n.from.indexOf(s)&&(n.from=r(n.from,s,c,1))}},replace:function(e,t){for(var n,r=0;n=t[r];)(n.from&&(n.from===e.path||0===n.from.indexOf(e.path+"/"))||0===n.path.indexOf(e.path+"/"))&&(callSplice(t,r,1),r--),r++}};function r(e,t,n,r){var a=e.substr(t.length),i=a.indexOf("/");i>-1||(i=a.length);var u=a.substr(0,i),c=a.substr(i);return o(u)&&r>0&&u>=n||r<0&&u>n?t+(parseInt(u)+r)+c:e}function o(e){var t=~~Number(e);return String(t)===e&&t>=0}return e}();t.JSONPatchOT=c},function(e,t,n){var r=n(1),o=n(12),a=n(31),i=n(21);function u(t){var n="function"==typeof Map?new Map:void 0;return e.exports=u=function(e){if(null===e||!a(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return i(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),o(t,e)},u(t)}e.exports=u},function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},function(e,t,n){var r=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncEvent=void 0;var o=r(n(3)),a=n(6);t.SyncEvent=function e(t){var n=t.resource;(0,o.default)(this,e),this.resource=n,this.patches=(0,a.stageNewPatches)(n)}},function(e,t,n){var r=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var o=r(n(10)),a=r(n(19)),i=n(2),u=n(7),c=n(6);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=["String","Boolean","Number","Date","Function"],l=[Object.prototype,Function.prototype,u.Resource.prototype,u.Resource,i.EventEmitter.prototype,void 0,null],d=function(e){return"function"==typeof e?["length","name","prototype"]:["constructor","[[attributes]]","[[patches]]","[[base]]","[[batch]]","[[validation]]"]};t.serialize=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=new i.EventEmitter,n=function(){if(!b(e))throw Error("$interface must be a plain JavaScript Object");var n=r("global",e);return Object.defineProperty(n,"emit",{enumerable:!1,value:function(){return t.emit.apply(t,arguments)}}),n},r=function e(t,n){for(var r={},a={},u=function(e){(0,i.each)(Object.getOwnPropertyDescriptors(e),(function(t,o){d(e).includes(t)||(a[t]=n[t],r[t]=o)}))},c=n;!l.includes(c);c=c.__proto__)u(c);return{type:"object",attributes:(0,i.map)(a,(function(a,u){var c=r[a],l=(0,i.getMetadata)(n,a);return h(u,c)?o(t+"/"+a,u,c,l,n,a):b(u,c)?e(t+"/"+a,u):m(u,c)?s(t+"/"+a,u,c,l,n,a):g(u,c)?f(t+"/"+a,u,c,l,n,a):O(u,c)?p(t+"/"+a,u,c,l,n,a):void 0}))}},o=function(e,t){var n=new t;return{name:e,type:"class",className:t.name,classMethods:u(e,t),instanceMethods:u(e+"/#",n)}},u=function(e,t){for(var n={},o=function(e){(0,i.each)(Object.getOwnPropertyDescriptors(e),(function(t,r){d(e).includes(t)||(n[t]=r)}))},a=t;!l.includes(a);a=a.__proto__)o(a);return(0,i.map)(n,(function(n,o){var a=(0,i.getMetadata)(t,n);return b(o.value,o)?r(e+"/"+n,o.value,o,a,t,n):m(o.value,o)?s(e+"/"+n,o.value,o,a,t,n):g(o.value,o)?f(e+"/"+n,o.value,o,a,t,n):O(o.value,o)?p(e+"/"+n,o.value,o,a,t,n):void 0}))},s=function(e,n,r,o,i){var u=o.isShared,s=o.readAccessTest,f=o.usesSession,p=o.isStream,l=o.original;return u?{isStream:p,name:e,type:"shared-function",value:p?l.toString():n.toString()}:(t.on(e,(function(e){var t,r,o,u,p,l,d,h,v,y,b,m,g,O,E;return a.default.async((function(x){for(;;)switch(x.prev=x.next){case 0:return t=e.args,e.uid,r=e.attributes,o=e.patches,u=e.socket,p=e.send,e.onClose,u.cache=u.cache||(0,c.createCache)(u),l=u.session,d="function"==typeof i?i:new i.constructor(r),x.next=6,a.default.awrap((0,c.updateResource)(d,o,l));case 6:if(h=x.sent,v=h.updateSuccessful,y=h.invalidPatches,v){x.next=11;break}return x.abrupt("return",p({error:!0,invalidPatches:y,message:"You are not authorized to update the resource as requested"}));case 11:if(x.t0=void 0!==s,!x.t0){x.next=16;break}return x.next=15,a.default.awrap(s.call(d,{session:l,resource:d}));case 15:x.t0=!x.sent;case 16:if(!x.t0){x.next=18;break}return x.abrupt("return",p({error:!0,message:"You are not authorized to call this method"}));case 18:g=u.session.createSlice(),O=function e(t,n){var r,o,i,c;return a.default.async((function(s){for(;;)switch(s.prev=s.next){case 0:return r=u.cache,o=g,i=function(){return e(t,n)},s.next=5,a.default.awrap(P(t,{cache:r,session:o,callback:i}));case 5:c=s.sent,p(c,n);case 7:case"end":return s.stop()}}))},f&&(m=u.session.createSlice(),t.unshift(m),m.onChange((function(){return E()}))),(E=function(){b&&b.destroy&&b.destroy();try{b=n.apply(d,t)}catch(e){p({error:!0,message:e.message,callstack:Error.captureStackTrace(e)})}b&&b.catch&&b.catch((function(e){p({error:!0,message:e.message,callstack:e.stack})})),w(b)?b.observe((function(e){return O(e,!0)})):_(b)?b.then((function(e){return O(e)})):O(b)})();case 23:case"end":return x.stop()}}))})),{name:e,type:"remote-function"})},f=function(e,t,n,r,o,a){var i=r.validators;return{name:e,key:a,type:"property",enumerable:n.enumerable,get:s(e+".get",n.get||function(){return null},n,r,o),set:s(e+".set",n.set||function(){return null},n,r,o),validators:i&&i.map((function(e){return e.toString()}))}},p=function(e,t,n,r,o,a){var i=r.validators;return{name:e,key:a,type:"attribute",value:n.value,validators:i&&i.map((function(e){return e.toString()}))}};return n()};var h=function(e){return"function"==typeof e&&e.prototype instanceof u.Resource},v=function(e){return e instanceof u.Resource},y=function(e){return Array.isArray(e)},b=function(e){return e&&e.__proto__===Object.prototype},m=function(e){return"function"==typeof e&&!h(e)},g=function(e,t){return"function"==typeof t.get||"function"==typeof t.set},O=function(e,t){return[h,b,m,g].every((function(n){return!n(e,t)}))},w=function(e){return e&&"function"==typeof e.observe},_=function(e){return e&&"function"==typeof e.then&&!w(e)},P=function e(t,n){var r,o,u,c;return a.default.async((function(s){for(;;)switch(s.prev=s.next){case 0:if(r=n.cache,o=n.session,u=n.callback,c=function(t){return e(t,{cache:r,session:o,callback:u})},t){s.next=4;break}return s.abrupt("return",t);case 4:if(!h(t)){s.next=6;break}return s.abrupt("return",{_class_:t.name});case 6:if(l=t,!p.includes(l.constructor.name)){s.next=8;break}return s.abrupt("return",t);case 8:if(!y(t)){s.next=12;break}return s.next=11,a.default.awrap(Promise.all(t.map((function(e,t){return c(e)}))));case 11:return s.abrupt("return",s.sent);case 12:if(!b(t)){s.next=16;break}return s.next=15,a.default.awrap((0,i.mapAsync)(t,(function(e,t){return c(t)})));case 15:return s.abrupt("return",s.sent);case 16:if(r.cache(t),!v(t)){s.next=25;break}return s.t0=f,s.t1={},s.next=22,a.default.awrap((0,i.mapAsync)(t["[[attributes]]"],(function(e,n){var r,s,f,p,l;return a.default.async((function(d){for(;;)switch(d.prev=d.next){case 0:if(r=(0,i.getMetadata)(t,e),s=r.readAccessTest,f=r.namespace,void 0!==s){d.next=8;break}return d.next=5,a.default.awrap(c(n));case 5:return d.abrupt("return",d.sent);case 8:return o.onChange(u),p=t,(l=s.call(p,{session:o,resource:p}))instanceof Promise&&config.audit&&console.warn("Running Asynchronous Authentication Checks for "+f+" during serailization"),d.next=14,a.default.awrap(l);case 14:if(d.sent){d.next=18;break}return d.abrupt("return",null);case 18:return d.next=20,a.default.awrap(c(n));case 20:return d.abrupt("return",d.sent);case 21:case"end":return d.stop()}}))})));case 22:return s.t2=s.sent,s.t3={_proto_:t.constructor.name},s.abrupt("return",(0,s.t0)(s.t1,s.t2,s.t3));case 25:case"end":return s.stop()}var l}))}},function(e,t,n){var r=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.createUnserializer=void 0;var o=r(n(35)),a=r(n(11)),i=r(n(21)),u=r(n(3)),c=r(n(4)),s=r(n(1)),f=r(n(5)),p=n(2),l=n(14),d=n(7),h=n(6),v=["String","Boolean","Number","Date","Function"];t.createUnserializer=function(e){var t=y({socket:e}),n={Resource:d.Resource,List:l.List},r=function(e){var t=function(e){function t(){return(0,u.default)(this,t),(0,c.default)(this,(0,s.default)(t).apply(this,arguments))}return(0,f.default)(t,e),t}(d.Resource);return Object.defineProperty(t,"name",{value:e.className}),b(t,e.classMethods),b(t.prototype,e.instanceMethods),t},b=function e(t,n){return(0,p.each)(n,(function(n,o){switch(o.type){case"class":t[n]=r(o);break;case"object":t[n]=e({},o.attributes);break;case"shared-function":t[n]=g(o);break;case"remote-function":t[n]=O(o);break;case"property":w(t,n,o);break;case"attribute":t[n]=_(o,t)}})),t},m=function(e){switch(e.type){case"shared-function":return g(e);case"remote-function":return O(e)}},g=function(e){var t,n,r=e.isStream,o=(e.prependEmit,e.value),a=new Function("return "+o)();return r?(t=a,n=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return t.call.apply(t,[this].concat(r,[e]))},function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,i.default)(p.Pipe,[[this,n]].concat(t))}):a};var O=function(t){var n=t.name,r=function(t,r){var o,a=this.uid,i=this["[[attributes]]"],u=(0,h.stageNewPatches)(this),c=function(){return t(o)},s=function(e){if(e&&e.error){e.invalidPatches;var n=new Error(e.message);n.stack=e.callstack,t.throw(n)}o=P(e,c),t(o)};e.emit(n,{uid:a,patches:u,args:r,attributes:i},s)};return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new p.Pipe([this,r],t)}},w=function(e,t,n){var r=e.validation;r&&n.validators&&n.validators.forEach((function(e){r.addHandler(n.key,g({value:e}))})),Object.defineProperty(e,t,{enumerable:n.enumerable,get:m(n.get),set:m(n.set)})},_=function(e,t){var n=t.validation;return n&&e.validators&&e.validators.forEach((function(t){n.addHandler(e.key,g({value:t}))})),e.value},P=function e(r,u){var c=function(t){return e(t,u)};if(!r)return r;if(v.includes(r.constructor.name))return r;if(Array.isArray(r))return(0,i.default)(l.List,(0,a.default)(r.map((function(e){return c(e)}))));var s=r._class_,f=r._proto_,d=(0,o.default)(r,["_class_","_proto_"]);return s?n[s]:f?t.register(new n[f]((0,p.map)(d,(function(e,t){return c(t)}))),u):(0,p.map)(d,(function(e,t){return c(t)}))};return function(e){if("object"!=typeof e)throw Error("schema must be a plain JavaScript Object");return b(n,e.attributes)}};var y=function(e){var t=e.socket,n={};return window.bin=n,{register:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;if(n[e.uid])n[e.uid].callbacks.includes(r)||n[e.uid].callbacks.push(r),(0,h.upstreamMerge)(n[e.uid].resource,e),e=n[e.uid].resource;else{function o(){n[e.uid].callbacks.forEach((function(e){return e()}))}e.on("Δ.change",(function(){return o()})),e.on("Δ.sync",(function(n){var r=n.patches,a=(0,h.createBatch)(e);t.emit(e.uid+".sync",{patches:r,batchId:a},(function(t){var n=t.updateSuccessful,r=t.invalidPatches;n||((0,h.rollbackPatches)(e,r),o())}))})),t.on(e.uid+".mergeBatch",(function(t){(0,h.mergeBatch)(e,t)})),t.on(e.uid+".mergePatches",(function(t){(0,h.mergePatches)(e,t),o()})),n[e.uid]={resource:e,callbacks:[r]}}return e}}}},function(e,t,n){var r=n(36);e.exports=function(e,t){if(null==e)return{};var n,o,a=r(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}},function(e,t){e.exports=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.serve=void 0;t.serve=function(){throw Error("Cannot Serve From Client Side")}},function(e,t,n){var r=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0;var o=r(n(3)),a=r(n(9)),i=r(n(4)),u=r(n(1)),c=r(n(5)),s=n(39),f=function(e){function t(e){var n;return(0,o.default)(this,t),(n=(0,i.default)(this,(0,u.default)(t).call(this))).bind(e),e.addEventListener("open",(function(){e.send("initialize")})),e.addEventListener("reconnect",(function(t){t.number;e.send("mount "+n.id)})),n.on("__id__",(function(e){return n.id=e})),n.on("__reload__",(function(){return window.location.reload()})),n.on("__load_session__",(function(e,t){return t(localStorage.getItem("session"))})),n.on("__save_session__",(function(e){return localStorage.setItem("session",e)})),n}return(0,c.default)(t,e),(0,a.default)(t,null,[{key:"establish",value:function(e){var n=new URL(e),r=n.protocol,o=n.host,a=n.pathname,i=(n.port,"https:"===r?"wss:":"ws:");return new t(new s.Client(i+"//"+o+a))}}]),t}(n(42).ConnectionBase);t.Connection=f},function(e,t,n){var r=n(0);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Client",{enumerable:!0,get:function(){return o.default}});var o=r(n(40))},function(e,t,n){(function(e){var r=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var o=r(n(15));function a(t,n,r){var i,u,c={close:function(){}},s=this,f=0,p=-1,l=!1,d=!1,h=(0,o.default)({},a.defaultOptions,"function"==typeof r?{shouldReconnect:r}:r);if("number"!=typeof h.timeout)throw new Error("timeout must be the number of milliseconds to timeout a connection attempt");if("function"!=typeof h.shouldReconnect)throw new Error("shouldReconnect must be a function that returns the number of milliseconds to wait for a reconnect attempt, or null or undefined to not reconnect.");function v(){u&&(clearTimeout(u),u=null)}["bufferedAmount","url","readyState","protocol","extensions"].forEach((function(e){Object.defineProperty(s,e,{get:function(){return c[e]}})}));var y=function(e){l&&(v(),O(e))},b=function(){l=!0,c.close(1e3)},m=!1;function g(){m&&(e.removeEventListener("online",y),e.removeEventListener("offline",b),m=!1)}function O(e){if(!h.shouldReconnect.handle1000&&1e3===e.code||d)f=0;else if(!1!==navigator.onLine){var t=h.shouldReconnect(e,s);"number"==typeof t&&(u=setTimeout(w,t))}else l=!0}function w(){u=null,(c=new WebSocket(t,n||void 0)).binaryType=s.binaryType,f++,s.dispatchEvent((0,o.default)(new CustomEvent("connecting"),{attempts:f,reconnects:p})),i=setTimeout((function(){i=null,g(),s.dispatchEvent((0,o.default)(new CustomEvent("timeout"),{attempts:f,reconnects:p}))}),h.timeout),["open","close","message","error"].forEach((function(e){c.addEventListener(e,(function(t){s.dispatchEvent(t);var n=s["on"+e];if("function"==typeof n)return n.apply(s,arguments)}))})),h.ignoreConnectivityEvents||m||(e.addEventListener("online",y),e.addEventListener("offline",b),m=!0)}s.send=function(){if(1==c.readyState)return c.send.apply(c,arguments)},s.close=function(e,t){return"number"!=typeof e&&(t=e,e=1e3),v(),l=!1,d=!0,g(),c.close(e,t)},s.reconnect=function(){c.close(1e3),O({})},s.open=function(){c.readyState!==WebSocket.OPEN&&c.readyState!==WebSocket.CONNECTING&&(v(),l=!1,d=!1,w())},Object.defineProperty(s,"listeners",{value:{open:[function(e){i&&(clearTimeout(i),i=null),e.reconnects=++p,e.attempts=f,p>0&&s.dispatchEvent((0,o.default)(new CustomEvent("reconnect"),{number:p})),f=0,l=!1}],close:[O]}}),Object.defineProperty(s,"attempts",{get:function(){return f},enumerable:!0}),Object.defineProperty(s,"reconnects",{get:function(){return p},enumerable:!0}),h.automaticOpen&&w()}a.defaultOptions={timeout:4e3,shouldReconnect:function(e,t){if(1008!==e.code&&1011!==e.code)return[0,3e3,1e4][t.attempts]},ignoreConnectivityEvents:!1,automaticOpen:!0},a.prototype.binaryType="blob",a.prototype.addEventListener=function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)},a.prototype.removeEventListener=function(e,t){if(e in this.listeners)for(var n=this.listeners[e],r=0,o=n.length;r<o;r++)if(n[r]===t)return void n.splice(r,1)},a.prototype.dispatchEvent=function(e){if(e.type in this.listeners)for(var t=this.listeners[e.type],n=0,r=t.length;n<r;n++)t[n].call(this,e)}}).call(this,n(41))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionBase=void 0;var o=r(n(16)),a=r(n(11)),i=r(n(43)),u=r(n(3)),c=r(n(9)),s=r(n(4)),f=r(n(8)),p=r(n(5)),l=r(n(1)),d=r(n(13)),h=r(n(10)),v=function(e){function t(){var e;return(0,u.default)(this,t),e=(0,s.default)(this,(0,l.default)(t).call(this)),(0,h.default)((0,f.default)(e),"handleMessage",(function(n){var r=n.data;try{var o=JSON.parse(r),a=(0,i.default)(o),u=a[0],c=a[1],s=a[2],p=a.slice(3);e.timeLastReceived=Date.now();var h=e.inboxId+1,v=e.createRespond(s);p.forEach(e.removeFromOutbox),parseInt(s)===h?(e.receipts.push(s),e.inboxId=s,(0,d.default)((0,l.default)(t.prototype),"emit",(0,f.default)(e)).call((0,f.default)(e),u,c,v),e.resolveInbox()):null!=s?(e.receipts.push(s),e.saveToInbox(s,u,c),e.requestMessage(h)):(0,d.default)((0,l.default)(t.prototype),"emit",(0,f.default)(e)).call((0,f.default)(e),u,c,v)}catch(e){console.log("Un-parsed message:",r)}})),(0,h.default)((0,f.default)(e),"resendMessage",(function(t){var n=e.outbox[t];e.socket.send(n)})),(0,h.default)((0,f.default)(e),"removeFromInbox",(function(t){delete e.inbox[t]})),(0,h.default)((0,f.default)(e),"removeFromOutbox",(function(t){delete e.outbox[t]})),(0,h.default)((0,f.default)(e),"clearReceipts",(function(){e.timeLastSent<Date.now()-1e4&&e.receipts.length>0&&e.socket.send(JSON.stringify(["__ping__",null,null].concat((0,a.default)(e.getReceipts()))))})),e.timeLastSent=0,e.timeLastReceived=0,e.inboxId=0,e.outboxId=0,e.outbox={},e.inbox={},e.receipts=[],e.on("__request_message__",e.resendMessage),e.clearReceiptsTimer=setInterval(e.clearReceipts,1e4),e}return(0,p.default)(t,e),(0,c.default)(t,[{key:"bind",value:function(e){this.socket=e,e.addEventListener("message",this.handleMessage)}},{key:"emit",value:function(e,t,n){var r=++this.outboxId,o=JSON.stringify([e,t,r].concat((0,a.default)(this.getReceipts())));this.saveToOutbox(r,o),this.socket.send(o),this.timeLastSent=Date.now(),n&&this.on("__response_"+r+"__",n)}},{key:"requestMessage",value:function(e){this.socket.send(JSON.stringify(["__request_message__",e]))}},{key:"saveToInbox",value:function(e,t,n){this.inbox[e]=[t,n]}},{key:"saveToOutbox",value:function(e,t){this.outbox[e]=t}},{key:"resolveInbox",value:function(){for(;void 0!==this.inbox[this.inboxId+1];){var e=(0,o.default)(this.inbox[++this.inboxId],2),n=e[0],r=e[1],a=this.createRespond(this.inboxId);(0,d.default)((0,l.default)(t.prototype),"emit",this).call(this,n,r,a),this.removeFromInbox(this.inboxId)}y(this.inbox)||this.requestMessage(this.inboxId+1)}},{key:"getReceipts",value:function(){var e=this.receipts;return this.receipts=[],e}},{key:"createRespond",value:function(e){var t=this;return function(n,r){return t.emit("__response_"+e+"__",n,r)}}}]),t}(n(2).EventEmitter);t.ConnectionBase=v;var y=function(e){return 0===Object.keys(e).length}},function(e,t,n){var r=n(17),o=n(20),a=n(18);e.exports=function(e){return r(e)||o(e)||a()}}]);