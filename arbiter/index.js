module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=30)}([function(e,t){e.exports=require("triframe/core")},function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/typeof")},function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/classCallCheck")},function(e,t){e.exports=require("@babel/runtime/helpers/createClass")},function(e,t){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,t){e.exports=require("@babel/runtime/helpers/getPrototypeOf")},function(e,t){e.exports=require("@babel/runtime/helpers/toConsumableArray")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("@babel/runtime/helpers/inherits")},function(e,t){e.exports=require("@babel/runtime/helpers/assertThisInitialized")},function(e,t){e.exports=require("@babel/runtime/helpers/get")},function(e,t){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,t){e.exports=require("@babel/runtime/helpers/construct")},function(e,t){e.exports=require("@babel/runtime/helpers/wrapNativeSuper")},function(e,t){e.exports=require("@babel/runtime/helpers/objectWithoutProperties")},function(e,t){e.exports=require("triframe/scribe")},function(e,t){e.exports=require("mime")},function(e,t){e.exports=require("ncp")},function(e,t){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var o=e[r];"."===o?e.splice(r,1):".."===o?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var e="",t=!1,o=arguments.length-1;o>=-1&&!t;o--){var a=o>=0?arguments[o]:process.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(e=a+"/"+e,t="/"===a.charAt(0))}return(t?"/":"")+(e=n(r(e.split("/"),(function(e){return!!e})),!t).join("/"))||"."},t.normalize=function(e){var a=t.isAbsolute(e),i="/"===o(e,-1);return(e=n(r(e.split("/"),(function(e){return!!e})),!a).join("/"))||a||(e="."),e&&i&&(e+="/"),(a?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,n){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var o=r(e.split("/")),a=r(n.split("/")),i=Math.min(o.length,a.length),c=i,u=0;u<i;u++)if(o[u]!==a[u]){c=u;break}var s=[];for(u=c;u<o.length;u++)s.push("..");return(s=s.concat(a.slice(c))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,o=!0,a=e.length-1;a>=1;--a)if(47===(t=e.charCodeAt(a))){if(!o){r=a;break}}else o=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},t.basename=function(e,t){var n=function(e){"string"!=typeof e&&(e+="");var t,n=0,r=-1,o=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!o){n=t+1;break}}else-1===r&&(o=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,n=0,r=-1,o=!0,a=0,i=e.length-1;i>=0;--i){var c=e.charCodeAt(i);if(47!==c)-1===r&&(o=!1,r=i+1),46===c?-1===t?t=i:1!==a&&(a=1):-1!==t&&(a=-1);else if(!o){n=i+1;break}}return-1===t||-1===r||0===a||1===a&&t===r-1&&t===n+1?"":e.slice(t,r)};var o="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("formidable")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("session-file-store")},function(e,t,n){"use strict";n.r(t),n.d(t,"Resource",(function(){return ee})),n.d(t,"List",(function(){return C})),n.d(t,"serialize",(function(){return ie})),n.d(t,"createUnserializer",(function(){return Ee})),n.d(t,"serve",(function(){return Ge})),n.d(t,"getPatchesFor",(function(){})),n.d(t,"archivePatchesFor",(function(){}));var r=n(4),o=n.n(r),a=n(10),i=n.n(a),c=n(12),u=n.n(c),s=n(5),p=n.n(s),f=n(11),l=n.n(f),h=n(7),d=n.n(h),v=n(13),b=n.n(v),m=n(6),y=n.n(m),g=n(0),O=n(14),w=n.n(O),E=n(1),P=n.n(E),j=n(3),A=n.n(j),_=n(8),k=n.n(_),x=n(2),S=n.n(x),T=n(16),C=function(e){function t(){var e,n;o()(this,t);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return n=i()(this,(e=d()(t)).call.apply(e,[this].concat(a))),Object.defineProperty(u()(n),"[[patches]]",{enumerable:!1,value:[]}),Object.defineProperty(u()(n),"[[events]]",{enumerable:!1,value:new g.EventEmitter}),n}return l()(t,e),p()(t,[{key:"on",value:function(){var e;return(e=this["[[events]]"]).on.apply(e,arguments)}},{key:"emit",value:function(){var e;return(e=this["[[events]]"]).emit.apply(e,arguments)}},{key:"push",value:function(){for(var e,n,r=this.length,o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];var c=a.map((function(e){return{op:"add",path:"/".concat(r++),value:e}}));(e=this["[[patches]]"]).push.apply(e,k()(c)),this.emit("Δ.change",c),(n=b()(d()(t.prototype),"push",this)).call.apply(n,[this].concat(a))}},{key:"insert",value:function(e,t){this.splice(t,0,e);var n={op:"add",path:"/".concat(t),value:e};this["[[patches]]"].push(n),this.emit("Δ.change",[n])}},{key:"replace",value:function(e,t){this[e]=t;var n={op:"replace",path:"/".concat(e),value:t};this["[[patches]]"].push(n),this.emit("Δ.change",[n])}},{key:"map$",value:function(e){var t,n=this,r=[];this.forEach((function(t,o){var a=e(t,o);if(a!=t){n[o]=a;var i={op:"replace",path:"/".concat(o),value:a};r.push(i)}})),(t=this["[[patches]]"]).push.apply(t,r),this.emit("Δ.change",r)}},{key:"remove",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==n&&(n=e),this.splice(e,1+n-e);for(var r=[],o=e;o<=n;o++)r.push({op:"remove",path:"/".concat(e)});(t=this["[[patches]]"]).push.apply(t,r),this.emit("Δ.change",r)}}]),t}(n.n(T)()(Array));function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}
/*! fast-json-patch, version: 2.1.0 */
var N,D=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){
/*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017 Joachim Wester
   * MIT license
   */
var n=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},r=Object.prototype.hasOwnProperty;function o(e,t){return r.call(e,t)}function a(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var r in e)o(e,r)&&t.push(r);return t}function i(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function c(e,t){var n;for(var r in e)if(o(e,r)){if(e[r]===t)return i(r)+"/";if("object"===S()(e[r])&&""!=(n=c(e[r],t)))return i(r)+"/"+n}return""}function u(e,t){var n=[e];for(var r in t){var o="object"===S()(t[r])?JSON.stringify(t[r],null,2):t[r];void 0!==o&&n.push(r+": "+o)}return n.join("\n")}t.hasOwnProperty=o,t._objectKeys=a,t.deepMerge=function e(t,n){switch(S()(n)){case"object":return t?t["[[attributes]]"]?(t.attributes=e(t["[[attributes]]"],n["[[attributes]]"]),t.base=e(t["[[base]]"],n["[[base]]"]),t):Array.isArray(n)?n.map((function(n,r){return t[r]&&t[r].uid==n.uid?e(t[r],n):n})):function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){y()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{},Object(g.map)(n,(function(n,r){return e(t[n],r)}))):t||n;case"undefined":return null;default:return n}},t._deepClone=function e(t){switch(S()(t)){case"object":return t?t["[[attributes]]"]?t:Array.isArray(t)?t.map(e):Object(g.map)(t,(function(t,n){return e(n)})):t;case"undefined":return null;default:return t}},t.isInteger=function(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0},t.escapePathComponent=i,t.unescapePathComponent=function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},t._getPathRecursive=c,t.getPath=function(e,t){if(e===t)return"/";var n=c(e,t);if(""===n)throw new Error("Object not found in root");return"/"+n},t.hasUndefined=function e(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0}else if("object"===S()(t)){var o=a(t),i=o.length;for(n=0;n<i;n++)if(e(t[o[n]]))return!0}return!1};var s=function(e){function t(t,n,r,o,a){e.call(this,u(t,{name:n,index:r,operation:o,tree:a})),this.name=n,this.index=r,this.operation=o,this.tree=a,this.message=u(t,{name:n,index:r,operation:o,tree:a})}return n(t,e),t}(Error);t.PatchError=s},function(e,t,n){var r={strict:!0},o=n(3),a=function(e,t){return o(e,t,r)},i=n(0);t.JsonPatchError=i.PatchError,t.deepClone=i._deepClone,t.deepMerge=i.deepMerge;var c={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=s(n,this.path);r&&(r=i._deepClone(r));var o=p(n,{op:"remove",path:this.from}).removed;return p(n,{op:"add",path:this.path,value:o}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=s(n,this.from);return p(n,{op:"add",path:this.path,value:i._deepClone(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:a(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},u={add:function(e,t,n){return i.isInteger(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:c.move,copy:c.copy,test:c.test,_get:c._get};function s(e,t){if(""==t)return e;var n={op:"_get",path:t};return p(e,n),n.value}function p(e,n,r,o,p,f){if(void 0===r&&(r=!1),void 0===o&&(o=!0),void 0===p&&(p=!0),void 0===f&&(f=0),r&&("function"==typeof r?r(n,0,e,n.path):l(n,0)),""===n.path){var h={newDocument:e};if("add"===n.op)return h.newDocument=n.value,h;if("replace"===n.op)return h.newDocument=n.value,h.removed=e,h;if("move"===n.op||"copy"===n.op)return h.newDocument=s(e,n.from),"move"===n.op&&(h.removed=e),h;if("test"===n.op){if(h.test=a(e,n.value),!1===h.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",f,n,e);return h.newDocument=e,h}if("remove"===n.op)return h.removed=e,h.newDocument=null,h;if("_get"===n.op)return n.value=e,h;if(r)throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",f,n,e);return h}o||(e=i._deepClone(e));var d=(n.path||"").split("/"),v=e,b=1,m=d.length,y=void 0,g=void 0,O=void 0;for(O="function"==typeof r?r:l;;){if(g=d[b],p&&"__proto__"==g)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===y&&(void 0===v[g]?y=d.slice(0,b).join("/"):b==m-1&&(y=n.path),void 0!==y&&O(n,0,e,y)),b++,Array.isArray(v)){if("-"===g)g=v.length;else{if(r&&!i.isInteger(g))throw new t.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",f,n,e);i.isInteger(g)&&(g=~~g)}if(b>=m){if(r&&"add"===n.op&&g>v.length)throw new t.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",f,n,e);if(!1===(h=u[n.op].call(n,v,g,e)).test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",f,n,e);return h}}else if(g&&-1!=g.indexOf("~")&&(g=i.unescapePathComponent(g)),b>=m){if(!1===(h=c[n.op].call(n,v,g,e)).test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",f,n,e);return h}v=v[g]}}function f(e,n,r,o,a){if(void 0===o&&(o=!0),void 0===a&&(a=!0),r&&!Array.isArray(n))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");o||(e=i._deepClone(e));for(var c=new Array(n.length),u=0,s=n.length;u<s;u++)c[u]=p(e,n[u],r,!0,a,u),e=c[u].newDocument;return c.newDocument=e,c}function l(e,n,r,o){if("object"!==S()(e)||null===e||Array.isArray(e))throw new t.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",n,e,r);if(!c[e.op])throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,e,r);if("string"!=typeof e.path)throw new t.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",n,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new t.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",n,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new t.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",n,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",n,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&i.hasUndefined(e.value))throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",n,e,r);if(r)if("add"==e.op){var a=e.path.split("/").length,u=o.split("/").length;if(a!==u+1&&a!==u)throw new t.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",n,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==o)throw new t.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",n,e,r)}else if("move"===e.op||"copy"===e.op){var s=h([{op:"_get",path:e.from,value:void 0}],r);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new t.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",n,e,r)}}function h(e,n,r){try{if(!Array.isArray(e))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(n)f(i._deepClone(n),i._deepClone(e),r||!0);else{r=r||l;for(var o=0;o<e.length;o++)r(e[o],o,n,void 0)}}catch(e){if(e instanceof t.JsonPatchError)return e;throw e}}t.getValueByPointer=s,t.applyOperation=p,t.applyPatch=f,t.applyReducer=function(e,n,r){var o=p(e,n);if(!1===o.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",r,n,e);return o.newDocument},t.validator=l,t.validate=h},function(e,t,n){
/*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017 Joachim Wester
   * MIT license
   */
var r=n(0),o=n(1),a=n(1);t.applyOperation=a.applyOperation,t.applyPatch=a.applyPatch,t.applyReducer=a.applyReducer,t.getValueByPointer=a.getValueByPointer,t.validate=a.validate,t.validator=a.validator;var i=n(0);t.JsonPatchError=i.PatchError,t.deepClone=i._deepClone,t.deepMerge=i.deepMerge,t.escapePathComponent=i.escapePathComponent,t.unescapePathComponent=i.unescapePathComponent;var c=new WeakMap,u=function(e){this.observers=new Map,this.obj=e},s=function(e,t){this.callback=e,this.observer=t};function p(e){var t=c.get(e.object);f(t.value,e.object,e.patches,""),e.patches.length&&o.applyPatch(t.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function f(e,t,n,o){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=r._objectKeys(t),i=r._objectKeys(e),c=!1,u=i.length-1;u>=0;u--){var s=e[l=i[u]];if(!r.hasOwnProperty(t,l)||void 0===t[l]&&void 0!==s&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(n.push({op:"remove",path:o+"/"+r.escapePathComponent(l)}),c=!0):(n.push({op:"replace",path:o,value:t}),!0);else{var p=t[l];"object"==S()(s)&&null!=s&&"object"==S()(p)&&null!=p?f(s,p,n,o+"/"+r.escapePathComponent(l)):s!==p&&(!0,n.push({op:"replace",path:o+"/"+r.escapePathComponent(l),value:r._deepClone(p)}))}}if(c||a.length!=i.length)for(u=0;u<a.length;u++){var l=a[u];r.hasOwnProperty(e,l)||void 0===t[l]||n.push({op:"add",path:o+"/"+r.escapePathComponent(l),value:r._deepClone(t[l])})}}}t.unobserve=function(e,t){t.unobserve()},t.observe=function(e,t){var n,o=function(e){return c.get(e)}(e);if(o){var a=function(e,t){return e.observers.get(t)}(o,t);n=a&&a.observer}else o=new u(e),c.set(e,o);if(n)return n;if(n={},o.value=r._deepClone(e),t){n.callback=t,n.next=null;var i=function(){p(n)},f=function(){clearTimeout(n.next),n.next=setTimeout(i)};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",f),window.addEventListener("keyup",f),window.addEventListener("mousedown",f),window.addEventListener("keydown",f),window.addEventListener("change",f)):(document.documentElement.attachEvent("onmouseup",f),document.documentElement.attachEvent("onkeyup",f),document.documentElement.attachEvent("onmousedown",f),document.documentElement.attachEvent("onkeydown",f),document.documentElement.attachEvent("onchange",f)))}return n.patches=[],n.object=e,n.unobserve=function(){p(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(o,n),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",f),window.removeEventListener("keyup",f),window.removeEventListener("mousedown",f),window.removeEventListener("keydown",f)):(document.documentElement.detachEvent("onmouseup",f),document.documentElement.detachEvent("onkeyup",f),document.documentElement.detachEvent("onmousedown",f),document.documentElement.detachEvent("onkeydown",f)))},o.observers.set(t,new s(t,n)),n},t.generate=p,t.compare=function(e,t){var n=[];return f(e,t,n,""),n}},function(e,t,n){var r=Array.prototype.slice,o=n(5),a=n(4),i=e.exports=function(e,t,n){return n||(n={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=S()(e)&&"object"!=S()(t)?n.strict?e===t:e==t:function(e,t,n){var s,p;if(c(e)||c(t))return!1;if(e.prototype!==t.prototype)return!1;if(a(e))return!!a(t)&&(e=r.call(e),t=r.call(t),i(e,t,n));if(u(e)){if(!u(t))return!1;if(e.length!==t.length)return!1;for(s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}try{var f=o(e),l=o(t)}catch(e){return!1}if(f.length!=l.length)return!1;for(f.sort(),l.sort(),s=f.length-1;s>=0;s--)if(f[s]!=l[s])return!1;for(s=f.length-1;s>=0;s--)if(p=f[s],!i(e[p],t[p],n))return!1;return S()(e)===S()(t)}(e,t,n))};function c(e){return null==e}function u(e){return!(!e||"object"!==S()(e)||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}},function(e,t){var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function r(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function o(e){return e&&"object"==S()(e)&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=n?r:o).supported=r,t.unsupported=o},function(e,t){function n(e){var t=[];for(var n in e)t.push(n);return t}(e.exports="function"==typeof Object.keys?Object.keys:n).shim=n}]),R=function(){var e=e||{};e.transform=function(e,n){var r=[];r=r.concat.apply(r,n);var o=JSON.parse(JSON.stringify(e));return r.reduce(t,o)},e.transformAgainstSingleOp=function(e,t){};var t=function(e,t){if(void 0===t.value&&("add"===t.op||"replace"===t.op||"test"===t.op))throw new Error("'value' MUST be defined");if(void 0===t.from&&("copy"===t.op||"move"===t.op))throw new Error("'from' MUST be defined");if(n[t.op])if("function"==typeof n[t.op])n[t.op](t,e);else for(var r=e.length,o=0;o<r;){var a=e[o];o++,n[t.op][a.op]&&n[t.op][a.op](t,a)}return e},n={remove:function(e,t){for(var n,a=t.length,i=0;n=t[i];)("add"!==n.op&&"test"!==n.op||e.path!==n.path)&&(n.from&&(n.from===e.path||0===n.from.indexOf(e.path+"/"))||e.path===n.path||0===n.path.indexOf(e.path+"/"))&&(t.splice(i,1),a--,i--),i++;var c=e.path.lastIndexOf("/");if(c>-1){var u=e.path.substr(c+1),s=e.path.substr(0,c+1);if(o(u))for(a=t.length,i=0;i<a;)n=t[i],i++,0===n.path.indexOf(s)&&(n.path=r(n.path,s,u,-1)),n.from&&0===n.from.indexOf(s)&&(n.from=r(n.from,s,u,-1))}},add:function(e,t){for(var n,a=t.length,i=0;n=t[i];)("add"!==n.op&&"test"!==n.op||e.path!==n.path)&&(n.from&&(n.from===e.path||0===n.from.indexOf(e.path+"/"))||e.path===n.path||0===n.path.indexOf(e.path+"/"))&&(t.splice(i,1),a--,i--),i++;var c=e.path.lastIndexOf("/");if(c>-1){var u=e.path.substr(c+1),s=e.path.substr(0,c+1);if(o(u))for(a=t.length,i=0;i<a;)n=t[i],i++,0===n.path.indexOf(s)&&(n.path=r(n.path,s,u,1)),n.from&&0===n.from.indexOf(s)&&(n.from=r(n.from,s,u,1))}},replace:function(e,t){for(var n,r=0;n=t[r];)(n.from&&(n.from===e.path||0===n.from.indexOf(e.path+"/"))||0===n.path.indexOf(e.path+"/"))&&(t.splice(r,1),r--),r++}};function r(e,t,n,r){var a=e.substr(t.length),i=a.indexOf("/");i>-1||(i=a.length);var c=a.substr(0,i),u=a.substr(i);return o(c)&&r>0&&c>=n||r<0&&c>n?t+(parseInt(c)+r)+u:e}function o(e){var t=~~Number(e);return String(t)===e&&t>=0}return e}(),L=function(){function e(t){var n=t.resource,r=t.batchId,a=void 0===r?null:r,i=t.socket,c=void 0===i?null:i;o()(this,e),F(n),this.batchId=a||V(n),this.resource=n,this.socket=c,this.patches=z(n,this.batchId),q(this.resource,this.patches)}return p()(e,[{key:"hasBeenCommitted",value:function(){U(this.resource,this.patches)}}]),e}(),J=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.defineProperty(e,"[[attributes]]",{writable:!0,enumerable:!1,value:n}),Object.defineProperty(e,"[[base]]",{writable:!0,enumerable:!1,value:D.deepClone(n)}),Object.defineProperty(e,"[[patches]]",{writable:!0,enumerable:!1,value:[]}),Object.defineProperty(e,"[[batch]]",{writable:!0,enumerable:!1,value:1}),Object.defineProperty(e,"[[syncRate]]",{writable:!0,enumerable:!1,value:0}),Object.defineProperty(e,"toJSON",{value:function(){return this["[[attributes]]"]}}),Q(e,n),e.on("Δ.change",(function(){t&&clearTimeout(t),t=setTimeout((function(){e.uid&&e.emit("Δ.sync",new L({resource:e}))}),e["[[syncRate]]"])})),e.on("Δ.sync",(function(t){var n=t.socket,r=t.patches,o=t.batchId;t.resource;G[e.uid]&&G[e.uid].forEach((function(e){var t=e.socket,o=e.resource;if(n!=t)try{B(o,r),t.emit("".concat(o.uid,".mergePatches"),r)}catch(e){}})),n&&n.emit("".concat(e.uid,".mergeBatch"),o)})),M[e.uid]&&D.applyPatch(n,M[e.uid])},M={},q=function(e,t){var n;M[e.uid]=M[e.uid]||[],(n=M[e.uid]).push.apply(n,k()(t))},U=function(e,t){M[e.uid]=M[e.uid].filter((function(e){return!t.includes(e)}))},F=function(e){if(!e["[[patches]]"])return[];var t=[];return e["[[patches]]"].forEach((function(n){var r=!n.staged;n.batchId||(n.batchId=e["[[batch]]"]),r&&(n.staged=!0,t.push(n))})),t},B=function(e,t){return e["[[patches]]"]=R.transform(e["[[patches]]"],t),Y(e,t)},V=function(e){return e["[[batch]]"]++},z=function(e,t){var n=e["[[patches]]"].filter((function(e){return e.batchId===t}));return e["[[patches]]"]=e["[[patches]]"].filter((function(e){return e.batchId!==t})),Y(e,n)},H=function(e,t){var n=JSON.stringify(t);e["[[patches]]"]=e["[[patches]]"].filter((function(e){return!n.includes(JSON.stringify(e))}));var r=D.deepClone(e["[[base]]"]);D.applyPatch(r,e["[[patches]]"]),e["[[attributes]]"]=r,Q(e,r)},W=function(e,t){var n;return e&&e["[[patches]]"]?(D.applyPatch(e["[[attributes]]"],t),(n=e["[[patches]]"]).push.apply(n,k()(t)),t):[]},Y=function(e,t){D.applyPatch(e["[[base]]"],t);var n=D.deepClone(e["[[base]]"]);return D.applyPatch(n,e["[[patches]]"]),e["[[attributes]]"]=n,Q(e,n),e.emit("Δ.rebase",e["[[base]]"]),t},K=function(e,t){var n=D.deepMerge(e["[[attributes]]"],t["[[attributes]]"]),r=D.deepMerge(e["[[base]]"],t["[[base]]"]);D.applyPatch(n,e["[[patches]]"]),e["[[base]]"]=r,e["[[attributes]]"]=n,Q(e,n),e.emit("Δ.rebase",e["[[base]]"])},Q=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(g.each)(t,(function(t,r){r&&r.on&&(r.on("Δ.rebase",(function(r){var o=e["[[base]]"];!1!==n&&(o=o[n]),o[t]=r})),r.on("Δ.change",(function(n){var r,o=n.map((function(e){return{op:e.op,path:"/".concat(t).concat(e.path),value:e.value}}));(r=e["[[patches]]"]).push.apply(r,k()(o)),e.emit("Δ.change",o)})))}))},G={},X=function(e){var t={},n=e.session;return{cache:function(r){t[r.uid]?K(t[r.uid],r):(G[r.uid]=G[r.uid]||[],G[r.uid].push({resource:r,get socket(){return e.socket}}),t[r.uid]=r,e.socket.on("".concat(r.uid,".sync"),function(){var t=A()(P.a.mark((function t(o){var a,i,c,u,s,p;return P.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=o.batchId,i=o.patches,o.attributes,c=o.respond,console.log(r),t.next=4,$(r,i,n);case 4:u=t.sent,s=u.updateSuccessful,p=u.invalidPatches,c({updateSuccessful:s,invalidPatches:p}),r.emit("Δ.sync",new L({resource:r,batchId:a,socket:e.socket}));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()))},getCached:function(){var e=A()(P.a.mark((function e(n){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t[n]);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},$=function(){var e=A()(P.a.mark((function e(t,n,r){var o,a,i;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=[],a=[],e.next=4,Object(g.eachAsync)(n,function(){var e=A()(P.a.mark((function e(n,i){var c,u,s,p,f;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=i.path.split("/").slice(1),u=w()(c,1),s=u[0],p=Object(g.getMetadata)(t,s),f=p.writeAccessTest,p.namespace,void 0!==f){e.next=6;break}o.push(i),e.next=10;break;case 6:return e.next=8,f.call(t,{session:r,resource:t});case 8:e.sent?o.push(i):a.push(i);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 4:return W(t,o),i=o.length===n.length,e.abrupt("return",{updateSuccessful:i,validPatches:o,invalidPatches:a});case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Z=Symbol(),ee=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o()(this,t),e=i()(this,d()(t).call(this)),J(u()(e),n),e}return l()(t,e),p()(t,[{key:"emit",value:function(e){for(var n,r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return this[Z]&&"Δ.change"==e?null:(n=b()(d()(t.prototype),"emit",this)).call.apply(n,[this,e].concat(o))}},{key:"startBatchUpdate",value:function(){this[Z]=!0}},{key:"commitBatchUpdate",value:function(){this[Z]=!1,this.emit("Δ.change")}}],[{key:"on",value:function(e,t){var n=this;return e=Array.isArray(e)?e.map((function(e){return"".concat(n.name,".").concat(e)})):"".concat(this.name,".").concat(e),this.events.on(e,t)}},{key:"emit",value:function(e){var t;console.log("Emitting: ".concat(this.name,".").concat(e));for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return(t=this.events).emit.apply(t,["".concat(this.name,".").concat(e)].concat(r))}},{key:"nowAndOn",value:function(e,t){var n=this;return e=Array.isArray(e)?e.map((function(e){return"".concat(n.name,".").concat(e)})):"".concat(this.name,".").concat(e),this.events.nowAndOn(e,t)}}]),p()(t,[{key:"set",value:function(e){var t,n=[];Object(g.each)(e,(function(e,t){var r={op:"replace",path:"/".concat(e),value:t};n.push(r)})),this.emit("Δ.change",n),(t=this["[[patches]]"]).push.apply(t,n),Object.assign(this["[[attributes]]"],e)}},{key:"uid",get:function(){return void 0!==this.id?"".concat(this.constructor.name,".").concat(this.id):null}},{key:"validation",get:function(){return this["[[validation]]"].for(this)}}]),t}(g.EventEmitter);function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(Object(n),!0).forEach((function(t){y()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}y()(ee,"events",new g.EventEmitter),Object.defineProperty(ee.prototype,"[[validation]]",{writable:!0,enumerable:!1,value:(N={},{handlers:N,for:function(e){e["[[validationState]]"]||Object.defineProperty(e,"[[validationState]]",{enumerable:!1,value:{}});var t=e["[[validationState]]"],n=function(e){return r(e).length>0},r=function(t){var n=N[t];if(void 0!==n){var r=e[t],o=[],a=Object(g.toTitleCase)(t);return n.forEach((function(t){return t.call(e,{property:r,label:a,errors:o,resource:e})})),o}return[]},o={addHandler:function(e,t){N[e]=N[e]||[],N[e].push(t)},errorMessageFor:function(e){var t=r(e);if(0===t.length)return" ";if(1===t.length)return"".concat(Object(g.toTitleCase)(e)," ").concat(t[0]);var n=t.pop();return"".concat(Object(g.toTitleCase)(e)," ").concat(t.join(", ")," and ").concat(n)},shouldShowErrorsFor:function(e){return!0===t[e]&&n(e)},showErrorsFor:function(n){t[n]=!0,e.emit("Δ.change")},hideErrorsFor:function(e){t[e]=!1},showAllErrors:function(){Object(g.each)(N,(function(e){t[e]=!0})),e.emit("Δ.change")},hideAllErrors:function(){Object(g.each)(N,(function(e){t[e]=!1})),e.emit("Δ.change")},get isInvalid(){var e=!1;return Object(g.each)(N,(function(t){e=e||n(t)})),e},get isValid(){return!o.isInvalid}};return o}})});var re=["String","Boolean","Number","Date","Function"],oe=[Object.prototype,Function.prototype,ee.prototype,ee,g.EventEmitter.prototype,void 0,null],ae=function(e){return"function"==typeof e?["length","name","prototype"]:["constructor","[[attributes]]","[[patches]]","[[base]]","[[batch]]","[[validation]]"]},ie=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=new g.EventEmitter,n=function(){if(!pe(e))throw Error("$interface must be a plain JavaScript Object");var n=r("global",e);return Object.defineProperty(n,"emit",{enumerable:!1,value:function(){return t.emit.apply(t,arguments)}}),n},r=function e(t,n){for(var r={},a={},s=function(e){Object(g.each)(Object.getOwnPropertyDescriptors(e),(function(t,o){ae(e).includes(t)||(a[t]=n[t],r[t]=o)}))},p=n;!oe.includes(p);p=p.__proto__)s(p);return{type:"object",attributes:Object(g.map)(a,(function(a,s){var p=r[a],f=Object(g.getMetadata)(n,a);return ce(s,p)?o("".concat(t,"/").concat(a),s,p,f,n,a):pe(s,p)?e("".concat(t,"/").concat(a),s):fe(s,p)?i("".concat(t,"/").concat(a),s,p,f,n,a):le(s,p)?c("".concat(t,"/").concat(a),s,p,f,n,a):he(s,p)?u("".concat(t,"/").concat(a),s,p,f,n,a):void 0}))}},o=function(e,t){var n=new t;return{name:e,type:"class",className:t.name,classMethods:a(e,t),instanceMethods:a("".concat(e,"/#"),n)}},a=function(e,t){for(var n={},o=function(e){Object(g.each)(Object.getOwnPropertyDescriptors(e),(function(t,r){ae(e).includes(t)||(n[t]=r)}))},a=t;!oe.includes(a);a=a.__proto__)o(a);return Object(g.map)(n,(function(n,o){var a=Object(g.getMetadata)(t,n);return pe(o.value,o)?r("".concat(e,"/").concat(n),o.value,o,a,t,n):fe(o.value,o)?i("".concat(e,"/").concat(n),o.value,o,a,t,n):le(o.value,o)?c("".concat(e,"/").concat(n),o.value,o,a,t,n):he(o.value,o)?u("".concat(e,"/").concat(n),o.value,o,a,t,n):void 0}))},i=function(e,n,r,o,a){var i=o.isShared,c=o.readAccessTest,u=o.usesSession,s=o.isStream,p=o.original;return i?{isStream:s,name:e,type:"shared-function",value:s?p.toString():n.toString()}:(t.on(e,function(){var e=A()(P.a.mark((function e(t){var r,o,i,s,p,f,l,h,d,v,b,m,y,g,O,w;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.args,t.uid,o=t.attributes,i=t.patches,s=t.connection,p=t.send,f=t.onClose,s.cache=s.cache||X(s),l=s.session,h="function"==typeof a?a:new a.constructor(o),e.next=6,$(h,i,l);case 6:if(d=e.sent,v=d.updateSuccessful,b=d.invalidPatches,v){e.next=11;break}return e.abrupt("return",p({error:!0,invalidPatches:b,message:"You are not authorized to update the resource as requested"}));case 11:if(e.t0=void 0!==c,!e.t0){e.next=16;break}return e.next=15,c.call(h,{session:l,resource:h});case 15:e.t0=!e.sent;case 16:if(!e.t0){e.next=18;break}return e.abrupt("return",p({error:!0,message:"You are not authorized to call this method"}));case 18:g=s.session.createSlice(),O=function(){var e=A()(P.a.mark((function e(t,n){var r,o,a,i;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u&&y.save(),r=s.cache,o=g,a=function(){return O(t,n)},e.next=6,be(t,{cache:r,session:o,callback:a});case 6:i=e.sent,p(i,n);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),u&&(y=s.session.createSlice(),r.unshift(y),y.onChange((function(){return w()}))),(w=function(){m&&m.destroy&&m.destroy();try{m=n.apply(h,r)}catch(e){p({error:!0,message:e.message})}m&&m.catch&&m.catch((function(e){return p({error:!0,message:e.message})})),de(m)?(m.observe((function(e){return O(e,!0)})),f((function(){m.destroy(),y&&y.removeListeners(),g&&g.removeListeners()}))):ve(m)?m.then((function(e){return O(e)})):O(m)})();case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),{name:e,type:"remote-function"})},c=function(e,t,n,r,o,a){var c=r.validators;return{name:e,key:a,type:"property",enumerable:n.enumerable,get:i("".concat(e,".get"),n.get||function(){return null},n,r,o),set:i("".concat(e,".set"),n.set||function(){return null},n,r,o),validators:c&&c.map((function(e){return e.toString()}))}},u=function(e,t,n,r,o,a){var i=r.validators;return{name:e,key:a,type:"attribute",value:n.value,validators:i&&i.map((function(e){return e.toString()}))}};return n()},ce=function(e){return"function"==typeof e&&e.prototype instanceof ee},ue=function(e){return e instanceof ee},se=function(e){return Array.isArray(e)},pe=function(e){return e&&e.__proto__===Object.prototype},fe=function(e){return"function"==typeof e&&!ce(e)},le=function(e,t){return"function"==typeof t.get||"function"==typeof t.set},he=function(e,t){return[ce,pe,fe,le].every((function(n){return!n(e,t)}))},de=function(e){return e&&"function"==typeof e.observe},ve=function(e){return e&&"function"==typeof e.then&&!de(e)},be=function(){var e=A()(P.a.mark((function e(t,n){var r,o,a,i;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.cache,o=n.session,a=n.callback,i=function(e){return be(e,{cache:r,session:o,callback:a})},t){e.next=4;break}return e.abrupt("return",t);case 4:if(!ce(t)){e.next=6;break}return e.abrupt("return",{_class_:t.name});case 6:if(c=t,!re.includes(c.constructor.name)){e.next=8;break}return e.abrupt("return",t);case 8:if(!se(t)){e.next=12;break}return e.next=11,Promise.all(t.map((function(e,t){return i(e)})));case 11:return e.abrupt("return",e.sent);case 12:if(!pe(t)){e.next=16;break}return e.next=15,Object(g.mapAsync)(t,(function(e,t){return i(t)}));case 15:return e.abrupt("return",e.sent);case 16:if(r.cache(t),!ue(t)){e.next=25;break}return e.t0=ne,e.t1={},e.next=22,Object(g.mapAsync)(t["[[attributes]]"],function(){var e=A()(P.a.mark((function e(n,r){var c,u,s,p,f;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=Object(g.getMetadata)(t,n),u=c.readAccessTest,s=c.namespace,void 0!==u){e.next=8;break}return e.next=5,i(r);case 5:return e.abrupt("return",e.sent);case 8:return o.onChange(a),p=t,(f=u.call(p,{session:o,resource:p}))instanceof Promise&&config.audit&&console.warn("Running Asynchronous Authentication Checks for ".concat(s," during serailization")),e.next=14,f;case 14:if(e.sent){e.next=18;break}return e.abrupt("return",null);case 18:return e.next=20,i(r);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 22:return e.t2=e.sent,e.t3={_proto_:t.constructor.name},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 25:case"end":return e.stop()}var c}),e)})));return function(t,n){return e.apply(this,arguments)}}(),me=n(17),ye=n.n(me),ge=n(15),Oe=n.n(ge),we=["String","Boolean","Number","Date","Function"],Ee=function(e){var t=Pe({socket:e}),n={Resource:ee,List:C},r=function(e){var t=function(e){function t(){return o()(this,t),i()(this,d()(t).apply(this,arguments))}return l()(t,e),t}(ee);return Object.defineProperty(t,"name",{value:e.className}),a(t,e.classMethods),a(t.prototype,e.instanceMethods),t},a=function e(t,n){return Object(g.each)(n,(function(n,o){switch(o.type){case"class":t[n]=r(o);break;case"object":t[n]=e({},o.attributes);break;case"shared-function":t[n]=u(o);break;case"remote-function":t[n]=s(o);break;case"property":p(t,n,o);break;case"attribute":t[n]=f(o,t)}})),t},c=function(e){switch(e.type){case"shared-function":return u(e);case"remote-function":return s(e)}},u=function(e){var t=e.isStream,n=(e.prependEmit,e.value),r=new Function("return ".concat(n))();return t?function(e){var t=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return e.call.apply(e,[this].concat(r,[t]))};return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Oe()(g.Pipe,[[this,t]].concat(n))}}(r):r};var s=function(t){var n=t.name,r=function(t,r){var o,a=this.uid,i=this["[[attributes]]"],c=F(this),u=function(){return t(o)},s=function(e){var n=e.value;n&&n.error&&(n.invalidPatches,t.throw(new Error(n.message))),o=h(n,u),t(o)},p=function(n){e.on(n,s),t.pipe.onCancel((function(){e.removeEventListener(n,s),e.emit("".concat(n,".destroy"))}))};e.emit(n,{uid:a,patches:c,args:r,attributes:i},(function(e){var t=e.value,n=e.hook;s({value:t}),void 0!==n&&p(n)}))};return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new g.Pipe([this,r],t)}},p=function(e,t,n){var r=e.validation;r&&n.validators&&n.validators.forEach((function(e){r.addHandler(n.key,u({value:e}))})),Object.defineProperty(e,t,{enumerable:n.enumerable,get:c(n.get),set:c(n.set)})},f=function(e,t){var n=t.validation;return n&&e.validators&&e.validators.forEach((function(t){n.addHandler(e.key,u({value:t}))})),e.value},h=function e(r,o){var a=function(t){return e(t,o)};if(!r)return r;if(we.includes(r.constructor.name))return r;if(Array.isArray(r))return Oe()(C,k()(r.map((function(e){return a(e)}))));var i=r._class_,c=r._proto_,u=ye()(r,["_class_","_proto_"]);return i?n[i]:c?t.register(new n[c](Object(g.map)(u,(function(e,t){return a(t)}))),o):Object(g.map)(u,(function(e,t){return a(t)}))};return function(e){if("object"!==S()(e))throw Error("schema must be a plain JavaScript Object");return a(n,e.attributes)}},Pe=function(e){var t=e.socket,n={};return window.bin=n,{register:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;if(n[e.uid])n[e.uid].callbacks.includes(r)||n[e.uid].callbacks.push(r),K(n[e.uid].resource,e),e=n[e.uid].resource;else{var o=function(){n[e.uid].callbacks.forEach((function(e){return e()}))};e.on("Δ.change",(function(){return o()})),e.on("Δ.sync",(function(n){var r=n.patches,a=V(e);t.emit("".concat(e.uid,".sync"),{patches:r,batchId:a},(function(t){var n=t.updateSuccessful,r=t.invalidPatches;n||(H(e,r),o())}))})),t.on("".concat(e.uid,".mergeBatch"),(function(t){z(e,t)})),t.on("".concat(e.uid,".mergePatches"),(function(t){B(e,t),o()})),n[e.uid]={resource:e,callbacks:[r]}}return e}}},je={},Ae=function(e){return je[e]?je[e]:je[e]=new g.EventEmitter},_e=function(e){return function e(t,n){var r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return null};o()(this,e),this["[[attributes]]"]=t,this["[[agent]]"]=n||Ae(t.id),this["[[callback]]"]=a,this["[[pipes]]"]=r}return p()(e,[{key:"onChange",value:function(e){var t=this;this["[[callback]]"]=function(n){n!==t&&(Object.assign(t["[[attributes]]"],n["[[attributes]]"]),e())}}},{key:"createSlice",value:function(){return new e(this["[[attributes]]"],this["[[agent]]"])}},{key:"removeListeners",value:function(){this["[[pipes]]"].forEach((function(e){return e.destroy()}))}},{key:"save",value:function(){Object(g.each)(this,(function(e,t){if(!["[[pipes]]","[[agent]]","[[callback]]","[[attributes]]"].includes(e))throw Error("Tried to assign ".concat(e," to the session. Session properties must be initialized when 'serve' is invoked. This will result in unpredictable behavior."))})),this["[[attributes]]"].save()}},{key:"id",get:function(){return this["[[attributes]]"].id}}]),e}();return Object(g.each)(t,(function(t,o){if("object"===S()(o)&&null!==o){var a=e(o,"".concat(n,".").concat(t));Object.defineProperty(r.prototype,t,{get:function(){return new a(this["[[attributes]]"][t],this["[[agent]]"],this["[[pipes]]"],this["[[callback]]"])}})}else Object.defineProperty(r.prototype,t,{get:function(){var e=this["[[agent]]"].on("".concat(n,".").concat(t),this["[[callback]]"]);return this["[[pipes]]"].find((function(t){return t.isEqual(e)}))?e.destroy():this["[[pipes]]"].push(e),this["[[attributes]]"][t]},set:function(e){this["[[attributes]]"][t]=e,this["[[agent]]"].emit("".concat(n,".").concat(t),this)}})})),r}(e,"session")},ke=n(18),xe=n(9),Se=n.n(xe),Te=n(19),Ce=n.n(Te),Ie=n(20),Ne=n.n(Ie);function De(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Re=n(21),Le=n(22),Je=Le(),Me=n(23).Server(Je),qe=n(24)(Me,{serveClient:!1}),Ue=n(25),Fe=n(26),Be=n(27),Ve="".concat("./.storage","/sessions"),ze="".concat("./.storage","/uploads");Se.a.existsSync(Ve)||Se.a.mkdirSync(Ve),Se.a.existsSync(ze)||Se.a.mkdirSync(ze);var He=n(28),We=new(n(29)(He))({path:Ve}),Ye=function(e){return Ue(Object(g.deepMerge)({origin:function(t,n){!e.useWhiteList||e.clientWhitelist.includes(t)?n(null,t):n(null,"")},credentials:!0},e))},Ke=function(e,t,n){e.hostname.includes("localhost")||"http"!==e.headers["x-forwarded-proto"]?n():t.redirect("https://".concat(e.hostname).concat(e.originalUrl))},Qe={port:process.env.BACKEND_PORT||8080,models:{},session:{},database:{user:process.env.DB_USER||"Josephine",password:process.env.DB_PASSWORD||"P00p!",database:process.env.DB_NAME||"Josephine",port:process.env.DB_PORT||5432},sessionStorage:{secret:process.env.SESSION_SECRET||"keyboard cat",store:We,resave:!0,saveUninitialized:!0},cors:{useWhiteList:process.env.USE_CORS_WHITE_LIST||!0,clientWhitelist:process.env.CORS_WHITE_LIST||[]}};function Ge(e){return Xe.apply(this,arguments)}function Xe(){return(Xe=A()(P.a.mark((function e(t){var n,r,o,a,i,c,u,s;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(g.deepMerge)(Qe,t),r="function"==typeof n.models?ot(n.models):n.models,e.next=4,Object(ke.connect)(n.database);case 4:o=Ye(n.cors),a=Fe(),i=He(n.sessionStorage),c=_e(n.session),u=ie(r),s=nt(u,c),Je.use(Ke),Je.use(i),Je.use(a),Je.use(o),Je.use(Le.static(Re.resolve("./public"))),Je.get("/init",(function(e,t){return t.json({ok:!0})})),Je.post("/upload",et),Je.get("/cdn*",Ze),Je.get("/*",$e),qe.use((function(e,t){return i(e.request,e.request.res,t)})),qe.on("connection",s),Me.listen(n.port),console.log("Listening on ".concat(n.port));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $e=function(e,t){t.sendFile(Re.resolve("./public/index.html"))},Ze=function(e,t){var n=e.url.replace("/cdn","".concat(ze,"/")),r=n.split(".").pop(),o=Se.a.statSync(n),a=Ce.a.getType(r);t.writeHead(200,{"Content-Type":a,"Content-Length":o.size}),Se.a.createReadStream(n).pipe(t)},et=function(e,t){var n=new Be.IncomingForm,r=[];n.parse(e,(function(e,n,o){Object.values(o).forEach((function(e){var t=e.name.split(".").pop(),n="".concat(rt(),".").concat(t);r.push("/cdn/".concat(n)),Ne()(e.path,"".concat(ze,"/").concat(n))})),t.end(JSON.stringify(r))}))},tt={},nt=function(e,t){return function(n){var r,o=new t(n.request.session),a=0;tt[o.id]?tt[o.id].sockets.includes(n.id)||(tt[o.id].sockets.push(n.id),r=tt[o.id].internal,n.use((function(e,t){var n=w()(e,3),o=n[0],a=n[1],i=n[2];a.respond=i,r.emit(o,a),t()})),r.on("*",(function(e,t){n.emit(t,e)}))):(r=new g.EventEmitter,tt[o.id]={internal:r,sockets:[n.id]},n.use((function(e,t){var n=w()(e,3),o=n[0],a=n[1],i=n[2];a.respond=i,r.emit(o,a),t()})),r.on("*",(function(e,t){n.emit(t,e)})));var i={get socket(){return r},session:o};n.use((function(t,o){var c=w()(t,3),u=c[0],s=c[1],p=c[2],f=function(){return null},l=!1,h=!1;e.emit(u,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?De(Object(n),!0).forEach((function(t){y()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},s,{connection:i,send:function(e,t){l?r.emit(h,{value:e}):(l=!0,t?(h="".concat(a++,": ").concat(u),n.on("".concat(h,".destroy"),(function(){return f()})),p({value:e,hook:h})):p({value:e}))},onClose:function(e){return f=e}})),o()})),n.emit("interface",e)}},rt=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length,r=0;r<12;r++)e+=t.charAt(Math.floor(Math.random()*n));return e};function ot(e){var t={};return e.keys().forEach((function(n){if(!n.includes("__")){var r=n.replace(".js","").split("/").pop(),o=e(n);o[r]&&(t[r]=o[r])}})),t}}]);