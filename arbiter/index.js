module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=81)}([function(e,t){e.exports=require("triframe/core")},function(e,t){e.exports=require("@babel/runtime/helpers/classCallCheck")},function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/createClass")},function(e,t){e.exports=require("@babel/runtime/helpers/getPrototypeOf")},function(e,t){e.exports=require("@babel/runtime/helpers/typeof")},function(e,t){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,t){e.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("@babel/runtime/helpers/inherits")},function(e,t){e.exports=require("@babel/runtime/helpers/assertThisInitialized")},function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/toConsumableArray")},function(e,t){e.exports=require("@babel/runtime/helpers/get")},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var n=r(56),i=r(57),o=r(58);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,r){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return u(this,e,t,r)}function u(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=l(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!c.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|d(t,r),i=(e=a(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(c.isBuffer(t)){var r=0|p(t.length);return 0===(e=a(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?a(e,0):l(e,t);if("Buffer"===t.type&&o(t.data))return l(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function f(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(f(t),e=a(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function l(e,t){var r=t.length<0?0:0|p(t.length);e=a(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function p(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function d(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return M(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Z(e).length;default:if(n)return M(e).length;t=(""+t).toLowerCase(),n=!0}}function v(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,r);case"utf8":case"utf-8":return x(this,t,r);case"ascii":return P(this,t,r);case"latin1":case"binary":return A(this,t,r);case"base64":return k(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function _(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:m(e,t,r,n,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):m(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,r,n,i){var o,s=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var f=-1;for(o=r;o<a;o++)if(u(e,o)===u(t,-1===f?0:o-f)){if(-1===f&&(f=o),o-f+1===c)return f*s}else-1!==f&&(o-=o-f),f=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){for(var h=!0,l=0;l<c;l++)if(u(e,o+l)!==u(t,l)){h=!1;break}if(h)return o}return-1}function g(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function b(e,t,r,n){return q(M(t,e.length-r),e,r,n)}function w(e,t,r,n){return q(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function E(e,t,r,n){return w(e,t,r,n)}function O(e,t,r,n){return q(Z(t),e,r,n)}function S(e,t,r,n){return q(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function k(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function x(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,c,u=e[i],f=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=r)switch(h){case 1:u<128&&(f=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(f=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(f=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(f=c)}null===f?(f=65533,h=1):f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),i+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,r){return u(null,e,t,r)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,r){return function(e,t,r,n){return f(t),t<=0?a(e,t):void 0!==r?"string"==typeof n?a(e,t).fill(r,n):a(e,t).fill(r):a(e,t)}(null,e,t,r)},c.allocUnsafe=function(e){return h(null,e)},c.allocUnsafeSlow=function(e){return h(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=c.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},c.byteLength=d,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)_(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)_(this,t,t+3),_(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)_(this,t,t+7),_(this,t+1,t+6),_(this,t+2,t+5),_(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?x(this,0,e):v.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,r,n,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(o,s),u=this.slice(n,i),f=e.slice(t,r),h=0;h<a;++h)if(u[h]!==f[h]){o=u[h],s=f[h];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return g(this,e,t,r);case"utf8":case"utf-8":return b(this,e,t,r);case"ascii":return w(this,e,t,r);case"latin1":case"binary":return E(this,e,t,r);case"base64":return O(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function P(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function T(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=F(e[o]);return i}function R(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function L(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function I(e,t,r,n,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function N(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function D(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function C(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function j(e,t,r,n,o){return o||C(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function U(e,t,r,n,o){return o||C(e,0,r,8),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;r=new c(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},c.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},c.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},c.prototype.readUInt8=function(e,t){return t||L(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||L(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||L(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||L(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){t||L(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||I(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},c.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||I(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},c.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);I(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);I(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,r){return j(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return j(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return U(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return U(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},c.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=c.isBuffer(e)?e:M(new c(e,n).toString()),a=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function M(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function Z(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(B,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(55))},function(e,t){e.exports=require("fs")},function(e,t,r){"use strict";r.r(t),function(e){t.default={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:e.alloc(0),NOOP:function(){}}}.call(this,r(13).Buffer)},function(e,t){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,t){e.exports=require("http")},function(e,t,r){"use strict";r.r(t),function(e){var n=r(6),i=r.n(n),o=r(1),s=r.n(o),a=r(3),c=r.n(a);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h,l=r(59),p=r(19).default,d=r(72).default,v=r(15).default,_=v.kStatusCode,y=v.NOOP,m=e.from([0,0,255,255]),g=Symbol("permessage-deflate"),b=Symbol("total-length"),w=Symbol("callback"),E=Symbol("buffers"),O=Symbol("error"),S=function(){function e(t,r,n){if(s()(this,e),this._maxPayload=0|n,this._options=t||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!h){var i=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;h=new d(i)}}return c()(e,[{key:"offer",value:function(){var e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}},{key:"accept",value:function(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}},{key:"cleanup",value:function(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){var e=this._deflate[w];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}},{key:"acceptAsServer",value:function(e){var t=this._options,r=e.find((function(e){return!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits)}));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(r.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?r.client_max_window_bits=t.clientMaxWindowBits:!0!==r.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete r.client_max_window_bits,r}},{key:"acceptAsClient",value:function(e){var t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}},{key:"normalizeParams",value:function(e){var t=this;return e.forEach((function(e){Object.keys(e).forEach((function(r){var n=e[r];if(n.length>1)throw new Error('Parameter "'.concat(r,'" must have only a single value'));if(n=n[0],"client_max_window_bits"===r){if(!0!==n){var i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError('Invalid value for parameter "'.concat(r,'": ').concat(n));n=i}else if(!t._isServer)throw new TypeError('Invalid value for parameter "'.concat(r,'": ').concat(n))}else if("server_max_window_bits"===r){var o=+n;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError('Invalid value for parameter "'.concat(r,'": ').concat(n));n=o}else{if("client_no_context_takeover"!==r&&"server_no_context_takeover"!==r)throw new Error('Unknown parameter "'.concat(r,'"'));if(!0!==n)throw new TypeError('Invalid value for parameter "'.concat(r,'": ').concat(n))}e[r]=n}))})),e}},{key:"decompress",value:function(e,t,r){var n=this;h.add((function(i){n._decompress(e,t,(function(e,t){i(),r(e,t)}))}))}},{key:"compress",value:function(e,t,r){var n=this;h.add((function(i){n._compress(e,t,(function(e,t){i(),r(e,t)}))}))}},{key:"_decompress",value:function(e,t,r){var n=this,i=this._isServer?"client":"server";if(!this._inflate){var o="".concat(i,"_max_window_bits"),s="number"!=typeof this.params[o]?l.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=l.createInflateRaw(f({},this._options.zlibInflateOptions,{windowBits:s})),this._inflate[g]=this,this._inflate[b]=0,this._inflate[E]=[],this._inflate.on("error",P),this._inflate.on("data",x)}this._inflate[w]=r,this._inflate.write(e),t&&this._inflate.write(m),this._inflate.flush((function(){var e=n._inflate[O];if(e)return n._inflate.close(),n._inflate=null,void r(e);var o=p.concat(n._inflate[E],n._inflate[b]);t&&n.params["".concat(i,"_no_context_takeover")]?(n._inflate.close(),n._inflate=null):(n._inflate[b]=0,n._inflate[E]=[]),r(null,o)}))}},{key:"_compress",value:function(e,t,r){var n=this,i=this._isServer?"server":"client";if(!this._deflate){var o="".concat(i,"_max_window_bits"),s="number"!=typeof this.params[o]?l.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=l.createDeflateRaw(f({},this._options.zlibDeflateOptions,{windowBits:s})),this._deflate[b]=0,this._deflate[E]=[],this._deflate.on("error",y),this._deflate.on("data",k)}this._deflate[w]=r,this._deflate.write(e),this._deflate.flush(l.Z_SYNC_FLUSH,(function(){if(n._deflate){var e=p.concat(n._deflate[E],n._deflate[b]);t&&(e=e.slice(0,e.length-4)),n._deflate[w]=null,t&&n.params["".concat(i,"_no_context_takeover")]?(n._deflate.close(),n._deflate=null):(n._deflate[b]=0,n._deflate[E]=[]),r(null,e)}}))}}],[{key:"extensionName",get:function(){return"permessage-deflate"}}]),e}();function k(e){this[E].push(e),this[b]+=e.length}function x(e){this[b]+=e.length,this[g]._maxPayload<1||this[b]<=this[g]._maxPayload?this[E].push(e):(this[O]=new RangeError("Max payload size exceeded"),this[O][_]=1009,this.removeListener("data",x),this.reset())}function P(e){this[g]._inflate=null,e[_]=1007,this[w](e)}t.default=S}.call(this,r(13).Buffer)},function(e,t,r){"use strict";r.r(t),function(e){var n,i=r(15).default.EMPTY_BUFFER;function o(t,r){if(0===t.length)return i;if(1===t.length)return t[0];for(var n=e.allocUnsafe(r),o=0,s=0;s<t.length;s++){var a=t[s];n.set(a,o),o+=a.length}return o<r?n.slice(0,o):n}function s(e,t,r,n,i){for(var o=0;o<i;o++)r[n+o]=e[o]^t[3&o]}function a(e,t){for(var r=e.length,n=0;n<r;n++)e[n]^=t[3&n]}function c(e){return e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}function u(t){return u.readOnly=!0,e.isBuffer(t)?t:(t instanceof ArrayBuffer?r=e.from(t):ArrayBuffer.isView(t)?r=e.from(t.buffer,t.byteOffset,t.byteLength):(r=e.from(t),u.readOnly=!1),r);var r}try{var f=r(!function(){var e=new Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e}()),h=f.BufferUtil||f;n={concat:o,mask:function(e,t,r,n,i){i<48?s(e,t,r,n,i):h.mask(e,t,r,n,i)},toArrayBuffer:c,toBuffer:u,unmask:function(e,t){e.length<32?a(e,t):h.unmask(e,t)}}}catch(e){n={concat:o,mask:s,toArrayBuffer:c,toBuffer:u,unmask:a}}t.default=n}.call(this,r(13).Buffer)},function(e,t,r){"use strict";r.r(t);var n=r(6),i=r.n(n),o=r(5),s=r.n(o),a=r(1),c=r.n(a),u=r(3),f=r.n(u),h=r(7),l=r.n(h),p=r(4),d=r.n(p),v=r(9),_=r.n(v),y=r(8),m=r.n(y);function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var w=r(21),E=r(41),O=r(17),S=r(42),k=r(43),x=r(22),P=x.randomBytes,A=x.createHash,T=r(29).URL,R=r(18).default,L=r(24).default,I=r(25).default,N=r(15).default,D=N.BINARY_TYPES,C=N.EMPTY_BUFFER,j=N.GUID,U=N.kStatusCode,B=N.kWebSocket,F=N.NOOP,M=r(73).default,Z=M.addEventListener,q=M.removeEventListener,W=r(33).default,z=W.format,H=W.parse,Y=r(19).default.toBuffer,G=["CONNECTING","OPEN","CLOSING","CLOSED"],V=[8,13],J=function(e){function t(e,r,n){var i;return c()(this,t),(i=l()(this,d()(t).call(this))).readyState=t.CONNECTING,i.protocol="",i._binaryType=D[0],i._closeFrameReceived=!1,i._closeFrameSent=!1,i._closeMessage="",i._closeTimer=null,i._closeCode=1006,i._extensions={},i._receiver=null,i._sender=null,i._socket=null,null!==e?(i._bufferedAmount=0,i._isServer=!1,i._redirects=0,Array.isArray(r)?r=r.join(", "):"object"===s()(r)&&null!==r&&(n=r,r=void 0),K(_()(i),e,r,n)):i._isServer=!0,i}return m()(t,e),f()(t,[{key:"setSocket",value:function(e,r,n){var i=new L(this._binaryType,this._extensions,this._isServer,n);this._sender=new I(e,this._extensions),this._receiver=i,this._socket=e,i[B]=this,e[B]=this,i.on("conclude",te),i.on("drain",re),i.on("error",ne),i.on("message",oe),i.on("ping",se),i.on("pong",ae),e.setTimeout(0),e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",ce),e.on("data",ue),e.on("end",fe),e.on("error",he),this.readyState=t.OPEN,this.emit("open")}},{key:"emitClose",value:function(){if(!this._socket)return this.readyState=t.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[R.extensionName]&&this._extensions[R.extensionName].cleanup(),this._receiver.removeAllListeners(),this.readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}},{key:"close",value:function(e,r){var n=this;if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){return $(this,this._req,"WebSocket was closed before the connection was established")}this.readyState!==t.CLOSING?(this.readyState=t.CLOSING,this._sender.close(e,r,!this._isServer,(function(e){e||(n._closeFrameSent=!0,n._closeFrameReceived&&n._socket.end())})),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)):this._closeFrameSent&&this._closeFrameReceived&&this._socket.end()}}},{key:"ping",value:function(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(n=e,e=r=void 0):"function"==typeof r&&(n=r,r=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===t.OPEN?(void 0===r&&(r=!this._isServer),this._sender.ping(e||C,r,n)):ee(this,e,n)}},{key:"pong",value:function(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(n=e,e=r=void 0):"function"==typeof r&&(n=r,r=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===t.OPEN?(void 0===r&&(r=!this._isServer),this._sender.pong(e||C,r,n)):ee(this,e,n)}},{key:"send",value:function(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof r&&(n=r,r={}),"number"==typeof e&&(e=e.toString()),this.readyState===t.OPEN){var i=b({binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0},r);this._extensions[R.extensionName]||(i.compress=!1),this._sender.send(e||C,i,n)}else ee(this,e,n)}},{key:"terminate",value:function(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){return $(this,this._req,"WebSocket was closed before the connection was established")}this._socket&&(this.readyState=t.CLOSING,this._socket.destroy())}}},{key:"CONNECTING",get:function(){return t.CONNECTING}},{key:"CLOSING",get:function(){return t.CLOSING}},{key:"CLOSED",get:function(){return t.CLOSED}},{key:"OPEN",get:function(){return t.OPEN}},{key:"binaryType",get:function(){return this._binaryType},set:function(e){D.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}},{key:"bufferedAmount",get:function(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:this._bufferedAmount}},{key:"extensions",get:function(){return Object.keys(this._extensions).join()}}]),t}(w);function K(e,t,r,n){var o,s=b({protocolVersion:V[1],maxPayload:104857600,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},n,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0});if(!V.includes(s.protocolVersion))throw new RangeError("Unsupported protocol version: ".concat(s.protocolVersion," ")+"(supported versions: ".concat(V.join(", "),")"));t instanceof T?(o=t,e.url=t.href):(o=new T(t),e.url=t);var a="ws+unix:"===o.protocol;if(!(o.host||a&&o.pathname))throw new Error("Invalid URL: ".concat(e.url));var c,u="wss:"===o.protocol||"https:"===o.protocol,f=u?443:80,h=P(16).toString("base64"),l=u?E.get:O.get;if(s.createConnection=u?Q:X,s.defaultPort=s.defaultPort||f,s.port=o.port||f,s.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,s.headers=b({"Sec-WebSocket-Version":s.protocolVersion,"Sec-WebSocket-Key":h,Connection:"Upgrade",Upgrade:"websocket"},s.headers),s.path=o.pathname+o.search,s.timeout=s.handshakeTimeout,s.perMessageDeflate&&(c=new R(!0!==s.perMessageDeflate?s.perMessageDeflate:{},!1,s.maxPayload),s.headers["Sec-WebSocket-Extensions"]=z(i()({},R.extensionName,c.offer()))),r&&(s.headers["Sec-WebSocket-Protocol"]=r),s.origin&&(s.protocolVersion<13?s.headers["Sec-WebSocket-Origin"]=s.origin:s.headers.Origin=s.origin),(o.username||o.password)&&(s.auth="".concat(o.username,":").concat(o.password)),a){var p=s.path.split(":");s.socketPath=p[0],s.path=p[1]}var d=e._req=l(s);s.timeout&&d.on("timeout",(function(){$(e,d,"Opening handshake has timed out")})),d.on("error",(function(t){e._req.aborted||(d=e._req=null,e.readyState=J.CLOSING,e.emit("error",t),e.emitClose())})),d.on("response",(function(i){var o=i.headers.location,a=i.statusCode;if(o&&s.followRedirects&&a>=300&&a<400){if(++e._redirects>s.maxRedirects)return void $(e,d,"Maximum redirects exceeded");d.abort();var c=new T(o,t);K(e,c,r,n)}else e.emit("unexpected-response",d,i)||$(e,d,"Unexpected server response: ".concat(i.statusCode))})),d.on("upgrade",(function(t,n,i){if(e.emit("upgrade",t),e.readyState===J.CONNECTING){d=e._req=null;var o=A("sha1").update(h+j).digest("base64");if(t.headers["sec-websocket-accept"]===o){var a,u=t.headers["sec-websocket-protocol"],f=(r||"").split(/, */);if(!r&&u?a="Server sent a subprotocol but none was requested":r&&!u?a="Server sent no subprotocol":u&&!f.includes(u)&&(a="Server sent an invalid subprotocol"),a)$(e,n,a);else{if(u&&(e.protocol=u),c)try{var l=H(t.headers["sec-websocket-extensions"]);l[R.extensionName]&&(c.accept(l[R.extensionName]),e._extensions[R.extensionName]=c)}catch(t){return void $(e,n,"Invalid Sec-WebSocket-Extensions header")}e.setSocket(n,i,s.maxPayload)}}else $(e,n,"Invalid Sec-WebSocket-Accept header")}}))}function X(e){return e.path=e.socketPath,S.connect(e)}function Q(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=e.host),k.connect(e)}function $(e,t,r){e.readyState=J.CLOSING;var n=new Error(r);Error.captureStackTrace(n,$),t.setHeader?(t.abort(),t.once("abort",e.emitClose.bind(e)),e.emit("error",n)):(t.destroy(n),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function ee(e,t,r){if(t){var n=Y(t).length;e._socket?e._sender._bufferedBytes+=n:e._bufferedAmount+=n}r&&r(new Error("WebSocket is not open: readyState ".concat(e.readyState," ")+"(".concat(G[e.readyState],")")))}function te(e,t){var r=this[B];r._socket.removeListener("data",ue),r._socket.resume(),r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,1005===e?r.close():r.close(e,t)}function re(){this[B]._socket.resume()}function ne(e){var t=this[B];t._socket.removeListener("data",ue),t.readyState=J.CLOSING,t._closeCode=e[U],t.emit("error",e),t._socket.destroy()}function ie(){this[B].emitClose()}function oe(e){this[B].emit("message",e)}function se(e){var t=this[B];t.pong(e,!t._isServer,F),t.emit("ping",e)}function ae(e){this[B].emit("pong",e)}function ce(){var e=this[B];this.removeListener("close",ce),this.removeListener("end",fe),e.readyState=J.CLOSING,e._socket.read(),e._receiver.end(),this.removeListener("data",ue),this[B]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",ie),e._receiver.on("finish",ie))}function ue(e){this[B]._receiver.write(e)||this.pause()}function fe(){var e=this[B];e.readyState=J.CLOSING,e._receiver.end(),this.end()}function he(){var e=this[B];this.removeListener("error",he),this.on("error",F),e&&(e.readyState=J.CLOSING,this.destroy())}G.forEach((function(e,t){J[e]=t})),["open","error","close","message"].forEach((function(e){Object.defineProperty(J.prototype,"on".concat(e),{get:function(){for(var t=this.listeners(e),r=0;r<t.length;r++)if(t[r]._listener)return t[r]._listener},set:function(t){for(var r=this.listeners(e),n=0;n<r.length;n++)r[n]._listener&&this.removeListener(e,r[n]);this.addEventListener(e,t)}})})),J.prototype.addEventListener=Z,J.prototype.removeEventListener=q,t.default=J},function(e,t){e.exports=require("events")},function(e,t,r){"use strict";t.randomBytes=t.rng=t.pseudoRandomBytes=t.prng=r(44),t.createHash=t.Hash=r(45),t.createHmac=t.Hmac=r(46);var n=r(47),i=Object.keys(n),o=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(i);t.getHashes=function(){return o};var s=r(48);t.pbkdf2=s.pbkdf2,t.pbkdf2Sync=s.pbkdf2Sync;var a=r(49);t.Cipher=a.Cipher,t.createCipher=a.createCipher,t.Cipheriv=a.Cipheriv,t.createCipheriv=a.createCipheriv,t.Decipher=a.Decipher,t.createDecipher=a.createDecipher,t.Decipheriv=a.Decipheriv,t.createDecipheriv=a.createDecipheriv,t.getCiphers=a.getCiphers,t.listCiphers=a.listCiphers;var c=r(50);t.DiffieHellmanGroup=c.DiffieHellmanGroup,t.createDiffieHellmanGroup=c.createDiffieHellmanGroup,t.getDiffieHellman=c.getDiffieHellman,t.createDiffieHellman=c.createDiffieHellman,t.DiffieHellman=c.DiffieHellman;var u=r(51);t.createSign=u.createSign,t.Sign=u.Sign,t.createVerify=u.createVerify,t.Verify=u.Verify,t.createECDH=r(52);var f=r(53);t.publicEncrypt=f.publicEncrypt,t.privateEncrypt=f.privateEncrypt,t.publicDecrypt=f.publicDecrypt,t.privateDecrypt=f.privateDecrypt;var h=r(54);t.randomFill=h.randomFill,t.randomFillSync=h.randomFillSync,t.createCredentials=function(){throw new Error(["sorry, createCredentials is not implemented yet","we accept pull requests","https://github.com/crypto-browserify/crypto-browserify"].join("\n"))},t.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6}},function(e,t,r){e.exports=i;var n=r(21).EventEmitter;function i(){n.call(this)}r(60)(i,n),i.Readable=r(61),i.Writable=r(62),i.Duplex=r(63),i.Transform=r(64),i.PassThrough=r(65),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function o(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(r.on("end",a),r.on("close",c));var s=!1;function a(){s||(s=!0,e.end())}function c(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){if(f(),0===n.listenerCount(this,"error"))throw e}function f(){r.removeListener("data",i),e.removeListener("drain",o),r.removeListener("end",a),r.removeListener("close",c),r.removeListener("error",u),e.removeListener("error",u),r.removeListener("end",f),r.removeListener("close",f),e.removeListener("close",f)}return r.on("error",u),e.on("error",u),r.on("end",f),r.on("close",f),e.on("close",f),e.emit("pipe",r),e}},function(e,t,r){"use strict";r.r(t),function(e){var n=r(1),i=r.n(n),o=r(3),s=r.n(o),a=r(7),c=r.n(a),u=r(4),f=r.n(u),h=r(8),l=r.n(h),p=r(23).Writable,d=r(18).default,v=r(15).default,_=v.BINARY_TYPES,y=v.EMPTY_BUFFER,m=v.kStatusCode,g=v.kWebSocket,b=r(19).default,w=b.concat,E=b.toArrayBuffer,O=b.unmask,S=r(32).default,k=S.isValidStatusCode,x=S.isValidUTF8,P=function(t){function r(e,t,n,o){var s;return i()(this,r),(s=c()(this,f()(r).call(this)))._binaryType=e||_[0],s[g]=void 0,s._extensions=t||{},s._isServer=!!n,s._maxPayload=0|o,s._bufferedBytes=0,s._buffers=[],s._compressed=!1,s._payloadLength=0,s._mask=void 0,s._fragmented=0,s._masked=!1,s._fin=!1,s._opcode=0,s._totalPayloadLength=0,s._messageLength=0,s._fragments=[],s._state=0,s._loop=!1,s}return l()(r,t),s()(r,[{key:"_write",value:function(e,t,r){if(8===this._opcode&&0==this._state)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}},{key:"consume",value:function(t){if(this._bufferedBytes-=t,t===this._buffers[0].length)return this._buffers.shift();if(t<this._buffers[0].length){var r=this._buffers[0];return this._buffers[0]=r.slice(t),r.slice(0,t)}var n=e.allocUnsafe(t);do{var i=this._buffers[0],o=n.length-t;t>=i.length?n.set(this._buffers.shift(),o):(n.set(new Uint8Array(i.buffer,i.byteOffset,t),o),this._buffers[0]=i.slice(t)),t-=i.length}while(t>0);return n}},{key:"startLoop",value:function(e){var t;this._loop=!0;do{switch(this._state){case 0:t=this.getInfo();break;case 1:t=this.getPayloadLength16();break;case 2:t=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:t=this.getData(e);break;default:return void(this._loop=!1)}}while(this._loop);e(t)}},{key:"getInfo",value:function(){if(this._bufferedBytes<2)this._loop=!1;else{var e=this.consume(2);if(0!=(48&e[0]))return this._loop=!1,A(RangeError,"RSV2 and RSV3 must be clear",!0,1002);var t=64==(64&e[0]);if(t&&!this._extensions[d.extensionName])return this._loop=!1,A(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=128==(128&e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,A(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,A(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,A(RangeError,"invalid opcode ".concat(this._opcode),!0,1002);this._compressed=t}else{if(!(this._opcode>7&&this._opcode<11))return this._loop=!1,A(RangeError,"invalid opcode ".concat(this._opcode),!0,1002);if(!this._fin)return this._loop=!1,A(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,A(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,A(RangeError,"invalid payload length ".concat(this._payloadLength),!0,1002)}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&e[1]),this._isServer){if(!this._masked)return this._loop=!1,A(RangeError,"MASK must be set",!0,1002)}else if(this._masked)return this._loop=!1,A(RangeError,"MASK must be clear",!0,1002);if(126===this._payloadLength)this._state=1;else{if(127!==this._payloadLength)return this.haveLength();this._state=2}}}},{key:"getPayloadLength16",value:function(){if(!(this._bufferedBytes<2))return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}},{key:"getPayloadLength64",value:function(){if(!(this._bufferedBytes<8)){var e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,A(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}this._loop=!1}},{key:"haveLength",value:function(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,A(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=3:this._state=4}},{key:"getMask",value:function(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}},{key:"getData",value:function(e){var t=y;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&O(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=5,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}},{key:"decompress",value:function(e,t){var r=this;this._extensions[d.extensionName].decompress(e,this._fin,(function(e,n){if(e)return t(e);if(n.length){if(r._messageLength+=n.length,r._messageLength>r._maxPayload&&r._maxPayload>0)return t(A(RangeError,"Max payload size exceeded",!1,1009));r._fragments.push(n)}var i=r.dataMessage();if(i)return t(i);r.startLoop(t)}))}},{key:"dataMessage",value:function(){if(this._fin){var e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){var r;r="nodebuffer"===this._binaryType?w(t,e):"arraybuffer"===this._binaryType?E(w(t,e)):t,this.emit("message",r)}else{var n=w(t,e);if(!x(n))return this._loop=!1,A(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",n.toString())}}this._state=0}},{key:"controlMessage",value:function(e){if(8===this._opcode)if(this._loop=!1,0===e.length)this.emit("conclude",1005,""),this.end();else{if(1===e.length)return A(RangeError,"invalid payload length 1",!0,1002);var t=e.readUInt16BE(0);if(!k(t))return A(RangeError,"invalid status code ".concat(t),!0,1002);var r=e.slice(2);if(!x(r))return A(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,r.toString()),this.end()}else 9===this._opcode?this.emit("ping",e):this.emit("pong",e);this._state=0}}]),r}(p);function A(e,t,r,n){var i=new e(r?"Invalid WebSocket frame: ".concat(t):t);return Error.captureStackTrace(i,A),i[m]=n,i}t.default=P}.call(this,r(13).Buffer)},function(e,t,r){"use strict";r.r(t),function(e){var n=r(1),i=r.n(n),o=r(3),s=r.n(o),a=r(22).randomFillSync,c=r(18).default,u=r(15).default.EMPTY_BUFFER,f=r(32).default.isValidStatusCode,h=r(19).default,l=h.mask,p=h.toBuffer,d=e.alloc(4),v=function(){function t(e,r){i()(this,t),this._extensions=r||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}return s()(t,[{key:"close",value:function(t,r,n,i){var o;if(void 0===t)o=u;else{if("number"!=typeof t||!f(t))throw new TypeError("First argument must be a valid error code number");if(void 0===r||""===r)(o=e.allocUnsafe(2)).writeUInt16BE(t,0);else{var s=e.byteLength(r);if(s>123)throw new RangeError("The message must not be greater than 123 bytes");(o=e.allocUnsafe(2+s)).writeUInt16BE(t,0),o.write(r,2)}}this._deflating?this.enqueue([this.doClose,o,n,i]):this.doClose(o,n,i)}},{key:"doClose",value:function(e,r,n){this.sendFrame(t.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:r,readOnly:!1}),n)}},{key:"ping",value:function(e,t,r){var n=p(e);if(n.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPing,n,t,p.readOnly,r]):this.doPing(n,t,p.readOnly,r)}},{key:"doPing",value:function(e,r,n,i){this.sendFrame(t.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:r,readOnly:n}),i)}},{key:"pong",value:function(e,t,r){var n=p(e);if(n.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPong,n,t,p.readOnly,r]):this.doPong(n,t,p.readOnly,r)}},{key:"doPong",value:function(e,r,n,i){this.sendFrame(t.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:r,readOnly:n}),i)}},{key:"send",value:function(e,r,n){var i=p(e),o=this._extensions[c.extensionName],s=r.binary?2:1,a=r.compress;if(this._firstFragment?(this._firstFragment=!1,a&&o&&(a=i.length>=o._threshold),this._compress=a):(a=!1,s=0),r.fin&&(this._firstFragment=!0),o){var u={fin:r.fin,rsv1:a,opcode:s,mask:r.mask,readOnly:p.readOnly};this._deflating?this.enqueue([this.dispatch,i,this._compress,u,n]):this.dispatch(i,this._compress,u,n)}else this.sendFrame(t.frame(i,{fin:r.fin,rsv1:!1,opcode:s,mask:r.mask,readOnly:p.readOnly}),n)}},{key:"dispatch",value:function(e,r,n,i){var o=this;if(r){var s=this._extensions[c.extensionName];this._deflating=!0,s.compress(e,n.fin,(function(e,r){if(o._socket.destroyed){var s=new Error("The socket was closed while data was being compressed");"function"==typeof i&&i(s);for(var a=0;a<o._queue.length;a++){var c=o._queue[a][4];"function"==typeof c&&c(s)}}else o._deflating=!1,n.readOnly=!1,o.sendFrame(t.frame(r,n),i),o.dequeue()}))}else this.sendFrame(t.frame(e,n),i)}},{key:"dequeue",value:function(){for(;!this._deflating&&this._queue.length;){var e=this._queue.shift();this._bufferedBytes-=e[1].length,Reflect.apply(e[0],this,e.slice(1))}}},{key:"enqueue",value:function(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}},{key:"sendFrame",value:function(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}],[{key:"frame",value:function(t,r){var n=r.mask&&r.readOnly,i=r.mask?6:2,o=t.length;t.length>=65536?(i+=8,o=127):t.length>125&&(i+=2,o=126);var s=e.allocUnsafe(n?t.length+i:i);return s[0]=r.fin?128|r.opcode:r.opcode,r.rsv1&&(s[0]|=64),s[1]=o,126===o?s.writeUInt16BE(t.length,2):127===o&&(s.writeUInt32BE(0,2),s.writeUInt32BE(t.length,6)),r.mask?(a(d,0,4),s[1]|=128,s[i-4]=d[0],s[i-3]=d[1],s[i-2]=d[2],s[i-1]=d[3],n?(l(t,d,s,i,t.length),[s]):(l(t,d,t,0,t.length),[s,t])):[s,t]}}]),t}();t.default=v}.call(this,r(13).Buffer)},function(e,t){e.exports=require("@babel/runtime/helpers/construct")},function(e,t){e.exports=require("cookie")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("buffer")},function(e,t){e.exports=require("assert")},function(e,t,r){"use strict";r.r(t);var n,i=r(5),o=r.n(i);try{var s=r(!function(){var e=new Error("Cannot find module 'utf-8-validate'");throw e.code="MODULE_NOT_FOUND",e}());n="object"===o()(s)?s.Validation.isValidUTF8:s}catch(e){n=function(){return!0}}t.default={isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:n}},function(e,t,r){"use strict";r.r(t);var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function i(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}t.default={format:function(e){return Object.keys(e).map((function(t){var r=e[t];return Array.isArray(r)||(r=[r]),r.map((function(e){return[t].concat(Object.keys(e).map((function(t){var r=e[t];return Array.isArray(r)||(r=[r]),r.map((function(e){return!0===e?t:"".concat(t,"=").concat(e)})).join("; ")}))).join("; ")})).join(", ")})).join(", ")},parse:function(e){var t=Object.create(null);if(void 0===e||""===e)return t;for(var r,o,s=Object.create(null),a=!1,c=!1,u=!1,f=-1,h=-1,l=0;l<e.length;l++){var p=e.charCodeAt(l);if(void 0===r)if(-1===h&&1===n[p])-1===f&&(f=l);else if(32===p||9===p)-1===h&&-1!==f&&(h=l);else{if(59!==p&&44!==p)throw new SyntaxError("Unexpected character at index ".concat(l));if(-1===f)throw new SyntaxError("Unexpected character at index ".concat(l));-1===h&&(h=l);var d=e.slice(f,h);44===p?(i(t,d,s),s=Object.create(null)):r=d,f=h=-1}else if(void 0===o)if(-1===h&&1===n[p])-1===f&&(f=l);else if(32===p||9===p)-1===h&&-1!==f&&(h=l);else if(59===p||44===p){if(-1===f)throw new SyntaxError("Unexpected character at index ".concat(l));-1===h&&(h=l),i(s,e.slice(f,h),!0),44===p&&(i(t,r,s),s=Object.create(null),r=void 0),f=h=-1}else{if(61!==p||-1===f||-1!==h)throw new SyntaxError("Unexpected character at index ".concat(l));o=e.slice(f,l),f=h=-1}else if(c){if(1!==n[p])throw new SyntaxError("Unexpected character at index ".concat(l));-1===f?f=l:a||(a=!0),c=!1}else if(u)if(1===n[p])-1===f&&(f=l);else if(34===p&&-1!==f)u=!1,h=l;else{if(92!==p)throw new SyntaxError("Unexpected character at index ".concat(l));c=!0}else if(34===p&&61===e.charCodeAt(l-1))u=!0;else if(-1===h&&1===n[p])-1===f&&(f=l);else if(-1===f||32!==p&&9!==p){if(59!==p&&44!==p)throw new SyntaxError("Unexpected character at index ".concat(l));if(-1===f)throw new SyntaxError("Unexpected character at index ".concat(l));-1===h&&(h=l);var v=e.slice(f,h);a&&(v=v.replace(/\\/g,""),a=!1),i(s,o,v),44===p&&(i(t,r,s),s=Object.create(null),r=void 0),o=void 0,f=h=-1}else-1===h&&(h=l)}if(-1===f||u)throw new SyntaxError("Unexpected end of input");-1===h&&(h=l);var _=e.slice(f,h);return void 0===r?i(t,_,s):(void 0===o?i(s,_,!0):i(s,o,a?_.replace(/\\/g,""):_),i(t,r,s)),t}}},function(e,t,r){"use strict";(function(e){var n=r(6),i=r.n(n),o=r(1),s=r.n(o),a=r(3),c=r.n(a),u=r(7),f=r.n(u),h=r(4),l=r.n(h),p=r(9),d=r.n(p),v=r(8),_=r.n(v);function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g=r(21),b=r(22).createHash,w=r(17),E=w.createServer,O=w.STATUS_CODES,S=r(18).default,k=r(20).default,x=r(33).default,P=x.format,A=x.parse,T=r(15).default.GUID,R=/^[+/0-9A-Za-z]{22}==$/,L=Symbol("kUsedByWebSocketServer"),I=function(e){function t(e,r){var n;if(s()(this,t),n=f()(this,l()(t).call(this)),null==(e=m({maxPayload:104857600,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e)).port&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');if(null!=e.port)n._server=E((function(e,t){var r=O[426];t.writeHead(426,{"Content-Length":r.length,"Content-Type":"text/plain"}),t.end(r)})),n._server.listen(e.port,e.host,e.backlog,r);else if(e.server){if(e.server[L])throw new Error("The HTTP/S server is already being used by another WebSocket server");e.server[L]=!0,n._server=e.server}return n._server&&(n._removeListeners=function(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];e.on(i,t[i])}return function(){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];e.removeListener(i,t[i])}}}(n._server,{listening:n.emit.bind(d()(n),"listening"),error:n.emit.bind(d()(n),"error"),upgrade:function(e,t,r){n.handleUpgrade(e,t,r,(function(t){n.emit("connection",t,e)}))}})),!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(n.clients=new Set),n.options=e,n}return _()(t,e),c()(t,[{key:"address",value:function(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}},{key:"close",value:function(e){var t=this;if(e&&this.once("close",e),this.clients){var r=!0,n=!1,i=void 0;try{for(var o,s=this.clients[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){o.value.terminate()}}catch(e){n=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}}var a=this._server;if(a){if(this._removeListeners(),this._removeListeners=this._server=null,null!=this.options.port)return void a.close((function(){return t.emit("close")}));delete a[L]}process.nextTick(N,this)}},{key:"shouldHandle",value:function(e){if(this.options.path){var t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}},{key:"handleUpgrade",value:function(e,t,r,n){var i=this;t.on("error",D);var o=void 0!==e.headers["sec-websocket-key"]&&e.headers["sec-websocket-key"].trim(),s=+e.headers["sec-websocket-version"],a={};if("GET"!==e.method||"websocket"!==e.headers.upgrade.toLowerCase()||!o||!R.test(o)||8!==s&&13!==s||!this.shouldHandle(e))return C(t,400);if(this.options.perMessageDeflate){var c=new S(this.options.perMessageDeflate,!0,this.options.maxPayload);try{var u=A(e.headers["sec-websocket-extensions"]);u[S.extensionName]&&(c.accept(u[S.extensionName]),a[S.extensionName]=c)}catch(e){return C(t,400)}}if(this.options.verifyClient){var f={origin:e.headers["".concat(8===s?"sec-websocket-origin":"origin")],secure:!(!e.connection.authorized&&!e.connection.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(f,(function(s,c,u,f){if(!s)return C(t,c||401,u,f);i.completeUpgrade(o,a,e,t,r,n)}));if(!this.options.verifyClient(f))return C(t,401)}this.completeUpgrade(o,a,e,t,r,n)}},{key:"completeUpgrade",value:function(e,t,r,n,o,s){var a=this;if(!n.readable||!n.writable)return n.destroy();var c=b("sha1").update(e+T).digest("base64"),u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade","Sec-WebSocket-Accept: ".concat(c)],f=new k(null),h=r.headers["sec-websocket-protocol"];if(h&&(h=h.trim().split(/ *, */),(h=this.options.handleProtocols?this.options.handleProtocols(h,r):h[0])&&(u.push("Sec-WebSocket-Protocol: ".concat(h)),f.protocol=h)),t[S.extensionName]){var l=t[S.extensionName].params,p=P(i()({},S.extensionName,[l]));u.push("Sec-WebSocket-Extensions: ".concat(p)),f._extensions=t}this.emit("headers",u,r,f),n.write(u.concat("\r\n").join("\r\n")),n.removeListener("error",D),f.setSocket(n,o,this.options.maxPayload),f.handshake=r,this.clients&&(this.clients.add(f),f.on("close",(function(){return a.clients.delete(f)}))),s(f)}}]),t}(g);function N(e){e.emit("close")}function D(){this.destroy()}function C(t,r,n,i){t.writable&&(n=n||O[r],i=m({Connection:"close","Content-Type":"text/html","Content-Length":e.byteLength(n)},i),t.write("HTTP/1.1 ".concat(r," ").concat(O[r],"\r\n")+Object.keys(i).map((function(e){return"".concat(e,": ").concat(i[e])})).join("\r\n")+"\r\n\r\n"+n)),t.removeListener("error",D),t.destroy()}t.a=I}).call(this,r(13).Buffer)},function(e,t){e.exports=require("@babel/runtime/helpers/wrapNativeSuper")},function(e,t){e.exports=require("@babel/runtime/helpers/objectWithoutProperties")},function(e,t){e.exports=require("triframe/scribe")},function(e,t){e.exports=require("@babel/runtime/helpers/toArray")},function(e,t){e.exports=require("mime")},function(e,t){e.exports=require("ncp")},function(e,t,r){var n=r(17),i=r(29),o=e.exports;for(var s in n)n.hasOwnProperty(s)&&(o[s]=n[s]);function a(e){if("string"==typeof e&&(e=i.parse(e)),e.protocol||(e.protocol="https:"),"https:"!==e.protocol)throw new Error('Protocol "'+e.protocol+'" not supported. Expected "https:"');return e}o.request=function(e,t){return e=a(e),n.request.call(this,e,t)},o.get=function(e,t){return e=a(e),n.get.call(this,e,t)}},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("tls")},function(e,t){e.exports=require("randombytes")},function(e,t){e.exports=require("create-hash")},function(e,t){e.exports=require("create-hmac")},function(e,t){e.exports=require("browserify-sign/algos")},function(e,t){e.exports=require("pbkdf2")},function(e,t){e.exports=require("browserify-cipher")},function(e,t){e.exports=require("diffie-hellman")},function(e,t){e.exports=require("browserify-sign")},function(e,t){e.exports=require("create-ecdh")},function(e,t){e.exports=require("public-encrypt")},function(e,t){e.exports=require("randomfill")},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){e.exports=require("base64-js")},function(e,t){e.exports=require("ieee754")},function(e,t){e.exports=require("isarray")},function(e,t,r){"use strict";var n=r(30).Buffer,i=r(23).Transform,o=r(66),s=r(71),a=r(31).ok,c=r(30).kMaxLength,u="Cannot create final Buffer. It would be larger than 0x"+c.toString(16)+" bytes";o.Z_MIN_WINDOWBITS=8,o.Z_MAX_WINDOWBITS=15,o.Z_DEFAULT_WINDOWBITS=15,o.Z_MIN_CHUNK=64,o.Z_MAX_CHUNK=1/0,o.Z_DEFAULT_CHUNK=16384,o.Z_MIN_MEMLEVEL=1,o.Z_MAX_MEMLEVEL=9,o.Z_DEFAULT_MEMLEVEL=8,o.Z_MIN_LEVEL=-1,o.Z_MAX_LEVEL=9,o.Z_DEFAULT_LEVEL=o.Z_DEFAULT_COMPRESSION;for(var f=Object.keys(o),h=0;h<f.length;h++){var l=f[h];l.match(/^Z/)&&Object.defineProperty(t,l,{enumerable:!0,value:o[l],writable:!1})}for(var p={Z_OK:o.Z_OK,Z_STREAM_END:o.Z_STREAM_END,Z_NEED_DICT:o.Z_NEED_DICT,Z_ERRNO:o.Z_ERRNO,Z_STREAM_ERROR:o.Z_STREAM_ERROR,Z_DATA_ERROR:o.Z_DATA_ERROR,Z_MEM_ERROR:o.Z_MEM_ERROR,Z_BUF_ERROR:o.Z_BUF_ERROR,Z_VERSION_ERROR:o.Z_VERSION_ERROR},d=Object.keys(p),v=0;v<d.length;v++){var _=d[v];p[p[_]]=_}function y(e,t,r){var i=[],o=0;function s(){for(var t;null!==(t=e.read());)i.push(t),o+=t.length;e.once("readable",s)}function a(){var t,s=null;o>=c?s=new RangeError(u):t=n.concat(i,o),i=[],e.close(),r(s,t)}e.on("error",(function(t){e.removeListener("end",a),e.removeListener("readable",s),r(t)})),e.on("end",a),e.end(t),s()}function m(e,t){if("string"==typeof t&&(t=n.from(t)),!n.isBuffer(t))throw new TypeError("Not a string or buffer");var r=e._finishFlushFlag;return e._processChunk(t,r)}function g(e){if(!(this instanceof g))return new g(e);P.call(this,e,o.DEFLATE)}function b(e){if(!(this instanceof b))return new b(e);P.call(this,e,o.INFLATE)}function w(e){if(!(this instanceof w))return new w(e);P.call(this,e,o.GZIP)}function E(e){if(!(this instanceof E))return new E(e);P.call(this,e,o.GUNZIP)}function O(e){if(!(this instanceof O))return new O(e);P.call(this,e,o.DEFLATERAW)}function S(e){if(!(this instanceof S))return new S(e);P.call(this,e,o.INFLATERAW)}function k(e){if(!(this instanceof k))return new k(e);P.call(this,e,o.UNZIP)}function x(e){return e===o.Z_NO_FLUSH||e===o.Z_PARTIAL_FLUSH||e===o.Z_SYNC_FLUSH||e===o.Z_FULL_FLUSH||e===o.Z_FINISH||e===o.Z_BLOCK}function P(e,r){var s=this;if(this._opts=e=e||{},this._chunkSize=e.chunkSize||t.Z_DEFAULT_CHUNK,i.call(this,e),e.flush&&!x(e.flush))throw new Error("Invalid flush flag: "+e.flush);if(e.finishFlush&&!x(e.finishFlush))throw new Error("Invalid flush flag: "+e.finishFlush);if(this._flushFlag=e.flush||o.Z_NO_FLUSH,this._finishFlushFlag=void 0!==e.finishFlush?e.finishFlush:o.Z_FINISH,e.chunkSize&&(e.chunkSize<t.Z_MIN_CHUNK||e.chunkSize>t.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<t.Z_MIN_WINDOWBITS||e.windowBits>t.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<t.Z_MIN_LEVEL||e.level>t.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<t.Z_MIN_MEMLEVEL||e.memLevel>t.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=t.Z_FILTERED&&e.strategy!=t.Z_HUFFMAN_ONLY&&e.strategy!=t.Z_RLE&&e.strategy!=t.Z_FIXED&&e.strategy!=t.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!n.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new o.Zlib(r);var a=this;this._hadError=!1,this._handle.onerror=function(e,r){A(a),a._hadError=!0;var n=new Error(e);n.errno=r,n.code=t.codes[r],a.emit("error",n)};var c=t.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(c=e.level);var u=t.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(u=e.strategy),this._handle.init(e.windowBits||t.Z_DEFAULT_WINDOWBITS,c,e.memLevel||t.Z_DEFAULT_MEMLEVEL,u,e.dictionary),this._buffer=n.allocUnsafe(this._chunkSize),this._offset=0,this._level=c,this._strategy=u,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!s._handle},configurable:!0,enumerable:!0})}function A(e,t){t&&process.nextTick(t),e._handle&&(e._handle.close(),e._handle=null)}function T(e){e.emit("close")}Object.defineProperty(t,"codes",{enumerable:!0,value:Object.freeze(p),writable:!1}),t.Deflate=g,t.Inflate=b,t.Gzip=w,t.Gunzip=E,t.DeflateRaw=O,t.InflateRaw=S,t.Unzip=k,t.createDeflate=function(e){return new g(e)},t.createInflate=function(e){return new b(e)},t.createDeflateRaw=function(e){return new O(e)},t.createInflateRaw=function(e){return new S(e)},t.createGzip=function(e){return new w(e)},t.createGunzip=function(e){return new E(e)},t.createUnzip=function(e){return new k(e)},t.deflate=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new g(t),e,r)},t.deflateSync=function(e,t){return m(new g(t),e)},t.gzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new w(t),e,r)},t.gzipSync=function(e,t){return m(new w(t),e)},t.deflateRaw=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new O(t),e,r)},t.deflateRawSync=function(e,t){return m(new O(t),e)},t.unzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new k(t),e,r)},t.unzipSync=function(e,t){return m(new k(t),e)},t.inflate=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new b(t),e,r)},t.inflateSync=function(e,t){return m(new b(t),e)},t.gunzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new E(t),e,r)},t.gunzipSync=function(e,t){return m(new E(t),e)},t.inflateRaw=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new S(t),e,r)},t.inflateRawSync=function(e,t){return m(new S(t),e)},s.inherits(P,i),P.prototype.params=function(e,r,n){if(e<t.Z_MIN_LEVEL||e>t.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e);if(r!=t.Z_FILTERED&&r!=t.Z_HUFFMAN_ONLY&&r!=t.Z_RLE&&r!=t.Z_FIXED&&r!=t.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+r);if(this._level!==e||this._strategy!==r){var i=this;this.flush(o.Z_SYNC_FLUSH,(function(){a(i._handle,"zlib binding closed"),i._handle.params(e,r),i._hadError||(i._level=e,i._strategy=r,n&&n())}))}else process.nextTick(n)},P.prototype.reset=function(){return a(this._handle,"zlib binding closed"),this._handle.reset()},P.prototype._flush=function(e){this._transform(n.alloc(0),"",e)},P.prototype.flush=function(e,t){var r=this,i=this._writableState;("function"==typeof e||void 0===e&&!t)&&(t=e,e=o.Z_FULL_FLUSH),i.ended?t&&process.nextTick(t):i.ending?t&&this.once("end",t):i.needDrain?t&&this.once("drain",(function(){return r.flush(e,t)})):(this._flushFlag=e,this.write(n.alloc(0),"",t))},P.prototype.close=function(e){A(this,e),process.nextTick(T,this)},P.prototype._transform=function(e,t,r){var i,s=this._writableState,a=(s.ending||s.ended)&&(!e||s.length===e.length);return null===e||n.isBuffer(e)?this._handle?(a?i=this._finishFlushFlag:(i=this._flushFlag,e.length>=s.length&&(this._flushFlag=this._opts.flush||o.Z_NO_FLUSH)),void this._processChunk(e,i,r)):r(new Error("zlib binding closed")):r(new Error("invalid input"))},P.prototype._processChunk=function(e,t,r){var i=e&&e.length,o=this._chunkSize-this._offset,s=0,f=this,h="function"==typeof r;if(!h){var l,p=[],d=0;this.on("error",(function(e){l=e})),a(this._handle,"zlib binding closed");do{var v=this._handle.writeSync(t,e,s,i,this._buffer,this._offset,o)}while(!this._hadError&&m(v[0],v[1]));if(this._hadError)throw l;if(d>=c)throw A(this),new RangeError(u);var _=n.concat(p,d);return A(this),_}a(this._handle,"zlib binding closed");var y=this._handle.write(t,e,s,i,this._buffer,this._offset,o);function m(c,u){if(this&&(this.buffer=null,this.callback=null),!f._hadError){var l=o-u;if(a(l>=0,"have should not go down"),l>0){var v=f._buffer.slice(f._offset,f._offset+l);f._offset+=l,h?f.push(v):(p.push(v),d+=v.length)}if((0===u||f._offset>=f._chunkSize)&&(o=f._chunkSize,f._offset=0,f._buffer=n.allocUnsafe(f._chunkSize)),0===u){if(s+=i-c,i=c,!h)return!0;var _=f._handle.write(t,e,s,i,f._buffer,f._offset,f._chunkSize);return _.callback=m,void(_.buffer=e)}if(!h)return!1;r()}}y.buffer=e,y.callback=m},s.inherits(g,P),s.inherits(b,P),s.inherits(w,P),s.inherits(E,P),s.inherits(O,P),s.inherits(S,P),s.inherits(k,P)},function(e,t){e.exports=require("inherits")},function(e,t){e.exports=require("readable-stream/readable.js")},function(e,t){e.exports=require("readable-stream/writable.js")},function(e,t){e.exports=require("readable-stream/duplex.js")},function(e,t){e.exports=require("readable-stream/transform.js")},function(e,t){e.exports=require("readable-stream/passthrough.js")},function(e,t,r){"use strict";(function(e){var n=r(31),i=r(67),o=r(68),s=r(69),a=r(70);for(var c in a)t[c]=a[c];t.NONE=0,t.DEFLATE=1,t.INFLATE=2,t.GZIP=3,t.GUNZIP=4,t.DEFLATERAW=5,t.INFLATERAW=6,t.UNZIP=7;function u(e){if("number"!=typeof e||e<t.DEFLATE||e>t.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=e,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}u.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,n(this.init_done,"close before init"),n(this.mode<=t.UNZIP),this.mode===t.DEFLATE||this.mode===t.GZIP||this.mode===t.DEFLATERAW?o.deflateEnd(this.strm):this.mode!==t.INFLATE&&this.mode!==t.GUNZIP&&this.mode!==t.INFLATERAW&&this.mode!==t.UNZIP||s.inflateEnd(this.strm),this.mode=t.NONE,this.dictionary=null)},u.prototype.write=function(e,t,r,n,i,o,s){return this._write(!0,e,t,r,n,i,o,s)},u.prototype.writeSync=function(e,t,r,n,i,o,s){return this._write(!1,e,t,r,n,i,o,s)},u.prototype._write=function(r,i,o,s,a,c,u,f){if(n.equal(arguments.length,8),n(this.init_done,"write before init"),n(this.mode!==t.NONE,"already finalized"),n.equal(!1,this.write_in_progress,"write already in progress"),n.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,n.equal(!1,void 0===i,"must provide flush value"),this.write_in_progress=!0,i!==t.Z_NO_FLUSH&&i!==t.Z_PARTIAL_FLUSH&&i!==t.Z_SYNC_FLUSH&&i!==t.Z_FULL_FLUSH&&i!==t.Z_FINISH&&i!==t.Z_BLOCK)throw new Error("Invalid flush value");if(null==o&&(o=e.alloc(0),a=0,s=0),this.strm.avail_in=a,this.strm.input=o,this.strm.next_in=s,this.strm.avail_out=f,this.strm.output=c,this.strm.next_out=u,this.flush=i,!r)return this._process(),this._checkError()?this._afterSync():void 0;var h=this;return process.nextTick((function(){h._process(),h._after()})),this},u.prototype._afterSync=function(){var e=this.strm.avail_out,t=this.strm.avail_in;return this.write_in_progress=!1,[t,e]},u.prototype._process=function(){var e=null;switch(this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflate(this.strm,this.flush);break;case t.UNZIP:switch(this.strm.avail_in>0&&(e=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===e)break;if(31!==this.strm.input[e]){this.mode=t.INFLATE;break}if(this.gzip_id_bytes_read=1,e++,1===this.strm.avail_in)break;case 1:if(null===e)break;139===this.strm.input[e]?(this.gzip_id_bytes_read=2,this.mode=t.GUNZIP):this.mode=t.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:for(this.err=s.inflate(this.strm,this.flush),this.err===t.Z_NEED_DICT&&this.dictionary&&(this.err=s.inflateSetDictionary(this.strm,this.dictionary),this.err===t.Z_OK?this.err=s.inflate(this.strm,this.flush):this.err===t.Z_DATA_ERROR&&(this.err=t.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===t.GUNZIP&&this.err===t.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=s.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},u.prototype._checkError=function(){switch(this.err){case t.Z_OK:case t.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===t.Z_FINISH)return this._error("unexpected end of file"),!1;break;case t.Z_STREAM_END:break;case t.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},u.prototype._after=function(){if(this._checkError()){var e=this.strm.avail_out,t=this.strm.avail_in;this.write_in_progress=!1,this.callback(t,e),this.pending_close&&this.close()}},u.prototype._error=function(e){this.strm.msg&&(e=this.strm.msg),this.onerror(e,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},u.prototype.init=function(e,r,i,o,s){n(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),n(e>=8&&e<=15,"invalid windowBits"),n(r>=-1&&r<=9,"invalid compression level"),n(i>=1&&i<=9,"invalid memlevel"),n(o===t.Z_FILTERED||o===t.Z_HUFFMAN_ONLY||o===t.Z_RLE||o===t.Z_FIXED||o===t.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(r,e,i,o,s),this._setDictionary()},u.prototype.params=function(){throw new Error("deflateParams Not supported")},u.prototype.reset=function(){this._reset(),this._setDictionary()},u.prototype._init=function(e,r,n,a,c){switch(this.level=e,this.windowBits=r,this.memLevel=n,this.strategy=a,this.flush=t.Z_NO_FLUSH,this.err=t.Z_OK,this.mode!==t.GZIP&&this.mode!==t.GUNZIP||(this.windowBits+=16),this.mode===t.UNZIP&&(this.windowBits+=32),this.mode!==t.DEFLATERAW&&this.mode!==t.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new i,this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflateInit2(this.strm,this.level,t.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:case t.UNZIP:this.err=s.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==t.Z_OK&&this._error("Init error"),this.dictionary=c,this.write_in_progress=!1,this.init_done=!0},u.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:this.err=o.deflateSetDictionary(this.strm,this.dictionary)}this.err!==t.Z_OK&&this._error("Failed to set dictionary")}},u.prototype._reset=function(){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:case t.GZIP:this.err=o.deflateReset(this.strm);break;case t.INFLATE:case t.INFLATERAW:case t.GUNZIP:this.err=s.inflateReset(this.strm)}this.err!==t.Z_OK&&this._error("Failed to reset stream")},t.Zlib=u}).call(this,r(13).Buffer)},function(e,t){e.exports=require("pako/lib/zlib/zstream")},function(e,t){e.exports=require("pako/lib/zlib/deflate.js")},function(e,t){e.exports=require("pako/lib/zlib/inflate.js")},function(e,t){e.exports=require("pako/lib/zlib/constants")},function(e,t){e.exports=require("util")},function(e,t,r){"use strict";r.r(t);var n=r(1),i=r.n(n),o=r(3),s=r.n(o),a=Symbol("kDone"),c=Symbol("kRun"),u=function(){function e(t){var r=this;i()(this,e),this[a]=function(){r.pending--,r[c]()},this.concurrency=t||1/0,this.jobs=[],this.pending=0}return s()(e,[{key:"add",value:function(e){this.jobs.push(e),this[c]()}},{key:c,value:function(){if(this.pending!==this.concurrency&&this.jobs.length){var e=this.jobs.shift();this.pending++,e(this[a])}}}]),e}();t.default=u},function(e,t,r){"use strict";r.r(t);var n=r(7),i=r.n(n),o=r(4),s=r.n(o),a=r(8),c=r.n(a),u=r(1),f=r.n(u),h=function e(t,r){f()(this,e),this.target=r,this.type=t},l=function(e){function t(e,r){var n;return f()(this,t),(n=i()(this,s()(t).call(this,"message",r))).data=e,n}return c()(t,e),t}(h),p=function(e){function t(e,r,n){var o;return f()(this,t),(o=i()(this,s()(t).call(this,"close",n))).wasClean=n._closeFrameReceived&&n._closeFrameSent,o.reason=r,o.code=e,o}return c()(t,e),t}(h),d=function(e){function t(e){return f()(this,t),i()(this,s()(t).call(this,"open",e))}return c()(t,e),t}(h),v=function(e){function t(e,r){var n;return f()(this,t),(n=i()(this,s()(t).call(this,"error",r))).message=e.message,n.error=e,n}return c()(t,e),t}(h),_={addEventListener:function(e,t){function r(e){t.call(this,new l(e,this))}function n(e,r){t.call(this,new p(e,r,this))}function i(e){t.call(this,new v(e,this))}function o(){t.call(this,new d(this))}"function"==typeof t&&("message"===e?(r._listener=t,this.on(e,r)):"close"===e?(n._listener=t,this.on(e,n)):"error"===e?(i._listener=t,this.on(e,i)):"open"===e?(o._listener=t,this.on(e,o)):this.on(e,t))},removeEventListener:function(e,t){for(var r=this.listeners(e),n=0;n<r.length;n++)r[n]!==t&&r[n]._listener!==t||this.removeListener(e,r[n])}};t.default=_},function(e,t){function r(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function n(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}t.resolve=function(){for(var e="",t=!1,i=arguments.length-1;i>=-1&&!t;i--){var o=i>=0?arguments[i]:process.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(e=o+"/"+e,t="/"===o.charAt(0))}return(t?"/":"")+(e=r(n(e.split("/"),(function(e){return!!e})),!t).join("/"))||"."},t.normalize=function(e){var o=t.isAbsolute(e),s="/"===i(e,-1);return(e=r(n(e.split("/"),(function(e){return!!e})),!o).join("/"))||o||(e="."),e&&s&&(e+="/"),(o?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(n(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,r){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=t.resolve(e).substr(1),r=t.resolve(r).substr(1);for(var i=n(e.split("/")),o=n(r.split("/")),s=Math.min(i.length,o.length),a=s,c=0;c<s;c++)if(i[c]!==o[c]){a=c;break}var u=[];for(c=a;c<i.length;c++)u.push("..");return(u=u.concat(o.slice(a))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),r=47===t,n=-1,i=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!i){n=o;break}}else i=!1;return-1===n?r?"/":".":r&&1===n?"/":e.slice(0,n)},t.basename=function(e,t){var r=function(e){"string"!=typeof e&&(e+="");var t,r=0,n=-1,i=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){r=t+1;break}}else-1===n&&(i=!1,n=t+1);return-1===n?"":e.slice(r,n)}(e);return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,r=0,n=-1,i=!0,o=0,s=e.length-1;s>=0;--s){var a=e.charCodeAt(s);if(47!==a)-1===n&&(i=!1,n=s+1),46===a?-1===t?t=s:1!==o&&(o=1):-1!==t&&(o=-1);else if(!i){r=s+1;break}}return-1===t||-1===n||0===o||1===o&&t===n-1&&t===r+1?"":e.slice(t,n)};var i="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("formidable")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("session-file-store")},function(e,t,r){"use strict";r.r(t),r.d(t,"Resource",(function(){return ee})),r.d(t,"List",(function(){return L})),r.d(t,"serialize",(function(){return se})),r.d(t,"createUnserializer",(function(){return Ee})),r.d(t,"serve",(function(){return st})),r.d(t,"getPatchesFor",(function(){})),r.d(t,"archivePatchesFor",(function(){})),r.d(t,"Connection",(function(){return Be}));var n=r(1),i=r.n(n),o=r(7),s=r.n(o),a=r(9),c=r.n(a),u=r(3),f=r.n(u),h=r(8),l=r.n(h),p=r(4),d=r.n(p),v=r(12),_=r.n(v),y=r(6),m=r.n(y),g=r(0),b=r(16),w=r.n(b),E=r(2),O=r.n(E),S=r(10),k=r.n(S),x=r(11),P=r.n(x),A=r(5),T=r.n(A),R=r(35),L=function(e){function t(){var e,r;i()(this,t);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return r=s()(this,(e=d()(t)).call.apply(e,[this].concat(o))),Object.defineProperty(c()(r),"[[patches]]",{enumerable:!1,value:[]}),Object.defineProperty(c()(r),"[[events]]",{enumerable:!1,value:new g.EventEmitter}),r}return l()(t,e),f()(t,[{key:"on",value:function(){var e;return(e=this["[[events]]"]).on.apply(e,arguments)}},{key:"emit",value:function(){var e;return(e=this["[[events]]"]).emit.apply(e,arguments)}},{key:"push",value:function(){for(var e,r,n=this.length,i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];var a=o.map((function(e){return{op:"add",path:"/".concat(n++),value:e}}));(e=this["[[patches]]"]).push.apply(e,P()(a)),this.emit(".change",a),(r=_()(d()(t.prototype),"push",this)).call.apply(r,[this].concat(o))}},{key:"insert",value:function(e,t){this.splice(t,0,e);var r={op:"add",path:"/".concat(t),value:e};this["[[patches]]"].push(r),this.emit(".change",[r])}},{key:"replace",value:function(e,t){this[e]=t;var r={op:"replace",path:"/".concat(e),value:t};this["[[patches]]"].push(r),this.emit(".change",[r])}},{key:"map$",value:function(e){var t,r=this,n=[];this.forEach((function(t,i){var o=e(t,i);if(o!=t){r[i]=o;var s={op:"replace",path:"/".concat(i),value:o};n.push(s)}})),(t=this["[[patches]]"]).push.apply(t,n),this.emit(".change",n)}},{key:"remove",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==r&&(r=e),this.splice(e,1+r-e);for(var n=[],i=e;i<=r;i++)n.push({op:"remove",path:"/".concat(e)});(t=this["[[patches]]"]).push.apply(t,n),this.emit(".change",n)}}]),t}(r.n(R)()(Array));function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}
/*! fast-json-patch, version: 2.1.0 */
var N,D=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t){
/*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017 Joachim Wester
   * MIT license
   */
var r=this&&this.__extends||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},n=Object.prototype.hasOwnProperty;function i(e,t){return n.call(e,t)}function o(e){if(Array.isArray(e)){for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(e);t=[];for(var n in e)i(e,n)&&t.push(n);return t}function s(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function a(e,t){var r;for(var n in e)if(i(e,n)){if(e[n]===t)return s(n)+"/";if("object"===T()(e[n])&&""!=(r=a(e[n],t)))return s(n)+"/"+r}return""}function c(e,t){var r=[e];for(var n in t){var i="object"===T()(t[n])?JSON.stringify(t[n],null,2):t[n];void 0!==i&&r.push(n+": "+i)}return r.join("\n")}t.hasOwnProperty=i,t._objectKeys=o,t.deepMerge=function e(t,r){switch(T()(r)){case"object":return t?t["[[attributes]]"]?(t.attributes=e(t["[[attributes]]"],r["[[attributes]]"]),t.base=e(t["[[base]]"],r["[[base]]"]),t):Array.isArray(r)?r.map((function(r,n){return t[n]&&t[n].uid==r.uid?e(t[n],r):r})):function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t,{},Object(g.map)(r,(function(r,n){return e(t[r],n)}))):t||r;case"undefined":return null;default:return r}},t._deepClone=function e(t){switch(T()(t)){case"object":return t?t["[[attributes]]"]?t:Array.isArray(t)?t.map(e):Object(g.map)(t,(function(t,r){return e(r)})):t;case"undefined":return null;default:return t}},t.isInteger=function(e){for(var t,r=0,n=e.length;r<n;){if(!((t=e.charCodeAt(r))>=48&&t<=57))return!1;r++}return!0},t.escapePathComponent=s,t.unescapePathComponent=function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},t._getPathRecursive=a,t.getPath=function(e,t){if(e===t)return"/";var r=a(e,t);if(""===r)throw new Error("Object not found in root");return"/"+r},t.hasUndefined=function e(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var r=0,n=t.length;r<n;r++)if(e(t[r]))return!0}else if("object"===T()(t)){var i=o(t),s=i.length;for(r=0;r<s;r++)if(e(t[i[r]]))return!0}return!1};var u=function(e){function t(t,r,n,i,o){e.call(this,c(t,{name:r,index:n,operation:i,tree:o})),this.name=r,this.index=n,this.operation=i,this.tree=o,this.message=c(t,{name:r,index:n,operation:i,tree:o})}return r(t,e),t}(Error);t.PatchError=u},function(e,t,r){var n={strict:!0},i=r(3),o=function(e,t){return i(e,t,n)},s=r(0);t.JsonPatchError=s.PatchError,t.deepClone=s._deepClone,t.deepMerge=s.deepMerge;var a={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){var n=u(r,this.path);n&&(n=s._deepClone(n));var i=f(r,{op:"remove",path:this.from}).removed;return f(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:n}},copy:function(e,t,r){var n=u(r,this.from);return f(r,{op:"add",path:this.path,value:s._deepClone(n)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:o(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}},c={add:function(e,t,r){return s.isInteger(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:a.move,copy:a.copy,test:a.test,_get:a._get};function u(e,t){if(""==t)return e;var r={op:"_get",path:t};return f(e,r),r.value}function f(e,r,n,i,f,h){if(void 0===n&&(n=!1),void 0===i&&(i=!0),void 0===f&&(f=!0),void 0===h&&(h=0),n&&("function"==typeof n?n(r,0,e,r.path):l(r,0)),""===r.path){var p={newDocument:e};if("add"===r.op)return p.newDocument=r.value,p;if("replace"===r.op)return p.newDocument=r.value,p.removed=e,p;if("move"===r.op||"copy"===r.op)return p.newDocument=u(e,r.from),"move"===r.op&&(p.removed=e),p;if("test"===r.op){if(p.test=o(e,r.value),!1===p.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",h,r,e);return p.newDocument=e,p}if("remove"===r.op)return p.removed=e,p.newDocument=null,p;if("_get"===r.op)return r.value=e,p;if(n)throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",h,r,e);return p}i||(e=s._deepClone(e));var d=(r.path||"").split("/"),v=e,_=1,y=d.length,m=void 0,g=void 0,b=void 0;for(b="function"==typeof n?n:l;;){if(g=d[_],f&&"__proto__"==g)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===m&&(void 0===v[g]?m=d.slice(0,_).join("/"):_==y-1&&(m=r.path),void 0!==m&&b(r,0,e,m)),_++,Array.isArray(v)){if("-"===g)g=v.length;else{if(n&&!s.isInteger(g))throw new t.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",h,r,e);s.isInteger(g)&&(g=~~g)}if(_>=y){if(n&&"add"===r.op&&g>v.length)throw new t.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",h,r,e);if(!1===(p=c[r.op].call(r,v,g,e)).test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",h,r,e);return p}}else if(g&&-1!=g.indexOf("~")&&(g=s.unescapePathComponent(g)),_>=y){if(!1===(p=a[r.op].call(r,v,g,e)).test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",h,r,e);return p}v=v[g]}}function h(e,r,n,i,o){if(void 0===i&&(i=!0),void 0===o&&(o=!0),n&&!Array.isArray(r))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=s._deepClone(e));for(var a=new Array(r.length),c=0,u=r.length;c<u;c++)a[c]=f(e,r[c],n,!0,o,c),e=a[c].newDocument;return a.newDocument=e,a}function l(e,r,n,i){if("object"!==T()(e)||null===e||Array.isArray(e))throw new t.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",r,e,n);if(!a[e.op])throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",r,e,n);if("string"!=typeof e.path)throw new t.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",r,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new t.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",r,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new t.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",r,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",r,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&s.hasUndefined(e.value))throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",r,e,n);if(n)if("add"==e.op){var o=e.path.split("/").length,c=i.split("/").length;if(o!==c+1&&o!==c)throw new t.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",r,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==i)throw new t.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",r,e,n)}else if("move"===e.op||"copy"===e.op){var u=p([{op:"_get",path:e.from,value:void 0}],n);if(u&&"OPERATION_PATH_UNRESOLVABLE"===u.name)throw new t.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",r,e,n)}}function p(e,r,n){try{if(!Array.isArray(e))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(r)h(s._deepClone(r),s._deepClone(e),n||!0);else{n=n||l;for(var i=0;i<e.length;i++)n(e[i],i,r,void 0)}}catch(e){if(e instanceof t.JsonPatchError)return e;throw e}}t.getValueByPointer=u,t.applyOperation=f,t.applyPatch=h,t.applyReducer=function(e,r,n){var i=f(e,r);if(!1===i.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",n,r,e);return i.newDocument},t.validator=l,t.validate=p},function(e,t,r){
/*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017 Joachim Wester
   * MIT license
   */
var n=r(0),i=r(1),o=r(1);t.applyOperation=o.applyOperation,t.applyPatch=o.applyPatch,t.applyReducer=o.applyReducer,t.getValueByPointer=o.getValueByPointer,t.validate=o.validate,t.validator=o.validator;var s=r(0);t.JsonPatchError=s.PatchError,t.deepClone=s._deepClone,t.deepMerge=s.deepMerge,t.escapePathComponent=s.escapePathComponent,t.unescapePathComponent=s.unescapePathComponent;var a=new WeakMap,c=function(e){this.observers=new Map,this.obj=e},u=function(e,t){this.callback=e,this.observer=t};function f(e){var t=a.get(e.object);h(t.value,e.object,e.patches,""),e.patches.length&&i.applyPatch(t.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function h(e,t,r,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var o=n._objectKeys(t),s=n._objectKeys(e),a=!1,c=s.length-1;c>=0;c--){var u=e[l=s[c]];if(!n.hasOwnProperty(t,l)||void 0===t[l]&&void 0!==u&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(r.push({op:"remove",path:i+"/"+n.escapePathComponent(l)}),a=!0):(r.push({op:"replace",path:i,value:t}),!0);else{var f=t[l];"object"==T()(u)&&null!=u&&"object"==T()(f)&&null!=f?h(u,f,r,i+"/"+n.escapePathComponent(l)):u!==f&&(!0,r.push({op:"replace",path:i+"/"+n.escapePathComponent(l),value:n._deepClone(f)}))}}if(a||o.length!=s.length)for(c=0;c<o.length;c++){var l=o[c];n.hasOwnProperty(e,l)||void 0===t[l]||r.push({op:"add",path:i+"/"+n.escapePathComponent(l),value:n._deepClone(t[l])})}}}t.unobserve=function(e,t){t.unobserve()},t.observe=function(e,t){var r,i=function(e){return a.get(e)}(e);if(i){var o=function(e,t){return e.observers.get(t)}(i,t);r=o&&o.observer}else i=new c(e),a.set(e,i);if(r)return r;if(r={},i.value=n._deepClone(e),t){r.callback=t,r.next=null;var s=function(){f(r)},h=function(){clearTimeout(r.next),r.next=setTimeout(s)};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",h),window.addEventListener("keyup",h),window.addEventListener("mousedown",h),window.addEventListener("keydown",h),window.addEventListener("change",h)):(document.documentElement.attachEvent("onmouseup",h),document.documentElement.attachEvent("onkeyup",h),document.documentElement.attachEvent("onmousedown",h),document.documentElement.attachEvent("onkeydown",h),document.documentElement.attachEvent("onchange",h)))}return r.patches=[],r.object=e,r.unobserve=function(){f(r),clearTimeout(r.next),function(e,t){e.observers.delete(t.callback)}(i,r),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",h),window.removeEventListener("keyup",h),window.removeEventListener("mousedown",h),window.removeEventListener("keydown",h)):(document.documentElement.detachEvent("onmouseup",h),document.documentElement.detachEvent("onkeyup",h),document.documentElement.detachEvent("onmousedown",h),document.documentElement.detachEvent("onkeydown",h)))},i.observers.set(t,new u(t,r)),r},t.generate=f,t.compare=function(e,t){var r=[];return h(e,t,r,""),r}},function(e,t,r){var n=Array.prototype.slice,i=r(5),o=r(4),s=e.exports=function(e,t,r){return r||(r={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=T()(e)&&"object"!=T()(t)?r.strict?e===t:e==t:function(e,t,r){var u,f;if(a(e)||a(t))return!1;if(e.prototype!==t.prototype)return!1;if(o(e))return!!o(t)&&(e=n.call(e),t=n.call(t),s(e,t,r));if(c(e)){if(!c(t))return!1;if(e.length!==t.length)return!1;for(u=0;u<e.length;u++)if(e[u]!==t[u])return!1;return!0}try{var h=i(e),l=i(t)}catch(e){return!1}if(h.length!=l.length)return!1;for(h.sort(),l.sort(),u=h.length-1;u>=0;u--)if(h[u]!=l[u])return!1;for(u=h.length-1;u>=0;u--)if(f=h[u],!s(e[f],t[f],r))return!1;return T()(e)===T()(t)}(e,t,r))};function a(e){return null==e}function c(e){return!(!e||"object"!==T()(e)||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}},function(e,t){var r="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function n(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function i(e){return e&&"object"==T()(e)&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=r?n:i).supported=n,t.unsupported=i},function(e,t){function r(e){var t=[];for(var r in e)t.push(r);return t}(e.exports="function"==typeof Object.keys?Object.keys:r).shim=r}]),C=function(){var e=e||{};e.transform=function(e,r){var n=[];n=n.concat.apply(n,r);var i=JSON.parse(JSON.stringify(e));return n.reduce(t,i)},e.transformAgainstSingleOp=function(e,t){};var t=function(e,t){if(void 0===t.value&&("add"===t.op||"replace"===t.op||"test"===t.op))throw new Error("'value' MUST be defined");if(void 0===t.from&&("copy"===t.op||"move"===t.op))throw new Error("'from' MUST be defined");if(r[t.op])if("function"==typeof r[t.op])r[t.op](t,e);else for(var n=e.length,i=0;i<n;){var o=e[i];i++,r[t.op][o.op]&&r[t.op][o.op](t,o)}return e},r={remove:function(e,t){for(var r,o=t.length,s=0;r=t[s];)("add"!==r.op&&"test"!==r.op||e.path!==r.path)&&(r.from&&(r.from===e.path||0===r.from.indexOf(e.path+"/"))||e.path===r.path||0===r.path.indexOf(e.path+"/"))&&(t.splice(s,1),o--,s--),s++;var a=e.path.lastIndexOf("/");if(a>-1){var c=e.path.substr(a+1),u=e.path.substr(0,a+1);if(i(c))for(o=t.length,s=0;s<o;)r=t[s],s++,0===r.path.indexOf(u)&&(r.path=n(r.path,u,c,-1)),r.from&&0===r.from.indexOf(u)&&(r.from=n(r.from,u,c,-1))}},add:function(e,t){for(var r,o=t.length,s=0;r=t[s];)("add"!==r.op&&"test"!==r.op||e.path!==r.path)&&(r.from&&(r.from===e.path||0===r.from.indexOf(e.path+"/"))||e.path===r.path||0===r.path.indexOf(e.path+"/"))&&(t.splice(s,1),o--,s--),s++;var a=e.path.lastIndexOf("/");if(a>-1){var c=e.path.substr(a+1),u=e.path.substr(0,a+1);if(i(c))for(o=t.length,s=0;s<o;)r=t[s],s++,0===r.path.indexOf(u)&&(r.path=n(r.path,u,c,1)),r.from&&0===r.from.indexOf(u)&&(r.from=n(r.from,u,c,1))}},replace:function(e,t){for(var r,n=0;r=t[n];)(r.from&&(r.from===e.path||0===r.from.indexOf(e.path+"/"))||0===r.path.indexOf(e.path+"/"))&&(t.splice(n,1),n--),n++}};function n(e,t,r,n){var o=e.substr(t.length),s=o.indexOf("/");s>-1||(s=o.length);var a=o.substr(0,s),c=o.substr(s);return i(a)&&n>0&&a>=r||n<0&&a>r?t+(parseInt(a)+n)+c:e}function i(e){var t=~~Number(e);return String(t)===e&&t>=0}return e}(),j=function(){function e(t){var r=t.resource,n=t.batchId,o=void 0===n?null:n,s=t.socket,a=void 0===s?null:s;i()(this,e),Z(r),this.batchId=o||W(r),this.resource=r,this.socket=a,this.patches=z(r,this.batchId),F(this.resource,this.patches)}return f()(e,[{key:"hasBeenCommitted",value:function(){M(this.resource,this.patches)}}]),e}(),U=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.defineProperty(e,"[[attributes]]",{writable:!0,enumerable:!1,value:r}),Object.defineProperty(e,"[[base]]",{writable:!0,enumerable:!1,value:D.deepClone(r)}),Object.defineProperty(e,"[[patches]]",{writable:!0,enumerable:!1,value:[]}),Object.defineProperty(e,"[[batch]]",{writable:!0,enumerable:!1,value:1}),Object.defineProperty(e,"[[syncRate]]",{writable:!0,enumerable:!1,value:0}),Object.defineProperty(e,"toJSON",{value:function(){return this["[[attributes]]"]}}),J(e,r),e.on(".change",(function(){t&&clearTimeout(t),t=setTimeout((function(){e.uid&&e.emit(".sync",new j({resource:e}))}),e["[[syncRate]]"])})),e.on(".sync",(function(t){var r=t.socket,n=t.patches,i=t.batchId;t.resource;K[e.uid]&&K[e.uid].forEach((function(e){var t=e.socket,i=e.resource;if(r!=t)try{q(i,n),console.log("emitting","".concat(i.uid,".mergePatches")),t.emit("".concat(i.uid,".mergePatches"),n)}catch(e){}})),r&&r.emit("".concat(e.uid,".mergeBatch"),i)})),B[e.uid]&&D.applyPatch(r,B[e.uid])},B={},F=function(e,t){var r;B[e.uid]=B[e.uid]||[],(r=B[e.uid]).push.apply(r,P()(t))},M=function(e,t){B[e.uid]=B[e.uid].filter((function(e){return!t.includes(e)}))},Z=function(e){if(!e["[[patches]]"])return[];var t=[];return e["[[patches]]"].forEach((function(r){var n=!r.staged;r.batchId||(r.batchId=e["[[batch]]"]),n&&(r.staged=!0,t.push(r))})),t},q=function(e,t){return e["[[patches]]"]=C.transform(e["[[patches]]"],t),G(e,t)},W=function(e){return e["[[batch]]"]++},z=function(e,t){var r=e["[[patches]]"].filter((function(e){return e.batchId===t}));return e["[[patches]]"]=e["[[patches]]"].filter((function(e){return e.batchId!==t})),G(e,r)},H=function(e,t){var r=JSON.stringify(t);e["[[patches]]"]=e["[[patches]]"].filter((function(e){return!r.includes(JSON.stringify(e))}));var n=D.deepClone(e["[[base]]"]);D.applyPatch(n,e["[[patches]]"]),e["[[attributes]]"]=n,J(e,n)},Y=function(e,t){var r;return e&&e["[[patches]]"]?(D.applyPatch(e["[[attributes]]"],t),(r=e["[[patches]]"]).push.apply(r,P()(t)),t):[]},G=function(e,t){D.applyPatch(e["[[base]]"],t);var r=D.deepClone(e["[[base]]"]);return D.applyPatch(r,e["[[patches]]"]),e["[[attributes]]"]=r,J(e,r),e.emit(".rebase",e["[[base]]"]),t},V=function(e,t){var r=D.deepMerge(e["[[attributes]]"],t["[[attributes]]"]),n=D.deepMerge(e["[[base]]"],t["[[base]]"]);D.applyPatch(r,e["[[patches]]"]),e["[[base]]"]=n,e["[[attributes]]"]=r,J(e,r),e.emit(".rebase",e["[[base]]"])},J=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(g.each)(t,(function(t,n){n&&n.on&&(n.on(".rebase",(function(n){var i=e["[[base]]"];!1!==r&&(i=i[r]),i[t]=n})),n.on(".change",(function(r){var n,i=r.map((function(e){return{op:e.op,path:"/".concat(t).concat(e.path),value:e.value}}));(n=e["[[patches]]"]).push.apply(n,P()(i)),e.emit(".change",i)})))}))},K={},X=function(e){var t={},r=e.session;return{cache:function(n){t[n.uid]?V(t[n.uid],n):(K[n.uid]=K[n.uid]||[],K[n.uid].push({resource:n,socket:e}),t[n.uid]=n,e.on("".concat(n.uid,".sync"),function(){var t=k()(O.a.mark((function t(i,o){var s,a,c,u,f;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=i.batchId,a=i.patches,i.attributes,t.next=3,Q(n,a,r);case 3:c=t.sent,u=c.updateSuccessful,f=c.invalidPatches,o({updateSuccessful:u,invalidPatches:f}),n.emit(".sync",new j({resource:n,batchId:s,socket:e}));case 8:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()))},getCached:function(){var e=k()(O.a.mark((function e(r){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t[r]);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},Q=function(){var e=k()(O.a.mark((function e(t,r,n){var i,o,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[],o=[],e.next=4,Object(g.eachAsync)(r,function(){var e=k()(O.a.mark((function e(r,s){var a,c,u,f,h;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s.path.split("/").slice(1),c=w()(a,1),u=c[0],f=Object(g.getMetadata)(t,u),h=f.writeAccessTest,f.namespace,void 0!==h){e.next=6;break}i.push(s),e.next=10;break;case 6:return e.next=8,h.call(t,{session:n,resource:t});case 8:e.sent?i.push(s):o.push(s);case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}());case 4:return Y(t,i),s=i.length===r.length,e.abrupt("return",{updateSuccessful:s,validPatches:i,invalidPatches:o});case 7:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),$=Symbol(),ee=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,t),e=s()(this,d()(t).call(this)),U(c()(e),r),e}return l()(t,e),f()(t,[{key:"emit",value:function(e){for(var r,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return this[$]&&".change"==e?null:(r=_()(d()(t.prototype),"emit",this)).call.apply(r,[this,e].concat(i))}},{key:"startBatchUpdate",value:function(){this[$]=!0}},{key:"commitBatchUpdate",value:function(){this[$]=!1,this.emit(".change")}}],[{key:"on",value:function(e,t){var r=this;return e=Array.isArray(e)?e.map((function(e){return"".concat(r.name,".").concat(e)})):"".concat(this.name,".").concat(e),this.events.on(e,t)}},{key:"emit",value:function(e){var t;console.log("Emitting: ".concat(this.name,".").concat(e));for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return(t=this.events).emit.apply(t,["".concat(this.name,".").concat(e)].concat(n))}},{key:"nowAndOn",value:function(e,t){var r=this;return e=Array.isArray(e)?e.map((function(e){return"".concat(r.name,".").concat(e)})):"".concat(this.name,".").concat(e),this.events.nowAndOn(e,t)}}]),f()(t,[{key:"set",value:function(e){var t,r=[];Object(g.each)(e,(function(e,t){var n={op:"replace",path:"/".concat(e),value:t};r.push(n)})),this.emit(".change",r),(t=this["[[patches]]"]).push.apply(t,r),Object.assign(this["[[attributes]]"],e)}},{key:"uid",get:function(){return void 0!==this.id?"".concat(this.constructor.name,".").concat(this.id):null}},{key:"validation",get:function(){return this["[[validation]]"].for(this)}}]),t}(g.EventEmitter);function te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function re(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?te(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}m()(ee,"events",new g.EventEmitter),Object.defineProperty(ee.prototype,"[[validation]]",{writable:!0,enumerable:!1,value:(N={},{handlers:N,for:function(e){e["[[validationState]]"]||Object.defineProperty(e,"[[validationState]]",{enumerable:!1,value:{}});var t=e["[[validationState]]"],r=function(e){return n(e).length>0},n=function(t){var r=N[t];if(void 0!==r){var n=e[t],i=[],o=Object(g.toTitleCase)(t);return r.forEach((function(t){return t.call(e,{property:n,label:o,errors:i,resource:e})})),i}return[]},i={addHandler:function(e,t){N[e]=N[e]||[],N[e].push(t)},errorMessageFor:function(e){var t=n(e);if(0===t.length)return" ";if(1===t.length)return"".concat(Object(g.toTitleCase)(e)," ").concat(t[0]);var r=t.pop();return"".concat(Object(g.toTitleCase)(e)," ").concat(t.join(", ")," and ").concat(r)},shouldShowErrorsFor:function(e){return!0===t[e]&&r(e)},showErrorsFor:function(r){t[r]=!0,e.emit(".change")},hideErrorsFor:function(e){t[e]=!1},showAllErrors:function(){Object(g.each)(N,(function(e){t[e]=!0})),e.emit(".change")},hideAllErrors:function(){Object(g.each)(N,(function(e){t[e]=!1})),e.emit(".change")},get isInvalid(){var e=!1;return Object(g.each)(N,(function(t){e=e||r(t)})),e},get isValid(){return!i.isInvalid}};return i}})});var ne=["String","Boolean","Number","Date","Function"],ie=[Object.prototype,Function.prototype,ee.prototype,ee,g.EventEmitter.prototype,void 0,null],oe=function(e){return"function"==typeof e?["length","name","prototype"]:["constructor","[[attributes]]","[[patches]]","[[base]]","[[batch]]","[[validation]]"]},se=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=new g.EventEmitter,r=function(){if(!fe(e))throw Error("$interface must be a plain JavaScript Object");var r=n("global",e);return Object.defineProperty(r,"emit",{enumerable:!1,value:function(){return t.emit.apply(t,arguments)}}),r},n=function e(t,r){for(var n={},o={},u=function(e){Object(g.each)(Object.getOwnPropertyDescriptors(e),(function(t,i){oe(e).includes(t)||(o[t]=r[t],n[t]=i)}))},f=r;!ie.includes(f);f=f.__proto__)u(f);return{type:"object",attributes:Object(g.map)(o,(function(o,u){var f=n[o],h=Object(g.getMetadata)(r,o);return ae(u,f)?i("".concat(t,"/").concat(o),u,f,h,r,o):fe(u,f)?e("".concat(t,"/").concat(o),u):he(u,f)?s("".concat(t,"/").concat(o),u,f,h,r,o):le(u,f)?a("".concat(t,"/").concat(o),u,f,h,r,o):pe(u,f)?c("".concat(t,"/").concat(o),u,f,h,r,o):void 0}))}},i=function(e,t){var r=new t;return{name:e,type:"class",className:t.name,classMethods:o(e,t),instanceMethods:o("".concat(e,"/#"),r)}},o=function(e,t){for(var r={},i=function(e){Object(g.each)(Object.getOwnPropertyDescriptors(e),(function(t,n){oe(e).includes(t)||(r[t]=n)}))},o=t;!ie.includes(o);o=o.__proto__)i(o);return Object(g.map)(r,(function(r,i){var o=Object(g.getMetadata)(t,r);return fe(i.value,i)?n("".concat(e,"/").concat(r),i.value,i,o,t,r):he(i.value,i)?s("".concat(e,"/").concat(r),i.value,i,o,t,r):le(i.value,i)?a("".concat(e,"/").concat(r),i.value,i,o,t,r):pe(i.value,i)?c("".concat(e,"/").concat(r),i.value,i,o,t,r):void 0}))},s=function(e,r,n,i,o){var s=i.isShared,a=i.readAccessTest,c=i.usesSession,u=i.isStream,f=i.original;return s?{isStream:u,name:e,type:"shared-function",value:u?f.toString():r.toString()}:(t.on(e,function(){var e=k()(O.a.mark((function e(t){var n,i,s,u,f,h,l,p,d,v,_,y,m,g,b;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.args,t.uid,i=t.attributes,s=t.patches,u=t.socket,f=t.send,t.onClose,u.cache=u.cache||X(u),h=u.session,l="function"==typeof o?o:new o.constructor(i),e.next=6,Q(l,s,h);case 6:if(p=e.sent,d=p.updateSuccessful,v=p.invalidPatches,d){e.next=11;break}return e.abrupt("return",f({error:!0,invalidPatches:v,message:"You are not authorized to update the resource as requested"}));case 11:if(e.t0=void 0!==a,!e.t0){e.next=16;break}return e.next=15,a.call(l,{session:h,resource:l});case 15:e.t0=!e.sent;case 16:if(!e.t0){e.next=18;break}return e.abrupt("return",f({error:!0,message:"You are not authorized to call this method"}));case 18:m=u.session.createSlice(),g=function(){var e=k()(O.a.mark((function e(t,r){var n,i,o,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.cache,i=m,o=function(){return g(t,r)},e.next=5,_e(t,{cache:n,session:i,callback:o});case 5:s=e.sent,f(s,r);case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),c&&(y=u.session.createSlice(),n.unshift(y),y.onChange((function(){return b()}))),(b=function(){_&&_.destroy&&_.destroy();try{_=r.apply(l,n)}catch(e){f({error:!0,message:e.message})}_&&_.catch&&_.catch((function(e){return f({error:!0,message:e.message})})),de(_)?_.observe((function(e){return g(e,!0)})):ve(_)?_.then((function(e){return g(e)})):g(_)})();case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),{name:e,type:"remote-function"})},a=function(e,t,r,n,i,o){var a=n.validators;return{name:e,key:o,type:"property",enumerable:r.enumerable,get:s("".concat(e,".get"),r.get||function(){return null},r,n,i),set:s("".concat(e,".set"),r.set||function(){return null},r,n,i),validators:a&&a.map((function(e){return e.toString()}))}},c=function(e,t,r,n,i,o){var s=n.validators;return{name:e,key:o,type:"attribute",value:r.value,validators:s&&s.map((function(e){return e.toString()}))}};return r()},ae=function(e){return"function"==typeof e&&e.prototype instanceof ee},ce=function(e){return e instanceof ee},ue=function(e){return Array.isArray(e)},fe=function(e){return e&&e.__proto__===Object.prototype},he=function(e){return"function"==typeof e&&!ae(e)},le=function(e,t){return"function"==typeof t.get||"function"==typeof t.set},pe=function(e,t){return[ae,fe,he,le].every((function(r){return!r(e,t)}))},de=function(e){return e&&"function"==typeof e.observe},ve=function(e){return e&&"function"==typeof e.then&&!de(e)},_e=function(){var e=k()(O.a.mark((function e(t,r){var n,i,o,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.cache,i=r.session,o=r.callback,s=function(e){return _e(e,{cache:n,session:i,callback:o})},t){e.next=4;break}return e.abrupt("return",t);case 4:if(!ae(t)){e.next=6;break}return e.abrupt("return",{_class_:t.name});case 6:if(a=t,!ne.includes(a.constructor.name)){e.next=8;break}return e.abrupt("return",t);case 8:if(!ue(t)){e.next=12;break}return e.next=11,Promise.all(t.map((function(e,t){return s(e)})));case 11:return e.abrupt("return",e.sent);case 12:if(!fe(t)){e.next=16;break}return e.next=15,Object(g.mapAsync)(t,(function(e,t){return s(t)}));case 15:return e.abrupt("return",e.sent);case 16:if(n.cache(t),!ce(t)){e.next=25;break}return e.t0=re,e.t1={},e.next=22,Object(g.mapAsync)(t["[[attributes]]"],function(){var e=k()(O.a.mark((function e(r,n){var a,c,u,f,h;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Object(g.getMetadata)(t,r),c=a.readAccessTest,u=a.namespace,void 0!==c){e.next=8;break}return e.next=5,s(n);case 5:return e.abrupt("return",e.sent);case 8:return i.onChange(o),f=t,(h=c.call(f,{session:i,resource:f}))instanceof Promise&&config.audit&&console.warn("Running Asynchronous Authentication Checks for ".concat(u," during serailization")),e.next=14,h;case 14:if(e.sent){e.next=18;break}return e.abrupt("return",null);case 18:return e.next=20,s(n);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}());case 22:return e.t2=e.sent,e.t3={_proto_:t.constructor.name},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 25:case"end":return e.stop()}var a}),e)})));return function(t,r){return e.apply(this,arguments)}}(),ye=r(36),me=r.n(ye),ge=r(26),be=r.n(ge),we=["String","Boolean","Number","Date","Function"],Ee=function(e){var t=Oe({socket:e}),r={Resource:ee,List:L},n=function(e){var t=function(e){function t(){return i()(this,t),s()(this,d()(t).apply(this,arguments))}return l()(t,e),t}(ee);return Object.defineProperty(t,"name",{value:e.className}),o(t,e.classMethods),o(t.prototype,e.instanceMethods),t},o=function e(t,r){return Object(g.each)(r,(function(r,i){switch(i.type){case"class":t[r]=n(i);break;case"object":t[r]=e({},i.attributes);break;case"shared-function":t[r]=c(i);break;case"remote-function":t[r]=u(i);break;case"property":f(t,r,i);break;case"attribute":t[r]=h(i,t)}})),t},a=function(e){switch(e.type){case"shared-function":return c(e);case"remote-function":return u(e)}},c=function(e){var t=e.isStream,r=(e.prependEmit,e.value),n=new Function("return ".concat(r))();return t?function(e){var t=function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return e.call.apply(e,[this].concat(n,[t]))};return function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return be()(g.Pipe,[[this,t]].concat(r))}}(n):n};var u=function(t){var r=t.name,n=function(t,n){var i,o=this.uid,s=this["[[attributes]]"],a=Z(this),c=function(){return t(i)},u=function(e){e&&e.error&&(e.invalidPatches,t.throw(new Error(e.message))),i=p(e,c),t(i)};e.emit(r,{uid:o,patches:a,args:n,attributes:s},u)};return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new g.Pipe([this,n],t)}},f=function(e,t,r){var n=e.validation;n&&r.validators&&r.validators.forEach((function(e){n.addHandler(r.key,c({value:e}))})),Object.defineProperty(e,t,{enumerable:r.enumerable,get:a(r.get),set:a(r.set)})},h=function(e,t){var r=t.validation;return r&&e.validators&&e.validators.forEach((function(t){r.addHandler(e.key,c({value:t}))})),e.value},p=function e(n,i){var o=function(t){return e(t,i)};if(!n)return n;if(we.includes(n.constructor.name))return n;if(Array.isArray(n))return be()(L,P()(n.map((function(e){return o(e)}))));var s=n._class_,a=n._proto_,c=me()(n,["_class_","_proto_"]);return s?r[s]:a?t.register(new r[a](Object(g.map)(c,(function(e,t){return o(t)}))),i):Object(g.map)(c,(function(e,t){return o(t)}))};return function(e){if("object"!==T()(e))throw Error("schema must be a plain JavaScript Object");return o(r,e.attributes)}},Oe=function(e){var t=e.socket,r={};return window.bin=r,{register:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(r[e.uid])r[e.uid].callbacks.includes(n)||r[e.uid].callbacks.push(n),V(r[e.uid].resource,e),e=r[e.uid].resource;else{var i=function(){r[e.uid].callbacks.forEach((function(e){return e()}))};e.on(".change",(function(){return i()})),e.on(".sync",(function(r){var n=r.patches,o=W(e);t.emit("".concat(e.uid,".sync"),{patches:n,batchId:o},(function(t){var r=t.updateSuccessful,n=t.invalidPatches;r||(H(e,n),i())}))})),t.on("".concat(e.uid,".mergeBatch"),(function(t){z(e,t)})),t.on("".concat(e.uid,".mergePatches"),(function(t){q(e,t),i()})),r[e.uid]={resource:e,callbacks:[n]}}return e}}},Se=r(37);r(20);r(23).Duplex;var ke=r(34),xe=(r(24),r(25),r(27)),Pe=r.n(xe),Ae=r(38),Te=r.n(Ae),Re=function(e){function t(){var e;return i()(this,t),e=s()(this,d()(t).call(this)),m()(c()(e),"handleMessage",(function(r){var n=r.data;e.timeLastReceived=Date.now();var i=JSON.parse(n),o=Te()(i),s=o[0],a=o[1],u=o[2],f=o.slice(3),h=e.inboxId+1,l=e.createRespond(u);f.forEach(e.removeFromOutbox),parseInt(u)===h?(e.receipts.push(u),e.inboxId=u,_()(d()(t.prototype),"emit",c()(e)).call(c()(e),s,a,l),e.resolveInbox()):null!=u?(e.receipts.push(u),e.saveToInbox(u,s,a),e.requestMessage(h)):_()(d()(t.prototype),"emit",c()(e)).call(c()(e),s,a,l)})),m()(c()(e),"removeFromInbox",(function(t){delete e.inbox[t]})),m()(c()(e),"removeFromOutbox",(function(t){delete e.outbox[t]})),m()(c()(e),"clearReceipts",(function(){e.timeLastSent<Date.now()-1e4&&e.receipts.length>0&&e.socket.send(JSON.stringify(["__ping__",null,null].concat(P()(e.getReceipts()))))})),e.timeLastSent=0,e.timeLastReceived=0,e.inboxId=0,e.outboxId=0,e.outbox={},e.inbox={},e.receipts=[],e.clearReceiptsTimer=setInterval(e.clearReceipts,1e4),e}return l()(t,e),f()(t,[{key:"bind",value:function(e){this.socket=e,e.addEventListener("message",this.handleMessage),this.on("__request_message__",this.resendMessage)}},{key:"emit",value:function(e,t,r){var n=++this.outboxId,i=JSON.stringify([e,t,n].concat(P()(this.getReceipts())));this.saveToOutbox(n,i),this.socket.send(i),this.timeLastSent=Date.now(),r&&this.on("__response_".concat(n,"__"),r)}},{key:"requestMessage",value:function(e){this.socket.send(JSON.stringify(["__request_message__",e]))}},{key:"resendMessage",value:function(e){var t=this.outbox[e];this.socket.send(t)}},{key:"saveToInbox",value:function(e,t,r){this.inbox[e]=[t,r]}},{key:"saveToOutbox",value:function(e,t){this.outbox[e]=t}},{key:"resolveInbox",value:function(){for(;void 0!==this.inbox[this.inboxId+1];){var e=w()(this.inbox[++this.inboxId],2),r=e[0],n=e[1],i=this.createRespond(this.inboxId);_()(d()(t.prototype),"emit",this).call(this,r,n,i),this.removeFromInbox(this.inboxId)}Le(this.inbox)||this.requestMessage(this.inboxId+1)}},{key:"getReceipts",value:function(){var e=this.receipts;return this.receipts=[],e}},{key:"createRespond",value:function(e){var t=this;return function(r,n){return t.emit("__response_".concat(e,"__"),r,n)}}}]),t}(g.EventEmitter),Le=function(e){return 0===Object.keys(e).length},Ie=r(28),Ne=function(e,t){return new Promise((function(r){return Object(Ie.sign)(e,t,(function(e,t){return r(t)}))}))},De=function(e,t){return new Promise((function(r){return Object(Ie.verify)(e,t,(function(e,t){return r(t)}))}))},Ce=function(e,t){for(var r in e)t(r,e[r])},je=0,Ue={},Be=function(e){function t(e){var r;i()(this,t),r=s()(this,d()(t).call(this));var n,o=(n=c()(r),Ue[++je]=n,je);return r.id=o,r.bind(e),r.emit("__id__",o),r.clientSecret=e.clientSecret,e.addEventListener("close",(function(){clearInterval(r.clearReceiptsTimer),function(e){delete Ue[e]}(o)})),r}return l()(t,e),f()(t,[{key:"session",get:function(){return this.sessionHead?this.sessionHead.createSlice():null}}],[{key:"listen",value:function(e,r,n){var o,s=(o={},function e(t,r){var n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return null};i()(this,e),this["[[attributes]]"]=t,this["[[agent]]"]=r||new g.EventEmitter,this["[[callback]]"]=o,this["[[pipes]]"]=n}return f()(e,[{key:"onAllChanges",value:function(e){this["[[agent]]"].on("*",e)}},{key:"onChange",value:function(e){var t=this;this["[[callback]]"]=function(r){r!==t&&(Object.assign(t["[[attributes]]"],r["[[attributes]]"]),e())}}},{key:"createSlice",value:function(){return new e(this["[[attributes]]"],this["[[agent]]"])}},{key:"removeListeners",value:function(){this["[[pipes]]"].forEach((function(e){return e.destroy()}))}},{key:"data",get:function(){return Ce(this,(function(e,t){if(!["[[pipes]]","[[agent]]","[[callback]]","[[attributes]]"].includes(e))throw Error("Tried to assign ".concat(e," to the session. Session properties must be initialized when 'serve' is invoked. This will result in unpredictable behavior."))})),this["[[attributes]]"]}}],[{key:"loadFor",value:function(t){var r=t.clientSecret;return new Promise((function(n){t.emit("__load_session__",null,function(){var i=k()(O.a.mark((function i(s){var a,c;return O.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!s){i.next=6;break}return i.next=3,De(s,r);case 3:i.t0=i.sent,i.next=7;break;case 6:i.t0={};case 7:a=i.t0,c=o[r]?o[r]:new e(a),o[r]=c,c.onAllChanges(k()(O.a.mark((function e(){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ne(c.data,r);case 2:n=e.sent,t.emit("__save_session__",n);case 4:case"end":return e.stop()}}),e)})))),n(c);case 12:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}())}))}}]),e}();return Ce(t,(function(i,o){if("object"===T()(o)&&null!==o){var s=e(o,"".concat(r,".").concat(i));Object.defineProperty(n.prototype,i,{get:function(){return new s(this["[[attributes]]"][i],this["[[agent]]"],this["[[pipes]]"],this["[[callback]]"])}})}else Object.defineProperty(n.prototype,i,{get:function(){var e=this["[[agent]]"].on("".concat(r,".").concat(i),this["[[callback]]"]);return this["[[pipes]]"].find((function(t){return t.isEqual(e)}))?e.destroy():this["[[pipes]]"].push(e),this["[[attributes]]"][i]||t[i]},set:function(e){this["[[attributes]]"][i]=e,this["[[agent]]"].emit("".concat(r,".").concat(i),this)}})})),n}(r,"session")),a=new ke.a({server:e});function c(e){return u.apply(this,arguments)}function u(){return(u=k()(O.a.mark((function e(r){var i,o,a,u,f,h,l;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=r.data,o=r.target,a=i.split(" "),u=w()(a,2),f=u[0],h=u[1],e.t0=f,e.next="initialize"===e.t0?5:"mount"===e.t0?12:15;break;case 5:return o.removeEventListener("message",c),l=new t(o),e.next=9,s.loadFor(l);case 9:return l.sessionHead=e.sent,n(l),e.abrupt("break",15);case 12:return o.removeEventListener("message",c),Ue[h]?Ue[h].bind(o):o.send('["__reload__"]'),e.abrupt("break",15);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a.on("headers",(function(e,t,r){var n=Pe.a.parse(t.headers.cookie||"").clientSecret;n||(n=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=t.length,n=0;n<40;n++)e+=t.charAt(Math.floor(Math.random()*r));return e}(),e.push("Set-Cookie: ".concat(Pe.a.serialize("clientSecret",n))));r.clientSecret=n})),a.on("connection",(function(e){e.addEventListener("message",c)}))}}]),t}(Re);var Fe=r(14),Me=r.n(Fe),Ze=r(39),qe=r.n(Ze),We=r(40),ze=r.n(We);function He(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var Ye=r(74),Ge=r(75),Ve=Ge(),Je=r(17).Server(Ve),Ke=r(76),Xe=r(77),Qe=r(78),$e="".concat("./.storage","/sessions"),et="".concat("./.storage","/uploads");Me.a.existsSync($e)||Me.a.mkdirSync($e),Me.a.existsSync(et)||Me.a.mkdirSync(et);var tt=r(79),rt=new(r(80)(tt))({path:$e}),nt=function(e){return Ke(Object(g.deepMerge)({origin:function(t,r){!e.useWhiteList||e.clientWhitelist.includes(t)?r(null,t):r(null,"")},credentials:!0},e))},it=function(e,t,r){e.hostname.includes("localhost")||"http"!==e.headers["x-forwarded-proto"]?r():t.redirect("https://".concat(e.hostname).concat(e.originalUrl))},ot={port:process.env.BACKEND_PORT||8080,models:{},session:{},database:{user:process.env.DB_USER||"Josephine",password:process.env.DB_PASSWORD||"P00p!",database:process.env.DB_NAME||"Josephine",port:process.env.DB_PORT||5432},sessionStorage:{secret:process.env.SESSION_SECRET||"keyboard cat",store:rt,resave:!0,saveUninitialized:!0},cors:{useWhiteList:process.env.USE_CORS_WHITE_LIST||!0,clientWhitelist:process.env.CORS_WHITE_LIST||[]}};function st(e){return at.apply(this,arguments)}function at(){return(at=k()(O.a.mark((function e(t){var r,n,i,o,s,a,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(g.deepMerge)(ot,t),n="function"==typeof r.models?pt(r.models):r.models,e.next=4,Object(Se.connect)(r.database);case 4:i=nt(r.cors),o=Xe(),s=tt(r.sessionStorage),a=se(n),c=ht(a),Ve.use(it),Ve.use(s),Ve.use(o),Ve.use(i),Ve.use(Ge.static(Ye.resolve("./public"))),Ve.get("/init",(function(e,t){return t.json({ok:!0})})),Ve.post("/upload",ft),Ve.get("/cdn*",ut),Ve.get("/*",ct),Be.listen(Je,r.session,c),Je.listen(r.port),console.log("Listening on ".concat(r.port));case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ct=function(e,t){t.sendFile(Ye.resolve("./public/index.html"))},ut=function(e,t){var r=e.url.replace("/cdn","".concat(et,"/")),n=r.split(".").pop(),i=Me.a.statSync(r),o=qe.a.getType(n);t.writeHead(200,{"Content-Type":o,"Content-Length":i.size}),Me.a.createReadStream(r).pipe(t)},ft=function(e,t){var r=new Qe.IncomingForm,n=[];r.parse(e,(function(e,r,i){Object.values(i).forEach((function(e){var t=e.name.split(".").pop(),r="".concat(lt(),".").concat(t);n.push("/cdn/".concat(r)),ze()(e.path,"".concat(et,"/").concat(r))})),t.end(JSON.stringify(n))}))},ht=function(e){return function(t){t.on("*",(function(r,n,i){e.emit(i,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?He(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):He(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},r,{socket:t,send:n}))})),t.emit("install",e)}},lt=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=t.length,n=0;n<12;n++)e+=t.charAt(Math.floor(Math.random()*r));return e};function pt(e){var t={};return e.keys().forEach((function(r){if(!r.includes("__")){var n=r.replace(".js","").split("/").pop(),i=e(r);i[n]&&(t[n]=i[n])}})),t}}]);