module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=31)}([function(e,t){e.exports=require("triframe/core")},function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,t){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,t){e.exports=require("@babel/runtime/helpers/typeof")},function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/taggedTemplateLiteral")},function(e,t){e.exports=require("@babel/runtime/helpers/toConsumableArray")},function(e,t){e.exports=require("@babel/runtime/helpers/classCallCheck")},function(e,t){e.exports=require("@babel/runtime/helpers/construct")},function(e,t){e.exports=require("@babel/runtime/helpers/toArray")},function(e,t){e.exports=require("pg")},function(e,t,n){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=27)}([function(e,t){e.exports=n(0)},function(e,t){e.exports=n(4)},function(e,t){e.exports=n(7)},function(e,t){e.exports=n(13)},function(e,t){e.exports=n(14)},function(e,t){e.exports=n(8)},function(e,t){e.exports=n(15)},function(e,t){e.exports=n(16)},function(e,t){e.exports=n(1)},function(e,t){e.exports=n(17)},function(e,t){e.exports=n(18)},function(e,t){e.exports=n(9)},function(e,t){e.exports=n(5)},function(e,t){e.exports=n(3)},function(e,t){e.exports=n(19)},function(e,t){e.exports=n(20)},function(e,t){e.exports=n(21)},function(e,t){e.exports=n(2)},function(e,t){e.exports=n(22)},function(e,t){e.exports=n(23)},function(e,t){e.exports=n(24)},function(e,t){e.exports=n(25)},function(e,t){e.exports=n(26)},function(e,t){e.exports=n(27)},function(e,t){e.exports=n(28)},function(e,t){e.exports=n(29)},function(e,t){e.exports=n(30)},function(e,t,n){"use strict";n.r(t),n.d(t,"Resource",(function(){return q})),n.d(t,"List",(function(){return k})),n.d(t,"createSerializer",(function(){return Q})),n.d(t,"createUnserializer",(function(){return fe})),n.d(t,"serve",(function(){return Se}));var r,o=n(5),a=n.n(o),i=n(10),c=n.n(i),u=n(6),s=n.n(u),f=n(4),l=n.n(f),p=n(9),d=n.n(p),h=n(7),v=n.n(h),y=n(0),m=n(2),b=n.n(m),O=n(11),g=n.n(O),j=n(1),E=n.n(j),w=n(14),A=n.n(w),P=n(15),k=function(e){function t(){var e,n;a()(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=s()(this,(e=l()(t)).call.apply(e,[this].concat(o))),Object.defineProperty(d()(n),"[[patches]]",{enumerable:!1,value:[]}),Object.defineProperty(d()(n),"[[events]]",{enumerable:!1,value:new y.EventEmitter}),n}return v()(t,e),c()(t,[{key:"on",value:function(){var e;return(e=this["[[events]]"]).on.apply(e,arguments)}},{key:"emit",value:function(){var e;return(e=this["[[events]]"]).emit.apply(e,arguments)}},{key:"push",value:function(){for(var e,n,r=this.length,o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];var c=a.map((function(e){return{op:"add",path:"/".concat(r++),value:e}}));(e=this["[[patches]]"]).push.apply(e,b()(c)),this.emit("Δ.change",c),(n=A()(l()(t.prototype),"push",this)).call.apply(n,[this].concat(a))}},{key:"insert",value:function(e,t){this.splice(t,0,e);var n={op:"add",path:"/".concat(t),value:e};this["[[patches]]"].push(n),this.emit("Δ.change",[n])}},{key:"replace",value:function(e,t){this[e]=t;var n={op:"replace",path:"/".concat(e),value:t};this["[[patches]]"].push(n),this.emit("Δ.change",[n])}},{key:"remove",value:function(e){this.splice(e,1);var t={op:"remove",path:"/".concat(e)};this["[[patches]]"].push(t),this.emit("Δ.change",[t])}}]),t}(n.n(P)()(Array)),_=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){
/*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017 Joachim Wester
   * MIT license
   */
var n=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},r=Object.prototype.hasOwnProperty;function o(e,t){return r.call(e,t)}function a(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);for(var r in t=[],e)o(e,r)&&t.push(r);return t}function i(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function c(e,t){var n;for(var r in e)if(o(e,r)){if(e[r]===t)return i(r)+"/";if("object"===E()(e[r])&&""!=(n=c(e[r],t)))return i(r)+"/"+n}return""}function u(e,t){var n=[e];for(var r in t){var o="object"===E()(t[r])?JSON.stringify(t[r],null,2):t[r];void 0!==o&&n.push(r+": "+o)}return n.join("\n")}t.hasOwnProperty=o,t._objectKeys=a,t._deepClone=function(e){switch(E()(e)){case"object":return JSON.parse(JSON.stringify(e),(function(e,t){return Array.isArray(t)?g()(k,b()(t)):t}));case"undefined":return null;default:return e}},t.isInteger=function(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0},t.escapePathComponent=i,t.unescapePathComponent=function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},t._getPathRecursive=c,t.getPath=function(e,t){if(e===t)return"/";var n=c(e,t);if(""===n)throw new Error("Object not found in root");return"/"+n},t.hasUndefined=function e(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0}else if("object"===E()(t)){var o=a(t),i=o.length;for(n=0;n<i;n++)if(e(t[o[n]]))return!0}return!1};var s=function(e){function t(t,n,r,o,a){e.call(this,u(t,{name:n,index:r,operation:o,tree:a})),this.name=n,this.index=r,this.operation=o,this.tree=a,this.message=u(t,{name:n,index:r,operation:o,tree:a})}return n(t,e),t}(Error);t.PatchError=s},function(e,t,n){var r={strict:!0},o=n(3),a=function(e,t){return o(e,t,r)},i=n(0);t.JsonPatchError=i.PatchError,t.deepClone=i._deepClone;var c={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=s(n,this.path);r&&(r=i._deepClone(r));var o=f(n,{op:"remove",path:this.from}).removed;return f(n,{op:"add",path:this.path,value:o}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=s(n,this.from);return f(n,{op:"add",path:this.path,value:i._deepClone(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:a(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},u={add:function(e,t,n){return i.isInteger(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:c.move,copy:c.copy,test:c.test,_get:c._get};function s(e,t){if(""==t)return e;var n={op:"_get",path:t};return f(e,n),n.value}function f(e,n,r,o,f,l){if(void 0===r&&(r=!1),void 0===o&&(o=!0),void 0===f&&(f=!0),void 0===l&&(l=0),r&&("function"==typeof r?r(n,0,e,n.path):p(n,0)),""===n.path){var d={newDocument:e};if("add"===n.op)return d.newDocument=n.value,d;if("replace"===n.op)return d.newDocument=n.value,d.removed=e,d;if("move"===n.op||"copy"===n.op)return d.newDocument=s(e,n.from),"move"===n.op&&(d.removed=e),d;if("test"===n.op){if(d.test=a(e,n.value),!1===d.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",l,n,e);return d.newDocument=e,d}if("remove"===n.op)return d.removed=e,d.newDocument=null,d;if("_get"===n.op)return n.value=e,d;if(r)throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",l,n,e);return d}o||(e=i._deepClone(e));var h=(n.path||"").split("/"),v=e,y=1,m=h.length,b=void 0,O=void 0,g=void 0;for(g="function"==typeof r?r:p;;){if(O=h[y],f&&"__proto__"==O)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===b&&(void 0===v[O]?b=h.slice(0,y).join("/"):y==m-1&&(b=n.path),void 0!==b&&g(n,0,e,b)),y++,Array.isArray(v)){if("-"===O)O=v.length;else{if(r&&!i.isInteger(O))throw new t.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",l,n,e);i.isInteger(O)&&(O=~~O)}if(y>=m){if(r&&"add"===n.op&&O>v.length)throw new t.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",l,n,e);if(!1===(d=u[n.op].call(n,v,O,e)).test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",l,n,e);return d}}else if(O&&-1!=O.indexOf("~")&&(O=i.unescapePathComponent(O)),y>=m){if(!1===(d=c[n.op].call(n,v,O,e)).test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",l,n,e);return d}v=v[O]}}function l(e,n,r,o,a){if(void 0===o&&(o=!0),void 0===a&&(a=!0),r&&!Array.isArray(n))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");o||(e=i._deepClone(e));for(var c=new Array(n.length),u=0,s=n.length;u<s;u++)c[u]=f(e,n[u],r,!0,a,u),e=c[u].newDocument;return c.newDocument=e,c}function p(e,n,r,o){if("object"!==E()(e)||null===e||Array.isArray(e))throw new t.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",n,e,r);if(!c[e.op])throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,e,r);if("string"!=typeof e.path)throw new t.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",n,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new t.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",n,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new t.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",n,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",n,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&i.hasUndefined(e.value))throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",n,e,r);if(r)if("add"==e.op){var a=e.path.split("/").length,u=o.split("/").length;if(a!==u+1&&a!==u)throw new t.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",n,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==o)throw new t.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",n,e,r)}else if("move"===e.op||"copy"===e.op){var s=d([{op:"_get",path:e.from,value:void 0}],r);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new t.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",n,e,r)}}function d(e,n,r){try{if(!Array.isArray(e))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(n)l(i._deepClone(n),i._deepClone(e),r||!0);else{r=r||p;for(var o=0;o<e.length;o++)r(e[o],o,n,void 0)}}catch(e){if(e instanceof t.JsonPatchError)return e;throw e}}t.getValueByPointer=s,t.applyOperation=f,t.applyPatch=l,t.applyReducer=function(e,n,r){var o=f(e,n);if(!1===o.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",r,n,e);return o.newDocument},t.validator=p,t.validate=d},function(e,t,n){
/*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017 Joachim Wester
   * MIT license
   */
var r=n(0),o=n(1),a=n(1);t.applyOperation=a.applyOperation,t.applyPatch=a.applyPatch,t.applyReducer=a.applyReducer,t.getValueByPointer=a.getValueByPointer,t.validate=a.validate,t.validator=a.validator;var i=n(0);t.JsonPatchError=i.PatchError,t.deepClone=i._deepClone,t.escapePathComponent=i.escapePathComponent,t.unescapePathComponent=i.unescapePathComponent;var c=new WeakMap,u=function(e){this.observers=new Map,this.obj=e},s=function(e,t){this.callback=e,this.observer=t};function f(e){var t=c.get(e.object);l(t.value,e.object,e.patches,""),e.patches.length&&o.applyPatch(t.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function l(e,t,n,o){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=r._objectKeys(t),i=r._objectKeys(e),c=!1,u=i.length-1;u>=0;u--){var s=e[p=i[u]];if(!r.hasOwnProperty(t,p)||void 0===t[p]&&void 0!==s&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(n.push({op:"remove",path:o+"/"+r.escapePathComponent(p)}),c=!0):n.push({op:"replace",path:o,value:t});else{var f=t[p];"object"==E()(s)&&null!=s&&"object"==E()(f)&&null!=f?l(s,f,n,o+"/"+r.escapePathComponent(p)):s!==f&&n.push({op:"replace",path:o+"/"+r.escapePathComponent(p),value:r._deepClone(f)})}}if(c||a.length!=i.length)for(u=0;u<a.length;u++){var p=a[u];r.hasOwnProperty(e,p)||void 0===t[p]||n.push({op:"add",path:o+"/"+r.escapePathComponent(p),value:r._deepClone(t[p])})}}}t.unobserve=function(e,t){t.unobserve()},t.observe=function(e,t){var n,o=function(e){return c.get(e)}(e);if(o){var a=function(e,t){return e.observers.get(t)}(o,t);n=a&&a.observer}else o=new u(e),c.set(e,o);if(n)return n;if(n={},o.value=r._deepClone(e),t){n.callback=t,n.next=null;var i=function(){f(n)},l=function(){clearTimeout(n.next),n.next=setTimeout(i)};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",l),window.addEventListener("keyup",l),window.addEventListener("mousedown",l),window.addEventListener("keydown",l),window.addEventListener("change",l)):(document.documentElement.attachEvent("onmouseup",l),document.documentElement.attachEvent("onkeyup",l),document.documentElement.attachEvent("onmousedown",l),document.documentElement.attachEvent("onkeydown",l),document.documentElement.attachEvent("onchange",l)))}return n.patches=[],n.object=e,n.unobserve=function(){f(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(o,n),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",l),window.removeEventListener("keyup",l),window.removeEventListener("mousedown",l),window.removeEventListener("keydown",l)):(document.documentElement.detachEvent("onmouseup",l),document.documentElement.detachEvent("onkeyup",l),document.documentElement.detachEvent("onmousedown",l),document.documentElement.detachEvent("onkeydown",l)))},o.observers.set(t,new s(t,n)),n},t.generate=f,t.compare=function(e,t){var n=[];return l(e,t,n,""),n}},function(e,t,n){var r=Array.prototype.slice,o=n(5),a=n(4),i=e.exports=function(e,t,n){return n||(n={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=E()(e)&&"object"!=E()(t)?n.strict?e===t:e==t:function(e,t,n){var s,f;if(c(e)||c(t))return!1;if(e.prototype!==t.prototype)return!1;if(a(e))return!!a(t)&&(e=r.call(e),t=r.call(t),i(e,t,n));if(u(e)){if(!u(t))return!1;if(e.length!==t.length)return!1;for(s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}try{var l=o(e),p=o(t)}catch(e){return!1}if(l.length!=p.length)return!1;for(l.sort(),p.sort(),s=l.length-1;s>=0;s--)if(l[s]!=p[s])return!1;for(s=l.length-1;s>=0;s--)if(f=l[s],!i(e[f],t[f],n))return!1;return E()(e)===E()(t)}(e,t,n))};function c(e){return null==e}function u(e){return!(!e||"object"!==E()(e)||"number"!=typeof e.length||"function"!=typeof e.copy||"function"!=typeof e.slice||e.length>0&&"number"!=typeof e[0])}},function(e,t){var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function r(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function o(e){return e&&"object"==E()(e)&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=n?r:o).supported=r,t.unsupported=o},function(e,t){function n(e){var t=[];for(var n in e)t.push(n);return t}(e.exports="function"==typeof Object.keys?Object.keys:n).shim=n}]),x=function(){var e=e||{};e.transform=function(e,n){var r=[];r=r.concat.apply(r,n);var o=JSON.parse(JSON.stringify(e));return r.reduce(t,o)},e.transformAgainstSingleOp=function(e,t){};var t=function(e,t){if(void 0===t.value&&("add"===t.op||"replace"===t.op||"test"===t.op))throw new Error("'value' MUST be defined");if(void 0===t.from&&("copy"===t.op||"move"===t.op))throw new Error("'from' MUST be defined");if(n[t.op])if("function"==typeof n[t.op])n[t.op](t,e);else for(var r=e.length,o=0;o<r;){var a=e[o];o++,n[t.op][a.op]&&n[t.op][a.op](t,a)}return e},n={remove:function(e,t){for(var n,a=t.length,i=0;n=t[i];)("add"!==n.op&&"test"!==n.op||e.path!==n.path)&&(n.from&&(n.from===e.path||0===n.from.indexOf(e.path+"/"))||e.path===n.path||0===n.path.indexOf(e.path+"/"))&&(t.splice(i,1),a--,i--),i++;var c=e.path.lastIndexOf("/");if(c>-1){var u=e.path.substr(c+1),s=e.path.substr(0,c+1);if(o(u))for(a=t.length,i=0;i<a;)n=t[i],i++,0===n.path.indexOf(s)&&(n.path=r(n.path,s,u,-1)),n.from&&0===n.from.indexOf(s)&&(n.from=r(n.from,s,u,-1))}},add:function(e,t){for(var n,a=t.length,i=0;n=t[i];)("add"!==n.op&&"test"!==n.op||e.path!==n.path)&&(n.from&&(n.from===e.path||0===n.from.indexOf(e.path+"/"))||e.path===n.path||0===n.path.indexOf(e.path+"/"))&&(t.splice(i,1),a--,i--),i++;var c=e.path.lastIndexOf("/");if(c>-1){var u=e.path.substr(c+1),s=e.path.substr(0,c+1);if(o(u))for(a=t.length,i=0;i<a;)n=t[i],i++,0===n.path.indexOf(s)&&(n.path=r(n.path,s,u,1)),n.from&&0===n.from.indexOf(s)&&(n.from=r(n.from,s,u,1))}},replace:function(e,t){for(var n,r=0;n=t[r];)(n.from&&(n.from===e.path||0===n.from.indexOf(e.path+"/"))||0===n.path.indexOf(e.path+"/"))&&(t.splice(r,1),r--),r++}};function r(e,t,n,r){var a=e.substr(t.length),i=a.indexOf("/");i>-1||(i=a.length);var c=a.substr(0,i),u=a.substr(i);return o(c)&&r>0&&c>=n||r<0&&c>n?t+(parseInt(c)+r)+u:e}function o(e){var t=~~Number(e);return String(t)===e&&t>=0}return e}(),N=function(e,t){Object.defineProperty(e,"[[attributes]]",{writable:!0,enumerable:!1,value:t}),Object.defineProperty(e,"[[base]]",{writable:!0,enumerable:!1,value:_.deepClone(t)}),Object.defineProperty(e,"[[patches]]",{writable:!0,enumerable:!1,value:[]}),Object.defineProperty(e,"[[batch]]",{writable:!0,enumerable:!1,value:1}),Object.defineProperty(e,"[[syncRate]]",{writable:!0,enumerable:!1,value:0}),I(e,t),"function"==typeof e.onChange&&e.on("Δ.change",(function(t){return U(e,"change",t)}))},T=function(e){var t=[];return e["[[patches]]"].forEach((function(n){var r=!n.staged;n.batchId||(n.batchId=e["[[batch]]"]),r&&(n.staged=!0,t.push(n))})),t},S=function(e,t){var n;return e&&e["[[patches]]"]?(_.applyPatch(e["[[attributes]]"],t),(n=e["[[patches]]"]).push.apply(n,b()(t)),t):[]},C=function(e,t){return e["[[patches]]"]=x.transform(e["[[patches]]"],t),U(e,"merge",t),R(e,t)},D=function(e){return e["[[batch]]"]++},L=function(e,t){var n=e["[[patches]]"].filter((function(e){return e.batchId===t}));return e["[[patches]]"]=e["[[patches]]"].filter((function(e){return e.batchId!==t})),R(e,n)},R=function(e,t){_.applyPatch(e["[[base]]"],t);var n=_.deepClone(e["[[base]]"]);return _.applyPatch(n,e["[[patches]]"]),e["[[attributes]]"]=n,I(e,n),t},I=function(e,t){Object(y.each)(t,(function(t,n){n&&n.on&&n.on("Δ.change",(function(n){var r,o=n.map((function(e){return{op:e.op,path:"/".concat(t).concat(e.path),value:e.value}}));(r=e["[[patches]]"]).push.apply(r,b()(o)),e.emit("Δ.change",o)}))}))},U=function(e,t,n){e.emit("Δ.".concat(t),n);var r="on".concat(Object(y.toCapitalized)(t));"function"==typeof e[r]&&e[r](n)},q=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a()(this,t),e=s()(this,l()(t).call(this)),N(d()(e),n),e}return v()(t,e),c()(t,[{key:"set",value:function(e){Object.assign(this,e)}},{key:"uid",get:function(){return void 0!==this.id?"".concat(this.constructor.name,".").concat(this.id):null}},{key:"validation",get:function(){return this["[[validation]]"].for(this)}}]),t}(y.EventEmitter);Object.defineProperty(q.prototype,"[[validation]]",{writable:!0,enumerable:!1,value:(r={},{for:function(e){e["[[validationState]]"]||Object.defineProperty(e,"[[validationState]]",{enumerable:!1,value:{}});var t=e["[[validationState]]"],n=function(e){return o(e).length>0},o=function(t){var n=r[t];if(void 0!==n){var o=e[t],a=[],i=Object(y.toTitleCase)(t);return n.forEach((function(t){return t({property:o,label:i,errors:a,resource:e})})),a}return[]},a={addHandler:function(e,t){r[e]=r[e]||[],r[e].push(t)},errorMessageFor:function(e){var t=o(e);if(0===t.length)return" ";if(1===t.length)return"".concat(Object(y.toTitleCase)(e)," ").concat(t[0]);var n=t.pop();return"".concat(Object(y.toTitleCase)(e)," ").concat(t.join(", ")," and ").concat(n)},shouldShowErrorsFor:function(e){return!0===t[e]&&n(e)},showErrorsFor:function(n){t[n]=!0,e.emit("Δ.change")},hideErrorsFor:function(e){t[e]=!1},showAllErrors:function(){Object(y.each)(r,(function(e){t[e]=!0})),e.emit("Δ.change")},hideAllErrors:function(){Object(y.each)(r,(function(e){t[e]=!1})),e.emit("Δ.change")},get isInvalid(){var e=!1;return Object(y.each)(r,(function(t){e=e||n(t)})),e},get isValid(){return!a.isInvalid}};return a}})});var F=n(8),M=n.n(F),J=n(12),V=n.n(J),z=n(13),B=n.n(z);function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){B()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Y=["String","Boolean","Number","Date","Function"],G=[Object.prototype,Function.prototype,q.prototype,q,y.EventEmitter.prototype,void 0,null],W=function(e){return"function"==typeof e?["length","name","prototype"]:["constructor","[[attributes]]","[[patches]]","[[base]]","[[batch]]","[[validation]]"]},Q=function(e){var t=function e(t,r){for(var c={},u={},s=function(e){Object(y.each)(Object.getOwnPropertyDescriptors(e),(function(t,n){W(e).includes(t)||(u[t]=r[t],c[t]=n)}))},f=r;!G.includes(f);f=f.__proto__)s(f);return Object(y.map)(u,(function(u,s){var f=c[u],l=Object(y.getMetadata)(r,u);return"private"===l.accessLevel?null:X(s,f)?n("".concat(t,"/").concat(u),s,f,l,r,u):Z(s,f)?e("".concat(t,"/").concat(u),s):$(s,f)?o("".concat(t,"/").concat(u),s,f,l,r,u):ee(s,f)?a("".concat(t,"/").concat(u),s,f,l,r,u):te(s,f)?i("".concat(t,"/").concat(u),s,f,l,r,u):void 0}))},n=function(e,t){var n=new t;return{name:e,type:"class",className:t.name,classMethods:r(e,t),instanceMethods:K({},r("".concat(e,"/#"),n),{sync:o("".concat(e,"/#/sync"),n.sync,{},{},n)})}},r=function(e,n){for(var r={},c=function(e){Object(y.each)(Object.getOwnPropertyDescriptors(e),(function(t,n){W(e).includes(t)||(r[t]=n)}))},u=n;!G.includes(u);u=u.__proto__)c(u);return Object(y.map)(r,(function(r,c){var u=Object(y.getMetadata)(n,r);return Z(c.value,c)?t("".concat(e,"/").concat(r),c.value):$(c.value,c)?o("".concat(e,"/").concat(r),c.value,c,u,n,r):ee(c.value,c)?a("".concat(e,"/").concat(r),c.value,c,u,n,r):te(c.value,c)?i("".concat(e,"/").concat(r),c.value,c,u,n,r):void 0}))},o=function(t,n,r,o,a){var i=o.isShared,c=o.accessLevel,u=o.authCheck,s=o.usesSession;return i?{name:t,type:"shared-function",value:n.toString()}:(e.on(t,function(){var e=V()(M.a.mark((function e(t){var r,o,i,f,l,p,d,h,v;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.args,o=t.uid,i=t.patches,f=t.connection,l=t.send,p=t.onClose,f.cache=f.cache||ae(f),d=function(e,t){s&&f.session.save(),l(ie(e,f),t)},h=o?f.cache.getCached(o):"function"==typeof a?a:new a.constructor,i&&S(h,i),e.t0="private"===c,e.t0){e.next=13;break}if(e.t1="protected"===c,!e.t1){e.next=12;break}return e.next=11,u(f.session,h);case 11:e.t1=!e.sent;case 12:e.t0=e.t1;case 13:if(!e.t0){e.next=15;break}return e.abrupt("return",l({error:!0,message:"You are not authorized to call this method"}));case 15:s&&r.unshift(f.session);try{v=n.apply(h,r)}catch(e){l({error:!0,message:e.message})}v&&v.catch&&v.catch((function(e){return l({error:!0,message:e.message})})),ne(v)?(v.observe((function(e){return d(e,!0)})),p((function(){return v.destroy()}))):re(v)?v.then((function(e){return d(e)})):d(v);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),{name:t,type:"remote-function"})},a=function(e,t,n,r,a,i){var c=r.validators;return{name:e,key:i,type:"property",get:o("".concat(e,".get"),n.get||function(){return null},n,r,a),set:o("".concat(e,".set"),n.set||function(){return null},n,r,a),validators:c&&c.map((function(e){return e.toString()}))}},i=function(e,t,n,r,o,a){var i=r.validators;return{name:e,key:a,type:"attribute",value:n.value,validators:i&&i.map((function(e){return e.toString()}))}};return function(e){if(!Z(e))throw Error("$interface must be a plain JavaScript Object");return t("global",e)}},X=function(e){return"function"==typeof e&&e.prototype instanceof q},Z=function(e){return e&&e.__proto__===Object.prototype},$=function(e){return"function"==typeof e&&!X(e)},ee=function(e,t){return"function"==typeof t.get||"function"==typeof t.set},te=function(e,t){return[X,Z,$,ee].every((function(n){return!n(e,t)}))},ne=function(e){return e&&"function"==typeof e.observe},re=function(e){return e&&"function"==typeof e.then&&!ne(e)},oe={},ae=function(e){var t=e.socket,n={};return{cache:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(oe[e.uid]=oe[e.uid]||{patches:[],branches:[]},C(e,oe[e.uid].patches),!n[e.uid]){n[e.uid]=e,oe[e.uid].branches.push({socket:t,resource:e}),t.on("".concat(e.uid,".sync"),(function(n){var r=n.batchId,a=n.patches;S(e,a),o(r),t.emit("".concat(e.uid,".commitBatch"),r)})),e.on("Δ.sync",(function(){T(e);var t=D(e);o(t,{includeSelf:!0})}));var r=[];e.on("Δ.commiting",(function(){r.push(b()(oe[e.uid].patches))})),e.on("Δ.commited",(function(){var t=r.shift();oe[e.uid].patches=oe[e.uid].patches.filter((function(e){return!t.includes(e)}))}))}var o=function(n){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=o.includeSelf,i=void 0!==a&&a,c=L(e,n);(r=oe[e.uid].patches).push.apply(r,b()(c)),oe[e.uid].branches.forEach((function(e){var n=e.socket,r=e.resource;(t!=n||i)&&(C(r,c),n.emit("".concat(r.uid,".mergePatches"),c))}))};return e},getCached:function(e){return n[e]}}},ie=function e(t,n){var r,o=function(t){return e(t,n)};return t?X(t)?{_class_:t.name}:(r=t,Y.includes(r.constructor.name)?t:function(e){return Array.isArray(e)}(t)?t.map((function(e,t){return o(e)})):Z(t)?Object(y.map)(t,(function(e,t){return o(t)})):function(e){return e instanceof q}(t=n.cache.cache(t))?K({},Object(y.map)(t["[[attributes]]"],(function(e,r){var a=Object(y.getMetadata)(t,e),i=a.accessLevel,c=a.authCheck;return"private"==i?null:"protected"!=i||c(n.session)?o(r):null})),{_proto_:t.constructor.name}):void 0):t},ce=n(16),ue=n.n(ce),se=["String","Boolean","Number","Date","Function"],fe=function(e){var t=le({socket:e}),n={Resource:q,List:k},r=function(e){var t=function(e){function t(){return a()(this,t),s()(this,l()(t).apply(this,arguments))}return v()(t,e),t}(q);return Object.defineProperty(t,"name",{value:e.className}),o(t,e.classMethods),o(t.prototype,e.instanceMethods),t},o=function e(t,n){return Object(y.each)(n,(function(n,o){switch(o.type){case"class":t[n]=r(o);break;case"object":t[n]=e({},o);break;case"shared-function":t[n]=c(o);break;case"remote-function":t[n]=u(o);break;case"property":f(t,n,o);break;case"attribute":t[n]=p(o,t)}})),t},i=function(e){switch(e.type){case"shared-function":return c(e);case"remote-function":return u(e)}},c=function(e){return new Function("return ".concat(e.value))()},u=function(t){var n=t.name,r=function(t,r){var o=this.uid,a=this.getNewPatches?this.getNewPatches():[],i=function(e){e&&e.error&&t.throw(new Error(e.message));var n=d(e,(function(){return t(n)}));t(n)};e.emit(n,{uid:o,patches:a,args:r},(function(t){var c=t.value,u=t.hook;i(c),void 0!==u&&(e.on(u,(function(e){var t=e.value;return i(t)})),e.on("reconnect",(function(){e.emit(n,{uid:o,patches:a,args:r},(function(t){var n=t.value,r=t.hook;i(n),void 0!==r&&e.on(r,(function(e){var t=e.value;return i(t)}))}))})))}))};return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new y.Pipe([this,r],t)}},f=function(e,t,n){var r=e.validation;r&&n.validators&&n.validators.forEach((function(e){r.addHandler(n.key,c({value:e}))})),Object.defineProperty(e,t,{get:i(n.get),set:i(n.set)})},p=function(e,t){var n=t.validation;return n&&e.validators&&e.validators.forEach((function(t){n.addHandler(e.key,c({value:t}))})),e.value},d=function e(r,o){var a=function(t){return e(t,o)};if(!r)return r;if(se.includes(r.constructor.name))return r;if(Array.isArray(r))return g()(k,b()(r.map((function(e){return a(e)}))));var i=r._class_,c=r._proto_,u=ue()(r,["_class_","_proto_"]);return i?n[__class__]:c?t.register(new n[c](Object(y.map)(u,(function(e,t){return a(t)}))),o):Object(y.map)(u,(function(e,t){return a(t)}))};return function(e){if("object"!==E()(e))throw Error("schema must be a plain JavaScript Object");return o(n,e)}},le=function(e){var t=e.socket;return{register:function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;return n.on("Δ.change",(function(){e&&clearTimeout(e),e=setTimeout((function(){n.emit("Δ.sync")}),n["[[syncRate]]"])})),n.on("Δ.sync",(function(){var e=T(n),o=D(n);t.emit("".concat(n.uid,".sync"),{patches:e,batchId:o}),r()})),t.on("".concat(n.uid,".commitBatch"),(function(e){L(n,e)})),t.on("".concat(n.uid,".mergePatches"),(function(e){C(n,e),r()})),n}}},pe=n(17),de=n.n(pe),he=n(3),ve=n.n(he),ye=n(18),me=n.n(ye);function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){B()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ge=n(19)(),je=n(20).Server(ge),Ee=n(21)(je,{serveClient:!1}),we=n(22),Ae=n(23),Pe=n(24);function ke(e){var t={};return e.keys().forEach((function(n){if(!n.includes("__")){var r=n.replace(".js","").split("/").pop(),o=e(n);o[r]&&(t[r]=o[r])}})),t}ve.a.existsSync("./.sessions")||ve.a.mkdirSync("./.sessions"),ve.a.existsSync("./.uploads")||ve.a.mkdirSync("./.uploads");var _e=we({origin:function(e,t){t(null,e)},credentials:!0}),xe=Ae(),Ne=n(25),Te=Ne({store:new(n(26)(Ne))({path:"./.sessions"}),secret:"keyboard cat",resave:!0,saveUninitialized:!0});function Se(e,t){return Ce.apply(this,arguments)}function Ce(){return(Ce=V()(M.a.mark((function e(t,n){var r,o,a;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t="function"==typeof t?ke(t):t,r=new y.EventEmitter,o=Q(r),a=o(t),ge.use(Te),ge.use(xe),ge.use(_e),ge.get("/init",(function(e,t){return t.json({ok:!0})})),ge.post("/upload",De),ge.get("/cdn*",Le),Ee.use((function(e,t){return Te(e.request,e.request.res,t)})),Ee.on("connection",(function(e){var t=e.request.session,n=0,o={socket:e,session:t};e.use((function(t,a){var i=de()(t,3),c=i[0],u=i[1],s=i[2],f=function(){return null},l=!1,p=!1;r.emit(c,Oe({},u,{connection:o,send:function(t,r){l?e.emit(p,{value:t}):(l=!0,r?(p="".concat(n++,": ").concat(c),s({value:t,hook:p})):s({value:t}))},onClose:function(e){return f=e}})),e.on("disconnect",(function(){return f()})),a()})),e.emit("interface",a)})),je.listen(8080);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var De=function(e,t){var n=new Pe.IncomingForm,r=[];n.parse(e,(function(e,n,o){for(var a=Oe({},n,{},o),i=0;i<a.length;i++){var c=a[i],u=c.name.split(".").pop(),s="".concat(Re(),".").concat(u);r.push("/cdn/".concat(s)),ve.a.rename(c.path,"".concat("./.uploads","/").concat(s),(function(e){if(e)throw e}))}t.end(JSON.stringify(r))}))},Le=function(e,t){var n=e.url.replace("/cdn","".concat("./.uploads","/")),r=n.split(".").pop(),o=ve.a.statSync(n),a=me.a.lookup(r);t.writeHead(200,{"Content-Type":a,"Content-Length":o.size}),ve.a.createReadStream(n).pipe(t)},Re=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length,r=0;r<12;r++)e+=t.charAt(Math.floor(Math.random()*n));return e}}])},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("@babel/runtime/helpers/getPrototypeOf")},function(e,t){e.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("@babel/runtime/helpers/inherits")},function(e,t){e.exports=require("@babel/runtime/helpers/assertThisInitialized")},function(e,t){e.exports=require("@babel/runtime/helpers/createClass")},function(e,t){e.exports=require("@babel/runtime/helpers/get")},function(e,t){e.exports=require("@babel/runtime/helpers/wrapNativeSuper")},function(e,t){e.exports=require("@babel/runtime/helpers/objectWithoutProperties")},function(e,t){e.exports=require("mime")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("formidable")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("session-file-store")},function(e,t,n){"use strict";n.r(t),n.d(t,"connect",(function(){return V})),n.d(t,"literal",(function(){return pe})),n.d(t,"sql",(function(){return Ee})),n.d(t,"Model",(function(){return qt})),n.d(t,"string",(function(){return Re})),n.d(t,"text",(function(){return Ie})),n.d(t,"numeric",(function(){return Ue})),n.d(t,"float",(function(){return qe})),n.d(t,"integer",(function(){return Fe})),n.d(t,"boolean",(function(){return Me})),n.d(t,"timestamp",(function(){return Je})),n.d(t,"timestamptz",(function(){return Ve})),n.d(t,"date",(function(){return ze})),n.d(t,"time",(function(){return Be})),n.d(t,"point",(function(){return He})),n.d(t,"line",(function(){return Ke})),n.d(t,"lseg",(function(){return Ye})),n.d(t,"path",(function(){return Ge})),n.d(t,"polygon",(function(){return We})),n.d(t,"circle",(function(){return Qe})),n.d(t,"list",(function(){return Xe})),n.d(t,"json",(function(){return Ze})),n.d(t,"serial",(function(){return $e})),n.d(t,"pk",(function(){return et})),n.d(t,"virtual",(function(){return tt})),n.d(t,"hasMany",(function(){return nt})),n.d(t,"belongsTo",(function(){return ot})),n.d(t,"hasOne",(function(){return rt})),n.d(t,"hidden",(function(){return at})),n.d(t,"readonly",(function(){return it})),n.d(t,"hiddenUnless",(function(){return ct})),n.d(t,"readonlyUnless",(function(){return ut})),n.d(t,"shared",(function(){return st})),n.d(t,"stream",(function(){return ht})),n.d(t,"session",(function(){return ft})),n.d(t,"validate",(function(){return lt})),n.d(t,"include",(function(){return pt}));var r=n(1),o=n.n(r),a=n(0),i=n(5),c=n.n(i),u=n(7),s=n.n(u),f=n(3),l=n.n(f),p=n(2),d=n.n(p),h=n(4),v=n.n(h);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=function(){var e=c()(o.a.mark((function e(){var t,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(a.map)(Object(a.group)(Object(a.filter)(a.metadata,(function(e,t){return"persisted"===t.type})),(function(e,t){return Object(a.toTableName)(t.className)})),(function(e,t){return Object(a.index)(t,(function(e,t){return Object(a.toUnderscored)(t.key)}))})),e.t0=k,e.next=4,J.query(P());case 4:if(e.t1=e.sent,n=(0,e.t0)(e.t1),!(r=D(n,t))){e.next=11;break}return console.log("Patching:",r),e.next=11,J.query(r);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(e,t){var n=t.datatype,r=t.typeModifier,o=t.defaultValue,a=t.constraints,i='"'.concat(e,'" ').concat(n);return r&&(i="".concat(i,"(").concat(r,")")),void 0!==o&&(i="".concat(i," DEFAULT ").concat(g(o))),a&&(i="".concat(i," ").concat(j(a))),i},g=function(e){if(null===e)return"NULL";if("number"==typeof e||"boolean"==typeof e)return e;if("string"==typeof e)return"'".concat(e,"'");if("object"==v()(e)&&e.__proto__==Object.prototype)return"'".concat(JSON.stringify(e),"'::json");if(e instanceof Date)return"NOW()";if(Array.isArray(e))return"'".concat(JSON.stringify(e),"'");throw Error("Variable type cannot be coalesced for sql query: ".concat(e))},j=function(e){var t=e.unique,n=e.notNull,r=e.primaryKey,o=e.references,a="";if(t&&(a="".concat(a," UNIQUE ")),n&&(a="".concat(a," NOT NULL ")),r&&(a="".concat(a," PRIMARY KEY ")),o){var i=o.table,c=o.onDelete;a="".concat(a," REFERENCES ").concat(i,"(id) ON DELETE ").concat(T.fromJS.toSQL[c]||"SET NULL")}return a},E=function(e,t){var n=t.table,r=t.onDelete;return"ADD CONSTRAINT ".concat(e,"_fkey FOREIGN KEY(").concat(e,") REFERENCES ").concat(n,"(id) ON DELETE ").concat(T.fromJS.toSQL[r]||"SET NULL")},w=function(e){return"DROP CONSTRAINT ".concat(e,"_fkey")},A=function(e){if(!e)return e;var t=e.split("::");return d()(t,1)[0].replace(/'/g,"")},P=function(){return"\n    SELECT \n        tab.relname as table_name,\n        attr.attname as name,\n        ty.typname as type,\n        attr.atttypmod as type_modifier,\n        con.contype as constraint_type,\n        ref_table.relname as reference_table,\n        con.confdeltype as on_delete,\n        con.confupdtype as on_update,\n        attr.attnotnull as not_null,\n        pg_get_expr(de.adbin, de.adrelid) as default_value\n    FROM\n        pg_class as tab\n        JOIN pg_catalog.pg_namespace as n \n            ON n.oid = tab.relnamespace\n        LEFT JOIN pg_attribute as attr\n            ON tab.oid = attr.attrelid\n        LEFT JOIN pg_type as ty\n            ON attr.atttypid = ty.oid\n        LEFT JOIN pg_attrdef as de\n            ON  \n                tab.oid = de.adrelid\n            AND\n                attr.attnum = de.adnum\n        LEFT JOIN pg_constraint as con \n            ON \n                attr.attrelid = con.conrelid\n            AND\n                attr.attnum = ANY(con.conkey)\n        LEFT JOIN pg_class as ref_table ON con.confrelid = ref_table.oid\n    WHERE \n        tab.relkind = 'r'\n            AND\n        n.nspname = 'public'\n            AND\n        attr.attnum >= 0\n            AND\n        ty.typname IS NOT NULL\n"},k=function(e){return Object(a.map)(Object(a.group)(e.rows,"table_name"),(function(e,t){return Object(a.map)(Object(a.group)(t,"name"),(function(e,t){return{tableName:t[0].table_name,key:t[0].name,datatype:t[0].type,typeModifier:t[0].type_modifier,defaultValue:A(t[0].default_value),constraints:m({notNull:t[0].not_null},Object(a.map)(Object(a.index)(t,_),x))}}))}))},_=function(e,t){var n=t.constraint_type;return C.fromEnum.toJS[n]?C.fromEnum.toJS[n]:"details"},x=function(e,t){var n=t.reference_table,r=t.on_delete;t.on_update;return"references"!=e||{onDelete:T.fromEnum.toJS[r],table:n}},N=[{enum:"r",sql:"RESTRICT",js:"restrict"},{enum:"a",sql:"NO ACTION",js:"noAction"},{enum:"d",sql:"SET DEFAULT",js:"setDefault"},{enum:"c",sql:"CASCADE",js:"cascade"},{enum:"n",sql:"SET NULL",js:"setNull"}],T={fromEnum:{toJS:Object(a.index)(N,"enum","js"),toSQL:Object(a.index)(N,"enum","sql")},fromJS:{toEnum:Object(a.index)(N,"js","enum"),toSQL:Object(a.index)(N,"js","sql")},fromSQL:{toJS:Object(a.index)(N,"sql","js"),toEnum:Object(a.index)(N,"sql","enum")}},S=[{enum:"p",js:"primaryKey"},{enum:"f",js:"references"},{enum:"u",js:"unique"}],C={fromJS:{toEnum:Object(a.index)(S,"js","enum")},fromEnum:{toJS:Object(a.index)(S,"enum","js")}},D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Object,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Object,n=Object(a.unique)([].concat(s()(Object.keys(e)),s()(Object.keys(t)))),r=n.map((function(n){return L(e,t,n)})).sort((function(e){return!e.startsWith("CREATE TABLE")})).filter((function(e){return e})).join(";\n");return r},L=function(e,t,n){var r=F(e,t),o=r.added,i=r.removed;if(o(n))return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array;return'CREATE TABLE "'.concat(e,'" (').concat(Object.values(Object(a.map)(t,O)).join(", "),");")}(n,t[n]);if(i(n))return'DROP TABLE "'.concat(n,'"');var c=R(e[n],t[n]);return c?'ALTER TABLE "'.concat(n,'" ').concat(c):void 0},R=function(e,t){return Object(a.unique)([].concat(s()(Object.keys(e)),s()(Object.keys(t)))).map((function(n){return I(e,t,n)})).filter((function(e){return e.length})).join(", ")},I=function(e,t,n){var r,o,a=F(e,t),i=a.added,c=a.removed;return i(n)?(r=n,o=t[n],"ADD COLUMN ".concat(O(r,o))):c(n)?function(e){return'DROP COLUMN "'.concat(e,'"')}(n):"SERIAL"===t[n].datatype?[]:U(n,e[n],t[n])},U=function(e,t,n){var r,o,a=F(t,n),i=(a.added,a.removed),c=a.different,u=new Array;return c("datatype")&&u.push((r=e,o=n.datatype,'ALTER COLUMN "'.concat(r,'" TYPE ').concat(o))),i("defaultValue")?u.push(function(e){return'ALTER COLUMN "'.concat(e,'" DROP DEFAULT')}(e)):c("defaultValue")&&u.push(function(e,t){return'ALTER COLUMN "'.concat(e,'" SET DEFAULT ').concat(g(t))}(e,n.defaultValue)),(u=[].concat(s()(u),[q(e,t.constraints,n.constraints)])).filter((function(e){return e.length})).join(", ")},q=function(e,t,n){var r,o=F(t,n),a=o.added,i=o.removed,c=o.different,u=[];return a("primaryKey")&&u.push("ADD CONSTRAINT ".concat(r=e,"_pk PRIMARY KEY(").concat(r,")")),i("primaryKey")&&u.push(function(e){return"DROP CONSTRAINT ".concat(e,"_pk")}(e)),a("notNull")&&u.push(function(e){return'ALTER COLUMN "'.concat(e,'" SET NOT NULL')}(e)),i("notNull")&&u.push(function(e){return'ALTER COLUMN "'.concat(e,'" DROP NOT NULL')}(e)),a("unique")&&u.push(function(e){return"ADD CONSTRAINT ".concat(e,"_unique UNIQUE(").concat(e,")")}(e)),i("unique")&&u.push(function(e){return"DROP CONSTRAINT ".concat(e,"_unique")}(e)),a("references")&&u.push(E(e,n.references)),i("references")&&u.push(w(e)),c("references")&&u.push("".concat(w(e),";\n ").concat(E(e,n.references))),u},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=function(n){return e[n]&&void 0===t[n]},r=function(n){return void 0===e[n]&&t[n]},o=function(n){return t[n]instanceof Date?"now()"!=e[n]:"boolean"==typeof t[n]?"true"===e[n]!=t[n]:e[n]!=t[n]};return{added:r,removed:n,different:o}},M=n(11).Client,J=null,V=function(){var e=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return J=new M(t),e.next=3,J.connect();case 3:return e.next=5,b();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var B,H,K={opening:"'",closing:"'",endsTerm:!0},Y={opening:'"',closing:'"',endsTerm:!1},G={opening:"(",closing:")",endsTerm:!0},W={opening:"{",closing:"}",endsTerm:!1},Q=[K,Y,{opening:"`",closing:"`",endsTerm:!1},G,W,{opening:"{",closing:"}",endsTerm:!1}].reduce((function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,l()({},t.opening,t))}),{}),X=["GROUP","HAVING","ORDER","OFFSET","FETCH"],Z=Symbol(),$=Symbol(),ee=function(e){return/\s/.test(e)},te=function(e){B||(B=Object(a.index)(a.metadata,(function(e,t){return t.className}),(function(e,t){return t.Class}))),H||(H=Object(a.map)(Object(a.group)(Object(a.filter)(a.metadata,(function(e,t){return null!=t.type})),"className"),(function(e,t){return Object(a.index)(t,"key")})));for(var t,n="",r="",o=[],i=function(e){var t;return e==(null===(t=o[0])||void 0===t?void 0:t.closing)},c=function(e){return!!o.find((function(t){return t.closing===e.closing}))},u=null,s=function(e){return u=e},f=null,l=function(e){return f=e},p={},h=function(e,t){return p[t]=e},v=[],y=function(e,t){return v.push({Class:e,event:t})},m=function(e){return n+=e},b=function(e){if(null!==u&&X.includes(r)&&(m(" GROUP BY ".concat(u," ")),u=null),r)if("GROUP"===r&&(u=null),function(e){return e.toUpperCase()===e||["as"].includes(e)}(r))m(r);else if(e!==K&&(r=r.replace(/[A-Z]/g,(function(e){return"_".concat(e.toLowerCase())}))),m(r),f){var t,n,o=r.replace(/"/g,"");if(o.includes(".")){var i=o.split("."),c=d()(i,2);t=c[0],n=c[1]}else t=f,n=o;p[t]&&(t=p[t]);var s=Object(a.toClassName)(t),l=B[s];l||console.log("WARNING:",s),y(l,"*.changed.".concat(Object(a.toCamelCase)(n)))}null!==u&&!0===e&&(m(" GROUP BY ".concat(u," ")),u=null),r=""},O=null,g=0;g<e.length;g++){var j=void 0,E=e[g];!i(t=E)&&Q[t]&&(j=Q[E],o.unshift(j)),i(E)&&(j=o.shift()),!c(W)||O?c(W)?O.parse(E):c(W)||!O?j&&j.endsTerm?(b(j),m(E)):ee(E)?(b(),m(E)):r+=E:(m(O.close()),O=null):O=ne({insideOf:c,autoGroup:s,registerEventListener:y,definePrimaryRelation:l,defineRelationAlias:h})}return b(!0),{query:n,events:v}},ne=function(e){var t=e.insideOf,n=e.autoGroup,r=e.registerEventListener,o=e.definePrimaryRelation,a=e.defineRelationAlias,i={},c=i,u="",s=Symbol(),f=null,l=function(){u.length&&(c[u]=c[u]||!0)};return{parse:function(e){if(!t(G)||f)if(t(G))f.parse(e);else{if(!t(G)&&f){var n=f.close();return c[u]={},Object.defineProperty(c[u],$,{enumerable:!1,value:n}),void(f=null)}if(!ee(e))return"{"==e?(c[u]=c[u]||{},c[u][s]=c,c=c[u],void(u="")):"}"==e?(l(),c=c[s],void(u="")):","==e?(l(),void(u="")):void(u+=e)}else f=re({insideOf:t})},close:function(){l();var e=Object.keys(i),t=d()(e,1)[0];if(c!==i)throw SyntaxError("Unexpected End of Input for Query");if(e.length>1)throw Error("Cannot select ".concat(e.join(", ")," simultaneously"));return o(t),n("".concat(t,".id")),oe(i,r,a)}}},re=function(e){var t=e.insideOf,n={},r="",o="",a="key",i=function(){n[r]=o,r="",o=""};return{parse:function(e){if(!ee(e)||t(K)||t(Y))if(":"!==e){if(","===e)return i(),void(a="key");"key"===a&&(r+=e),"value"===a&&(o+=e)}else a="value"},close:function(){return i(),n}}};function oe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null},n=arguments.length>2?arguments[2]:void 0,r=Object.keys(e),o=d()(r,1),i=o[0],c=Object(a.toClassName)(i),u=e[i],s="";n||(s=" GROUP BY ".concat(i,".id"));var f=ae(c,u,{registerEventListener:t,defineRelationAlias:n}),l=ie(c,u,{registerEventListener:t}),p=B[c];return t(p,"deleted.*"),t(p,"created.*"),"".concat(f," FROM ").concat(i," ").concat(l).concat(s)}function ae(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.label,o=void 0!==r&&r,i=n.alias,c=void 0!==i&&i,u=n.nested,s=void 0!==u&&u,f=n.registerEventListener,l=void 0===f?function(){return null}:f,p=n.defineRelationAlias,d=void 0===p?function(){return null}:p,h=[],v=H[e],y=c||Object(a.toTableName)(e);return h.push(o?"'id', \"".concat(y,'".id'):'"'.concat(y,'".id'),o?"'__class__', '".concat(e,"'"):"'".concat(e,"' as __class__")),Object(a.each)(t,(function(n,r){if(!v[n])throw Error("Cannot query for undefined property ".concat(e,"#").concat(n));var i=v[n].type,u=r[$],f="boolean"==typeof r||0===Object.keys(r).length;switch(i){case"persisted":if(!f)throw Error("Cannot select subfields of property ".concat(e,"#").concat(n));if(u)throw Error("Cannot provide directives for persisted property ".concat(e,"#").concat(n));h.push(o?"'".concat(Object(a.toUnderscored)(n),"', \"").concat(y,'".').concat(Object(a.toUnderscored)(n)):'"'.concat(y,'".').concat(Object(a.toUnderscored)(n)));break;case"relationship":if(f)throw Error("Must select subfields for relation ".concat(e,"#").concat(n));var p,m=v[n],b=m.options,O=m.joinType,g=Object(a.toClassName)(b.a||b.an||b.of||n);switch(d(g,n),O){case"belongsTo":case"hasOne":p="(array_agg(json_build_object(".concat(ae(g,r,{label:!0,alias:Object(a.toUnderscored)(n),nested:!0,registerEventListener:l,defineRelationAlias:d}),")))[1]");break;case"hasMany":var j="";if(u&&u.orderBy){var E=u.orderBy,w=u.orderDirection,A=B[g];l(A,"*.changed.".concat(E)),j="ORDER BY ".concat(E," ").concat(w||"ASC")}p="array_agg(json_build_object(".concat(ae(g,r,{label:!0,alias:Object(a.toUnderscored)(n),nested:!0,registerEventListener:l,defineRelationAlias:d}),")").concat(j,")")}s?(Object.defineProperty(t,Z,{enumerable:!1,value:!0}),h.push(o?"'".concat(Object(a.toUnderscored)(n),"', \"").concat(y,'".').concat(Object(a.toUnderscored)(n)):Object(a.toUnderscored)(n))):h.push(o?"'".concat(Object(a.toUnderscored)(n),"', ").concat(p):"".concat(p," as ").concat(Object(a.toUnderscored)(n)));break;case"virtual":if(!f)throw Error("Cannot select subfields of property ".concat(e,"#").concat(n));var P=v[n],k=P.definition,_=P.defaultValue,x={};k(ce(e,x,{nested:s,alias:c}),u||{});var N=Object(a.find)(x,(function(t){var n;return"relationship"===(null===(n=H[e][t])||void 0===n?void 0:n.type)}));if(s&&N)Object.defineProperty(t,Z,{enumerable:!1,value:!0}),h.push(o?"'".concat(Object(a.toUnderscored)(n),"', \"").concat(y,'".').concat(Object(a.toUnderscored)(n)):Object(a.toUnderscored)(n));else{var T=k(ce(e,t,{nested:s,alias:c},l),u||{});void 0!==_&&(T="COALESCE(".concat(T,", ").concat(ue(_),")")),h.push(o?"'".concat(Object(a.toUnderscored)(n),"', ").concat(T):"".concat(T," as ").concat(Object(a.toUnderscored)(n)))}}})),h.join(", ")}function ie(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=(n.label,n.alias),o=void 0!==r&&r,i=(n.nested,n.registerEventListener),c=void 0===i?function(){return null}:i,u=[],s=function(e){u.includes(e)||u.push(e)};return Object(a.each)(t,(function(t,n){var r,i=Object(a.toUnderscored)(t),u=H[e],f=u[t],p=f.type,h=f.options,v=e,y=o;if("relationship"===p){if("boolean"==typeof n)throw Error("Must select subfields for relation ".concat(e,"#").concat(t));if(h.through){var m={};for(h.through(ce(e,m));;){var b=Object.keys(m);if(se(m[t=d()(b,1)[0]]))break;var O=u[t],g=O.options;O.joinType;s(ie(v,l()({},t,{}),{registerEventListener:c})),m=m[t],v=Object(a.toClassName)(g.a||g.an||g.of||t),u=H[v],y=t}}var j=u[t];h=j.options,r=j.joinType;var E=y||Object(a.toTableName)(v),w=Object(a.toClassName)(h.a||h.an||h.of||t),A=h.as||v,P=B[v],k=B[w];switch(c(k,"created.*"),c(k,"deleted.*"),r){case"belongsTo":c(P,"*.changed.".concat(Object(a.toCamelCase)(Object(a.toForeignKeyName)(t)))),s(n[Z]?"LEFT JOIN (\n                                        SELECT ".concat(oe(l()({},Object(a.toTableName)(w),n)),"\n                                    ) as ").concat(i," ON ").concat(E,".").concat(Object(a.toForeignKeyName)(t)," = ").concat(i,".id"):"LEFT JOIN ".concat(Object(a.toTableName)(w)," as ").concat(i," ON ").concat(E,".").concat(Object(a.toForeignKeyName)(t)," = ").concat(i,".id"));break;case"hasOne":case"hasMany":c(k,"*.changed.".concat(Object(a.toCamelCase)(Object(a.toForeignKeyName)(A)))),n[Object(a.toForeignKeyName)(A)]=!0,s(n[Z]?"LEFT JOIN (\n                                    SELECT ".concat(oe(l()({},Object(a.toTableName)(w),n)),"\n                                ) as ").concat(i," ON ").concat(i,".").concat(Object(a.toForeignKeyName)(A)," = ").concat(E,".id"):"LEFT JOIN ".concat(Object(a.toTableName)(w)," as ").concat(i," ON ").concat(i,".").concat(Object(a.toForeignKeyName)(A)," = ").concat(E,".id"))}}})),u.join(" ")}function ce(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.nested,o=n.alias,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return null},c=o||Object(a.toTableName)(e),u={toString:function(){return c}},s=H[e],f=B[e];return Object(a.each)(s,(function(e,n){Object.defineProperty(u,e,{get:function(){switch(s[e].type){case"persisted":return i(f,"*.changed.".concat(e)),t[e]=t[e]||!0,'"'.concat(c,'".').concat(Object(a.toUnderscored)(e));case"relationship":var n=s[e].options,o=Object(a.toClassName)(n.a||n.an||n.of||e);return t[e]=t[e]||{},ce(o,t[e],{nested:!0,alias:Object(a.toUnderscored)(e)},i);case"virtual":var l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=s[e],o=n.definition,i=n.defaultValue;return r?(o(u,t),'"'.concat(c,'".').concat(Object(a.toUnderscored)(e))):void 0!==i?"COALESCE(".concat(o(u,t),", ").concat(i,")"):o(u,t)};return l.toString=l,l}}})})),u}var ue=function(e){if(null===e)return"NULL";if("number"==typeof e||"boolean"==typeof e)return e;if("string"==typeof e)return"'".concat(e,"'");if("object"==v()(e)&&e.__proto__==Object.prototype)return"'".concat(JSON.stringify(e),"'::json");if(e instanceof Date)return"NOW()";throw Error("Variable type cannot be coalesced for sql query: ".concat(e))};function se(e){return 0===Object.keys(e).length}var fe,le=o.a.mark(Ae),pe=function(e){return{isLiteral:!0,value:e}},de=function(e){return e&&e.isLiteral},he=function(e,t){return"function"==typeof e.value?e.value(t):e.value},ve=function(e){return{join:function(t){return pe(Object.keys(e).map(a.toUnderscored).join(t))}}},ye=function(e){return{join:function(t){return pe((function(n){return Object.values(e).map(n).join(t)}))}}},me=function(e){return function(t,n){return pe((function(r){var o;return Object(a.each)(t,(function(t,i){return o=void 0===o?n(Object(a.toUnderscored)(t),{toString:function(){return r(i)}},{rawValue:i,escape:r}):"".concat(o).concat(e).concat(n(Object(a.toUnderscored)(t),{toString:function(){return r(i)}},{rawValue:i,escape:r}))})),o}))}},be=me(", "),Oe=me(" AND "),ge=me(" OR "),je={disableLogging:!1},Ee=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Array.isArray(t[0]))return we.apply(void 0,[je].concat(t));var r=t[0];return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return we.apply(void 0,[r].concat(t))}},we=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];var i=[],c=function(e){return i.push(e),"$".concat(i.length)},u=t.reduce((function(e,t,n){return 0===n?"".concat(t):de(r[n-1])?"".concat(e).concat(he(r[n-1],c)).concat(t):"".concat(e).concat(c(r[n-1])).concat(t)}),""),s=te(u),f=s.query,l=s.events;return new a.Pipe(Ae,e,f,i,l)};function Ae(e,t,n,r,i){var c,u,s,f,l,p,d,h,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.disableLogging||console.log(n,r,i.map((function(e){var t=e.Class,n=e.event;return"".concat(t.name,".").concat(n)}))),c=!0,u=!1,s=void 0,e.prev=4,f=i[Symbol.iterator]();case 6:if(c=(l=f.next()).done){e.next=13;break}return p=l.value,d=p.Class,h=p.event,e.next=10,d.nowAndOn(h);case 10:c=!0,e.next=6;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(4),u=!0,s=e.t0;case 19:e.prev=19,e.prev=20,c||null==f.return||f.return();case 22:if(e.prev=22,!u){e.next=25;break}throw s;case 25:return e.finish(22);case 26:return e.finish(19);case 27:return e.next=29,J.query(n,r);case 29:return v=e.sent,fe||(fe=Object(a.index)(a.metadata,(function(e,t){return t.className}),(function(e,t){return t.Class}))),e.abrupt("return",Object(a.deepMap)(v.rows,(function(e){if(e&&e.__class__){if(null===e.id)return null;var t=fe[e.__class__],n=new t;return new t(Object(a.index)(e,(function(e){return Object(a.toCamelCase)(e)}),(function(e,t){var r=Object(a.getMetadata)(n,e).sqlDecode;return r?r(t):t})))}return Array.isArray(e)?e.filter((function(e){return null!==e&&null!==e.id})):e})));case 32:case"end":return e.stop()}}),le,null,[[4,15,19,27],[20,,22,26]])}var Pe=n(6),ke=n.n(Pe),_e=n(8),xe=n.n(_e),Ne=n(10),Te=n.n(Ne),Se=n(9),Ce=n.n(Se);n(12);function De(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?De(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Re=vt((function(e){return{datatype:"varchar",constraints:e.decoratorArgs[1]||{}}})),Ie=vt((function(e){return{datatype:"text",constraints:e.decoratorArgs[1]||{}}})),Ue=vt((function(e){return{datatype:"numeric",constraints:e.decoratorArgs[1]||{}}})),qe=vt((function(e){return{datatype:"float8",constraints:e.decoratorArgs[1]||{}}})),Fe=vt((function(e){return{datatype:"int4",constraints:e.decoratorArgs[1]||{}}})),Me=vt((function(e){return{datatype:"bool",constraints:e.decoratorArgs[1]||{}}})),Je=vt((function(e){return{datatype:"timestamp",constraints:e.decoratorArgs[1]||{}}})),Ve=vt((function(e){return{datatype:"timestamptz",constraints:e.decoratorArgs[1]||{}}})),ze=vt((function(e){return{datatype:"date",constraints:e.decoratorArgs[1]||{}}})),Be=vt((function(e){return{datatype:"time",constraints:e.decoratorArgs[1]||{}}})),He=vt((function(e){return{datatype:"point",constraints:e.decoratorArgs[1]||{}}})),Ke=vt((function(e){return{datatype:"line",constraints:e.decoratorArgs[1]||{}}})),Ye=vt((function(e){return{datatype:"lseg",constraints:e.decoratorArgs[1]||{}}})),Ge=vt((function(e){return{datatype:"path",constraints:e.decoratorArgs[1]||{}}})),We=vt((function(e){return{datatype:"polygon",constraints:e.decoratorArgs[1]||{}}})),Qe=vt((function(e){return{datatype:"circle",constraints:e.decoratorArgs[1]||{}}})),Xe=vt((function(e){return{datatype:"json",constraints:e.decoratorArgs[1]||{},sqlEncode:function(e){return JSON.stringify(e)},sqlDecode:function(e){try{return JSON.parse(e)}catch(t){return e}}}})),Ze=vt((function(e){return{datatype:"json",constraints:e.decoratorArgs[1]||{},sqlEncode:function(e){return JSON.stringify(e)},sqlDecode:function(e){try{return JSON.parse(e)}catch(t){return e}}}})),$e=vt((function(e){return{datatype:"SERIAL",constraints:e.decoratorArgs[0]||{}}})),et=$e({primaryKey:!0}),tt=yt((function(e){var t=d()(e.decoratorArgs,1)[0],n=e.target,r=e.key,o=e.fieldValue;return e.isMethod||Object.defineProperty(n,r,mt(r)),{isShared:!0,type:"virtual",definition:t,defaultValue:o}})),nt=vt((function(e){var t=d()(e.decoratorArgs,1)[0],n=void 0===t?{}:t,r=e.target,o=e.key,a=e.fieldValue;return Object.defineProperty(r,o,mt(o)),{isShared:!0,type:"relationship",joinType:"hasMany",options:n,defaultValue:a}})),rt=vt((function(e){var t=d()(e.decoratorArgs,1)[0],n=void 0===t?{}:t,r=e.target,o=e.key,a=e.fieldValue;return Object.defineProperty(r,o,mt(o)),{isShared:!0,type:"relationship",joinType:"hasOne",options:n,defaultValue:a}})),ot=vt((function(e){var t=d()(e.decoratorArgs,1)[0],n=void 0===t?{}:t,r=e.target,o=e.key,i=e.fieldValue,c=Object(a.toCamelCase)(Object(a.toForeignKeyName)(o));return Object(a.saveMetadata)(r,c,{type:"persisted",datatype:"int4",isShared:!0}),Object.defineProperty(r,o,mt(o)),Object.defineProperty(r,c,mt(c)),{isShared:!0,type:"relationship",joinType:"belongsTo",options:n,defaultValue:i}})),at=yt((function(e){e.decoratorArgs,e.fieldValue;return{readAccessTest:function(){return!1}}})),it=yt((function(e){e.decoratorArgs,e.fieldValue;return{writeAccessTest:function(){return!1}}})),ct=yt((function(e){var t=e.decoratorArgs;e.fieldValue;return{readAccessTest:t[0]}})),ut=yt((function(e){var t=e.decoratorArgs;e.fieldValue;return{writeAccessTest:t[0]}})),st=yt((function(e){e.decoratorArgs,e.fieldValue;return{isShared:!0}})),ft=yt((function(e){e.decoratorArgs,e.fieldValue;return{usesSession:!0}})),lt=yt((function(e){var t=e.decoratorArgs,n=e.target,r=e.key;e.fieldValue;return t.forEach((function(e){return n.validation.addHandler(r,e)})),{validators:t}})),pt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){bt((function(e){var n="function"==typeof e?e:e.constructor,r="function"==typeof e?e.prototype:e;Object(a.each)(t,(function(e,t){Object(a.each)(Object.getOwnPropertyDescriptors(t),(function(e,r){if("name"!=e&&"prototype"!=e&&"length"!=e){var o=Object(a.getMetadata)(t,e);jt(o)||Object(a.saveMetadata)(n,e,o),Object.defineProperty(n,e,r)}})),Object(a.each)(Object.getOwnPropertyDescriptors(t.prototype),(function(e,n){if("constructor"!==e&&"onConstruct"!==e&&"[[validation]]"!==e){var o=Object(a.getMetadata)({__proto__:{constructor:t}},e);jt(o)||Object(a.saveMetadata)(r,e,o),Object.defineProperty(r,e,n)}})),t.prototype["[[validation]]"]&&(r["[[validation]]"]?r["[[validation]]"].handlers=Le({},r["[[validation]]"].handlers,{},t.prototype["[[validation]]"].handlers):r["[[validation]]"]=t.prototype["[[validation]]"])}))}))(e),gt((function(e){Object(a.each)(t,(function(t,n){n.prototype.onConstruct&&n.prototype.onConstruct.call(e)}))}))(e)}};function dt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return t&&o.unshift(n),e.call.apply(e,[this].concat(o))};return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Ce()(a.Pipe,[[this,n]].concat(t))}}var ht=function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"object"===v()(t)?(bt((function(e,t){Object(a.saveMetadata)(e,t,{isStream:!0,prependEmit:r,original:n})}))(t),Ot((function(e){return n=e,dt(e,r)}))(t),t):"function"==typeof t?dt(t,r):"boolean"==typeof t?function(n){return e(n,t)}:void 0};function vt(e){var t=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return delete(t=bt((function(t,r,o){Object(a.saveMetadata)(t,r,Le({isShared:!0,type:"persisted",defaultValue:o},e({decoratorArgs:n,target:t,key:r,fieldValue:o})))}))(t)).initializer,delete t.descriptor.value,delete t.descriptor.writable,Le({},t,{kind:"method",placement:"prototype",descriptor:Le({},t.descriptor,{},mt(t.key))})};return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return n[0]&&n[0].descriptor&&n[0].kind?t(n[0]):function(e){return t(e,n)}}}function yt(e){var t=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];bt((function(t,r,o,i){return Object(a.saveMetadata)(t,r,Le({},e({decoratorArgs:n,target:t,key:r,fieldValue:o,isMethod:i})))}))(t)};return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return n[0]&&n[0].descriptor&&n[0].kind?t(n[0]):function(e){return t(e,n)}}}function mt(e){return{enumerable:!0,get:new Function("\n            return this['[[attributes]]'].".concat(e,"\n        ")),set:new Function("value","\n            this['[[attributes]]'].".concat(e," = value\n            let patch = {\n                op: 'replace',\n                path: '/").concat(e,"',\n                value\n            }\n            this['[[patches]]'].push(patch)\n            this.emit('Δ.change', [ patch ])\n        "))}}function bt(e){return function(t){var n=t.finisher,r=t.initializer;return t.finisher=function(o){var a,i,c;switch("function"==typeof n&&n(o),t.placement){case"class":e(o);break;case"static":c="field"===t.kind&&"function"==typeof r?r():null===(a=t.descriptor)||void 0===a?void 0:a.value,e(o,t.key,c);break;default:c="field"===t.kind&&"function"==typeof r?r():null===(i=t.descriptor)||void 0===i?void 0:i.value,e(o.prototype,t.key,c,"method"===t.kind)}},t}}function Ot(e){return function(t){var n;switch(t.kind){case"field":n="function"==typeof t.initializer?t.initializer:function(){return null},t.initializer=function(){return function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];e((function(){return n.apply(void 0,r)}))}};break;case"method":n=t.descriptor.value,t.descriptor.value=e(n)}return t}}function gt(e){return function(t){var n=Symbol();t.extras=[{kind:"field",placement:"own",key:n,descriptor:{},initializer:function(){delete this[n],e(this)}}]}}var jt=function(e){return 0===Object.keys(e).length};function Et(){var e=ke()(["\n            DELETE FROM "," WHERE true\n        "]);return Et=function(){return e},e}function wt(){var e=ke()(["\n            SELECT {\n                "," {\n                    ","\n                }\n            }\n            WHERE ","\n            ORDER BY ",".id ASC\n        "]);return wt=function(){return e},e}function At(){var e=ke()(["\n            SELECT {\n                "," {\n                    ","\n                }\n            }\n            WHERE ","\n            ORDER BY ",".id ASC\n        "]);return At=function(){return e},e}function Pt(){var e=ke()(["\n            SELECT {\n                "," {\n                    ","\n                }\n            }\n            ORDER BY ",".id ASC\n        "]);return Pt=function(){return e},e}function kt(){var e=ke()(["\n            DELETE FROM "," WHERE id = ","\n        "]);return kt=function(){return e},e}function _t(){var e=ke()(["\n            INSERT INTO "," (",") \n            VALUES (",")\n            RETURNING id\n        "]);return _t=function(){return e},e}function xt(){var e=ke()(["\n            UPDATE "," \n            SET ","\n            WHERE id = ","\n        "]);return xt=function(){return e},e}function Nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nt(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function St(){var e=ke()(["\n            SELECT {\n                "," {\n                    ","\n                }\n            }\n            WHERE ",".id = ","\n        "]);return St=function(){return e},e}function Ct(e){var t,n=Ut(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var r={kind:"field"===e.kind?"field":"method",key:n,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(r.decorators=e.decorators),"field"===e.kind&&(r.initializer=e.value),r}function Dt(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function Lt(e){return e.decorators&&e.decorators.length}function Rt(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function It(e,t){var n=e[t];if(void 0!==n&&"function"!=typeof n)throw new TypeError("Expected '"+t+"' to be a function");return n}function Ut(e){var t=function(e,t){if("object"!==v()(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==v()(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===v()(t)?t:String(t)}var qt=function(e,t,n,r){var o=function(){(function(){return e});var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){["method","field"].forEach((function(n){t.forEach((function(t){t.kind===n&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var n=e.prototype;["method","field"].forEach((function(r){t.forEach((function(t){var o=t.placement;if(t.kind===r&&("static"===o||"prototype"===o)){var a="static"===o?e:n;this.defineClassElement(a,t)}}),this)}),this)},defineClassElement:function(e,t){var n=t.descriptor;if("field"===t.kind){var r=t.initializer;n={enumerable:n.enumerable,writable:n.writable,configurable:n.configurable,value:void 0===r?void 0:r.call(e)}}Object.defineProperty(e,t.key,n)},decorateClass:function(e,t){var n=[],r=[],o={static:[],prototype:[],own:[]};if(e.forEach((function(e){this.addElementPlacement(e,o)}),this),e.forEach((function(e){if(!Lt(e))return n.push(e);var t=this.decorateElement(e,o);n.push(t.element),n.push.apply(n,t.extras),r.push.apply(r,t.finishers)}),this),!t)return{elements:n,finishers:r};var a=this.decorateConstructor(n,t);return r.push.apply(r,a.finishers),a.finishers=r,a},addElementPlacement:function(e,t,n){var r=t[e.placement];if(!n&&-1!==r.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");r.push(e.key)},decorateElement:function(e,t){for(var n=[],r=[],o=e.decorators,a=o.length-1;a>=0;a--){var i=t[e.placement];i.splice(i.indexOf(e.key),1);var c=this.fromElementDescriptor(e),u=this.toElementFinisherExtras((0,o[a])(c)||c);e=u.element,this.addElementPlacement(e,t),u.finisher&&r.push(u.finisher);var s=u.extras;if(s){for(var f=0;f<s.length;f++)this.addElementPlacement(s[f],t);n.push.apply(n,s)}}return{element:e,finishers:r,extras:n}},decorateConstructor:function(e,t){for(var n=[],r=t.length-1;r>=0;r--){var o=this.fromClassDescriptor(e),a=this.toClassDescriptor((0,t[r])(o)||o);if(void 0!==a.finisher&&n.push(a.finisher),void 0!==a.elements){e=a.elements;for(var i=0;i<e.length-1;i++)for(var c=i+1;c<e.length;c++)if(e[i].key===e[c].key&&e[i].placement===e[c].placement)throw new TypeError("Duplicated element ("+e[i].key+")")}}return{elements:e,finishers:n}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){if(void 0!==e)return Te()(e).map((function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var n=Ut(e.key),r=String(e.placement);if("static"!==r&&"prototype"!==r&&"own"!==r)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+r+'"');var o=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var a={kind:t,key:n,placement:r,descriptor:Object.assign({},o)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(o,"get","The property descriptor of a field descriptor"),this.disallowProperty(o,"set","The property descriptor of a field descriptor"),this.disallowProperty(o,"value","The property descriptor of a field descriptor"),a.initializer=e.initializer),a},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:It(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:e.map(this.fromElementDescriptor,this)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var n=It(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:n}},runClassFinishers:function(e,t){for(var n=0;n<t.length;n++){var r=(0,t[n])(e);if(void 0!==r){if("function"!=typeof r)throw new TypeError("Finishers must return a constructor.");e=r}}return e},disallowProperty:function(e,t,n){if(void 0!==e[t])throw new TypeError(n+" can't have a ."+t+" property.")}};return e}();if(r)for(var a=0;a<r.length;a++)o=r[a](o);var i=t((function(e){o.initializeInstanceElements(e,c.elements)}),n),c=o.decorateClass(function(e){for(var t=[],n=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var o,a=e[r];if("method"===a.kind&&(o=t.find(n)))if(Rt(a.descriptor)||Rt(o.descriptor)){if(Lt(a)||Lt(o))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");o.descriptor=a.descriptor}else{if(Lt(a)){if(Lt(o))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");o.decorators=a.decorators}Dt(a,o)}else t.push(a)}return t}(i.d.map(Ct)),e);return o.initializeClassElements(i.F,c.elements),o.runClassFinishers(i.F,c.finishers)}(null,(function(e){var t,n,r,i,u;return{F:function t(){xe()(this,t),e(this)},d:[{kind:"field",decorators:[et],key:"id",value:void 0},{kind:"method",key:"onConstruct",value:function(){var e=this;this.on&&this.on("Δ.sync",(function(t){return e.commit(t)}))}},{kind:"method",decorators:[ht],static:!0,key:"read",value:o.a.mark((function e(t){var n,r,a,i,c,u=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==(n=u.length>1&&void 0!==u[1]?u[1]:null)&&(n=this.defaultSelectedColumns),r=this.relation,e.next=5,Ee(St(),r,pe(n),r,t);case 5:return a=e.sent,i=d()(a,1),c=i[0],e.abrupt("return",c||null);case 9:case"end":return e.stop()}}),e,this)}))},{kind:"method",static:!0,key:"create",value:(u=c()(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new this(t),e.next=3,n.persist();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{kind:"method",decorators:[st],key:"update",value:function(e){Object.assign(this,e)}},{kind:"method",key:"commit",value:(i=c()(o.a.mark((function e(t){var n,r,i,c,u=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.id){e.next=2;break}return e.abrupt("return",!1);case 2:if(n=this.constructor.relation,0!==t.patches.length){e.next=5;break}return e.abrupt("return",null);case 5:return r=t.patches.reduce((function(e,t){var n=t.path.slice(1).split("/")[0];return Tt({},e,l()({},n,u[n]))}),{}),i=this.constructor.fieldsFrom(r),e.next=9,Ee(xt(),n,be(i,(function(e,t){return"".concat(e," = ").concat(t)})),this.id);case 9:return c=e.sent,Object(a.each)(i,(function(e){return u.constructor.emit("".concat(u.id,".changed.").concat(e))})),t.hasBeenCommitted(),e.abrupt("return",c);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{kind:"method",key:"persist",value:(r=c()(o.a.mark((function e(){var t,n,r,a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.constructor.relation,n=this.constructor.fieldsFrom(this),e.next=4,Ee(_t(),t,ve(n).join(", "),ye(n).join(", "));case 4:return r=e.sent,a=d()(r,1),i=a[0].id,this["[[attributes]]"].id=this["[[base]]"].id=i,this.constructor.emit("created.".concat(i)),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{kind:"method",key:"delete",value:(n=c()(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.constructor.relation,e.next=3,Ee(kt(),t,this.id);case 3:return n=e.sent,this.constructor.emit("deleted.".concat(this.id)),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{kind:"method",decorators:[ht],static:!0,key:"list",value:o.a.mark((function e(){var t,n,r=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==(t=r.length>0&&void 0!==r[0]?r[0]:null)&&(t=this.defaultSelectedColumns),n=this.relation,e.abrupt("return",Ee(Pt(),n,pe(t),n));case 4:case"end":return e.stop()}}),e,this)}))},{kind:"method",decorators:[ht],static:!0,key:"where",value:o.a.mark((function e(t){var n,r,a=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:null,r=this.relation,null==n&&(n=this.defaultSelectedColumns),e.abrupt("return",Ee(At(),r,pe(n),Oe(t,(function(e,t,n){var o=n.rawValue,a=n.escape;return Ft(null===o,(function(){return'"'.concat(r.value,'".').concat(e," IS NULL")}),Mt(Array.isArray(o),(function(){return'"'.concat(r.value,'".').concat(e," IN (").concat(o.map(a).join(", "),")")})),Jt((function(){return'"'.concat(r.value,'".').concat(e," = ").concat(t)})))})),r));case 4:case"end":return e.stop()}}),e,this)}))},{kind:"method",decorators:[ht],static:!0,key:"search",value:o.a.mark((function e(t){var n,r,a=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:null,r=this.relation,null==n&&(n=this.defaultSelectedColumns),e.abrupt("return",Ee(wt(),r,pe(n),ge(t,(function(e,t){return'"'.concat(r.value,'".').concat(e," LIKE ").concat(t)})),r));case 4:case"end":return e.stop()}}),e,this)}))},{kind:"method",static:!0,key:"truncate",value:(t=c()(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.relation,e.abrupt("return",Ee(Et(),t));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{kind:"get",static:!0,key:"defaultSelectedColumns",value:function(){return Object.keys(this.persistedFields).join(",\n")}},{kind:"get",static:!0,key:"relation",value:function(){return pe(Object(a.toTableName)(this.name))}},{kind:"get",static:!0,key:"persistedFields",value:function(){var e=this;return Object(a.index)(Object(a.filter)(a.metadata,(function(t,n){return n.className===e.name&&"persisted"===n.type})),"key")}},{kind:"method",static:!0,key:"fieldsFrom",value:function(e){var t=new this,n=this.persistedFields,r={};return Object(a.each)(n,(function(n){if(void 0!==e[n]){var o=Object(a.getMetadata)(t,n).sqlEncode;r[n]=o?o(e[n]):e[n]}})),r}}]}})),Ft=function(e,t){if(e)return t();for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];var a=r.find((function(e){return 1==e.predicate}));return a?a.result():null},Mt=function(e,t){return{predicate:e,result:t}},Jt=function(e){return{predicate:!0,result:e}}}]);