module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=19)}([function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,t){e.exports=require("@babel/runtime/helpers/toArray")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("child_process")},function(e,t){e.exports=require("ncp")},function(e,t){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var o=e[r];"."===o?e.splice(r,1):".."===o?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var e="",t=!1,o=arguments.length-1;o>=-1&&!t;o--){var a=o>=0?arguments[o]:process.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(e=a+"/"+e,t="/"===a.charAt(0))}return(t?"/":"")+(e=n(r(e.split("/"),(function(e){return!!e})),!t).join("/"))||"."},t.normalize=function(e){var a=t.isAbsolute(e),c="/"===o(e,-1);return(e=n(r(e.split("/"),(function(e){return!!e})),!a).join("/"))||a||(e="."),e&&c&&(e+="/"),(a?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,n){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var o=r(e.split("/")),a=r(n.split("/")),c=Math.min(o.length,a.length),s=c,i=0;i<c;i++)if(o[i]!==a[i]){s=i;break}var u=[];for(i=s;i<o.length;i++)u.push("..");return(u=u.concat(a.slice(s))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,o=!0,a=e.length-1;a>=1;--a)if(47===(t=e.charCodeAt(a))){if(!o){r=a;break}}else o=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},t.basename=function(e,t){var n=function(e){"string"!=typeof e&&(e+="");var t,n=0,r=-1,o=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!o){n=t+1;break}}else-1===r&&(o=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,n=0,r=-1,o=!0,a=0,c=e.length-1;c>=0;--c){var s=e.charCodeAt(c);if(47!==s)-1===r&&(o=!1,r=c+1),46===s?-1===t?t=c:1!==a&&(a=1):-1!==t&&(a=-1);else if(!o){n=c+1;break}}return-1===t||-1===r||0===a||1===a&&t===r-1&&t===n+1?"":e.slice(t,r)};var o="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}},function(e,t){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,t){e.exports=require("cli-progress")},function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=11},function(e,t){e.exports=require("node-fetch")},function(e,t){e.exports=require("opn")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("@octokit/rest")},function(e,t){e.exports=require("nodegit")},function(e,t){e.exports=require("commander")},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(1),c=n.n(a),s=n(4).promises,i=n(5).promisify(n(6).exec),u=n(7).ncp,p=n(8),l=n(10),f=new l.Bar({},l.Presets.shades_classic);function m(){return(m=c()(o.a.mark((function e(t){var r,a,l,m;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Starting..."),f.start(100,25),e.next=4,i('npx expo init "'.concat(t,'" --template bare-minimum'));case 4:return f.update(50),e.next=7,i('cd "'.concat(t,'" && npm install nodemon webpack webpack-cli concurrently babel-loader babel-plugin-named-asset-import @expo/webpack-config --save-dev && npm install socket.io express formidable https://github.com/Joshua-Miles/triframe.git'));case 7:return r=p.join(process.cwd(),t,"package.json"),(a=n(11)(r)).scripts={"dev-api":'concurrently "npx webpack --watch --config api.config.js"  "nodemon ./dist/index.js --watch ./dist/index.js"',"dev-app":"expo start --web","dev-android":"react-native run-android","dev-ios":"react-native run-ios"},e.next=12,s.writeFile(r,JSON.stringify(a,null,2));case 12:return l=p.join(process.cwd(),t,".gitignore"),e.next=15,s.readFile(l);case 15:return m=e.sent,e.next=18,s.writeFile(l,"".concat(m,"\ndist\n.sessions\n.uploads"));case 18:return f.update(75),e.next=21,Promise.all(["api.config.js","dist","tsconfig.json","App.js","Api.js","views","models","webpack.config.js"].map(function(){var e=c()(o.a.mark((function e(n){var r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.join(__dirname,"__assets__",n),a=p.join(process.cwd(),t,n),e.next=4,new Promise((function(e){return u(r,a,e)}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 21:f.update(100),f.stop(),console.log("Install Completed");case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var d=n(2),g=n.n(d),h=n(3),v=n.n(h),b=n(4).promises,x=["and","or","nor","a","an","the","so","but","to","of","at","by","from","into","on","onto","off","out","in","over","with","for"],y=function(e){return e=(e=e.toLowerCase()).charAt(0).toUpperCase()+e.substr(1)},w=function(e){for(var t=(e=(e=e.replace(/_+/g," "))[0]+e.slice(1).replace(/[A-Z]/g,(function(e){return" ".concat(e)}))).split(/\s+/g),n=0,r=t.length;n<r;++n){for(var o=t[n].split("-"),a=0,c=o.length;a<c;++a){var s=o[a].toLowerCase();x.indexOf(s)<0&&(o[a]=y(s))}t[n]=o.join("-")}return e=(e=t.join(" ")).charAt(0).toUpperCase()+e.substr(1)},k=n(9),j=n.n(k);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){j()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A,O,C=n(4),S=C.promises,D=n(5).promisify(n(6).exec),P=n(7).ncp,_=n(8),I=n(12),N=n(13),M=n(14),R=n(15),B=n(16).Octokit,z=n(17),F=z.Repository,L=(z.Reference,z.Signature,z.Remote,z.Cred,"us-central1"),q=function(){var e=c()(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe();case 2:return O=e.sent,e.next=5,$(t);case 5:if(!e.sent){e.next=8;break}throw Error('Duplicate Deployment name "'.concat(t,'", please pick a different name'));case 8:return A=new B({auth:"65dd359783bf161f13d1ec31c515b0e92e9369cc"}),e.next=11,Y();case 11:return n=e.sent,e.next=14,W();case 14:return e.next=16,n.checkoutBranch("production");case 16:return e.next=18,Z();case 18:return e.next=20,J(n,t);case 20:return e.next=22,X(t);case 22:return r=e.sent,a=r.data.tarball_url,e.next=26,te(a,t);case 26:return e.next=28,ee(t);case 28:return e.next=30,n.checkoutBranch("master");case 30:console.log("Deployment Complete");case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function e(t){C.existsSync(t)&&(C.readdirSync(t).forEach((function(n,r){var o=_.join(t,n);C.lstatSync(o).isDirectory()?e(o):C.unlinkSync(o)})),C.rmdirSync(t))},Q=function e(t){var n=t.method,r=t.url,a=t.body,s=t.headers,i=r.includes("?")?"&":"?";return I("".concat(r).concat(i,"access_token=").concat(O),{method:n,body:JSON.stringify(a),headers:T({},s,{"Content-Type":"application/json",Accept:"application/json"})}).then(function(){var e=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.json());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then(function(){var t=c()(o.a.mark((function t(c){var i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c.error){t.next=4;break}return t.abrupt("return",c);case 4:if(401!=c.error.code){t.next=13;break}return t.next=7,fe({token:null});case 7:return t.next=9,pe();case 9:return O=t.sent,t.abrupt("return",e({method:n,url:r,body:a,headers:s}));case 13:throw i=new Error(c.error.message),Object.assign(i,c.error),i;case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},G=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="GET";return Q({method:r,url:e,body:t,headers:n})},K=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="POST";return Q({method:r,url:e,body:t,headers:n})},H=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="PATCH";return Q({method:r,url:e,body:t,headers:n})},V=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="DELETE";return Q({method:r,url:e,body:t,headers:n})},Y=function(){var e=c()(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.open(_.resolve(__dirname,"../.git"));case 2:return t=e.sent,e.next=5,t.getStatus();case 5:if(n=e.sent,0===n.length){e.next=9;break}throw Error("You have uncommitted changes. Please commit or revert, then try again.");case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=c()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Building Frontend"),e.next=3,D("expo build:web");case 3:return console.log("Building Backend"),e.next=6,D("npx webpack --config api.config.js");case 6:return e.next=8,P("./web-build","./dist/public");case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Z=function(){var e=c()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P("./dist/public","./public");case 2:return e.next=4,P("./dist/index.js","./index.js");case 4:return e.next=6,ue(3e3);case 6:return e.next=8,U("./web-build");case 8:return e.next=10,U("./dist");case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=c()(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D("git add ./public");case 2:return e.next=4,D("git add ./index.js");case 4:return e.next=6,D('git commit -m "Build for Deployment '.concat(n,'"'));case 6:return e.next=8,D("git push origin production");case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),X=function(){var e=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.repos.createRelease({name:t,tag_name:"deployment@".concat(t),repo:"spiral",target_commitish:"production",owner:"joshua-miles"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$=function(){var e=c()(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat("spiral","-").concat(t.replace(/\./g,"-")),e.next=3,G("https://compute.googleapis.com/compute/v1/projects/".concat("spiral-app","/global/instanceTemplates"));case 3:return n=e.sent,r=n.items,e.abrupt("return",r.find((function(e){return e.name===t})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ee=function(){var e=c()(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat("spiral","-").concat(t.replace(/\./g,"-")),e.next=3,G("https://compute.googleapis.com/compute/v1/projects/".concat("spiral-app","/zones/").concat(L,"-a/instanceGroupManagers"));case 3:if(n=e.sent,r=n.items,r.find((function(e){return"spiral"===e.name}))){e.next=13;break}return console.log("Creating New Instance Group..."),e.next=10,K("https://compute.googleapis.com/compute/v1/projects/".concat("spiral-app","/zones/").concat(L,"-a/instanceGroupManagers"),{name:"spiral",instanceTemplate:"projects/".concat("spiral-app","/global/instanceTemplates/").concat(t),baseInstanceName:"spiral",targetSize:1});case 10:a=e.sent,e.next=17;break;case 13:return console.log("Starting Rolling Update..."),e.next=16,H("https://compute.googleapis.com/compute/v1/projects/".concat("spiral-app","/zones/").concat(L,"-a/instanceGroupManagers/").concat("spiral"),{instanceTemplate:"projects/".concat("spiral-app","/global/instanceTemplates/").concat(t)});case 16:a=e.sent;case 17:return e.next=19,ie(a);case 19:console.log("Update Complete");case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=c()(o.a.mark((function e(t,n){var r,a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat("spiral","-").concat(n.replace(/\./g,"-")),e.next=3,ne();case 3:return e.next=5,re();case 5:return e.next=7,le();case 7:return r=e.sent,a=r.gcBucketName,console.log("Creating Instance Template..."),e.next=12,K("https://compute.googleapis.com/compute/v1/projects/".concat("spiral-app","/global/instanceTemplates"),{name:n,description:"",properties:{machineType:"g1-small",displayDevice:{enableDisplay:!1},metadata:{kind:"compute#metadata",items:[{key:"startup-script",value:de(t,a)}]},tags:{items:["http-server","https-server"]},disks:[{kind:"compute#attachedDisk",type:"PERSISTENT",boot:!0,mode:"READ_WRITE",autoDelete:!0,deviceName:"instance-template-5",initializeParams:{sourceImage:"projects/".concat("spiral-app","/global/images/").concat("triframe-base"),diskType:"pd-standard",diskSizeGb:"10",labels:{}}}],canIpForward:!1,networkInterfaces:[{kind:"compute#networkInterface",network:"projects/".concat("spiral-app","/global/networks/default"),accessConfigs:[{kind:"compute#accessConfig",name:"External NAT",type:"ONE_TO_ONE_NAT",networkTier:"PREMIUM"}],aliasIpRanges:[]}],labels:{},scheduling:{preemptible:!1,onHostMaintenance:"MIGRATE",automaticRestart:!0,nodeAffinities:[]},reservationAffinity:{consumeReservationType:"ANY_RESERVATION"},shieldedInstanceConfig:{enableSecureBoot:!1,enableVtpm:!0,enableIntegrityMonitoring:!0}}});case 12:return c=e.sent,e.next=15,ie(c);case 15:console.log("Created Instance Template");case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ne=function(){var e=c()(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G("https://compute.googleapis.com/compute/v1/projects/".concat("spiral-app","/global/images"));case 2:if(t=e.sent,n=t.items||[],n.find((function(e){return"triframe-base"===e.name}))){e.next=8;break}return e.next=8,ae();case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),re=function(){var e=c()(o.a.mark((function e(){var t,n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le();case 2:if(t=e.sent,void 0!==(n=t.gcBucketName)){e.next=6;break}return e.abrupt("return",oe());case 6:return e.next=8,G("https://storage.googleapis.com/storage/v1/b?project=".concat("spiral-app"));case 8:if(r=e.sent,a=r.items||[],a.find((function(e){return e.name===n}))){e.next=14;break}return e.next=14,oe();case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),oe=function(){var e=c()(o.a.mark((function e(){var t,n,r=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"".concat("spiral","-bucket"),console.log('Creating Bucket "'.concat(t,'"')),e.prev=2,e.next=5,K("https://storage.googleapis.com/storage/v1/b?project=".concat("spiral-app"),{name:t});case 5:return n=e.sent,e.next=8,fe({gcBucketName:n.name});case 8:return e.abrupt("return",n);case 11:return e.prev=11,e.t0=e.catch(2),console.log("Bucket Creation Failed..."),e.next=16,oe("".concat(t,"-").concat(ge()));case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=c()(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ce();case 2:return console.log("Creating Disk Image..."),e.next=5,K("https://compute.googleapis.com/compute/v1/projects/".concat("spiral-app","/global/images"),{kind:"compute#image",name:"triframe-base",sourceDisk:"projects/".concat("spiral-app","/zones/").concat(L,"-a/disks/").concat("triframe-base"),storageLocations:["us"]});case 5:return t=e.sent,e.next=8,ie(t);case 8:return console.log("Created Disk Image"),e.next=11,se();case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ce=function(){var e=c()(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Creating Disk Source...."),e.next=3,K("https://compute.googleapis.com/compute/v1/projects/".concat("spiral-app","/zones/").concat(L,"-a/instances"),{kind:"compute#instance",name:"triframe-base",zone:"projects/".concat("spiral-app","/zones/").concat(L,"-a"),machineType:"projects/".concat("spiral-app","/zones/").concat(L,"-a/machineTypes/g1-small"),displayDevice:{enableDisplay:!1},metadata:{kind:"compute#metadata",items:[{key:"startup-script",value:me}]},networkInterfaces:[{kind:"compute#networkInterface",subnetwork:"projects/spiral-app/regions/us-central1/subnetworks/default",accessConfigs:[{kind:"compute#accessConfig",name:"External NAT",type:"ONE_TO_ONE_NAT",networkTier:"PREMIUM"}],aliasIpRanges:[]}],disks:[{kind:"compute#attachedDisk",type:"PERSISTENT",boot:!0,mode:"READ_WRITE",autoDelete:!0,deviceName:"triframe-base",initializeParams:{sourceImage:"projects/ubuntu-os-cloud/global/images/ubuntu-1604-xenial-v20200407",diskType:"projects/".concat("spiral-app","/zones/").concat(L,"-a/diskTypes/pd-ssd"),diskSizeGb:"10"},diskEncryptionKey:{}}],canIpForward:!1,description:"",labels:{},scheduling:{preemptible:!1,onHostMaintenance:"MIGRATE",automaticRestart:!0,nodeAffinities:[]},deletionProtection:!1,reservationAffinity:{consumeReservationType:"ANY_RESERVATION"},shieldedInstanceConfig:{enableSecureBoot:!1,enableVtpm:!0,enableIntegrityMonitoring:!0}});case 3:return t=e.sent,e.next=6,ie(t);case 6:return console.log("Created Disk Source"),console.log("Stopping Disc Source"),e.next=10,K("https://compute.googleapis.com/compute/v1/projects/".concat("spiral-app","/zones/").concat(L,"-a/instances/").concat("triframe-base","/stop"));case 10:return n=e.sent,e.next=13,ie(n);case 13:console.log("Stopped Disc Source");case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),se=function(){var e=c()(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V("https://compute.googleapis.com/compute/v1/projects/".concat("spiral-app","/zones/").concat(L,"-a/instances/").concat("triframe-base"));case 2:return t=e.sent,e.next=5,ie(t);case 5:console.log("Destroyed Disk Source");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ie=function(e){return new Promise((function(t){var n=function(){var r=c()(o.a.mark((function r(){var a;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,K("".concat(e.selfLink,"/wait"));case 2:if("DONE"!==(a=r.sent).status){r.next=7;break}t(a),r.next=10;break;case 7:return r.next=9,ue(5e3);case 9:n();case 10:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();n()}))},ue=function(e){return new Promise((function(t){return setTimeout(t,e)}))},pe=function(){var e=c()(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le();case 2:if(t=e.sent,!(n=t.token)){e.next=8;break}return e.abrupt("return",n);case 8:return e.abrupt("return",new Promise((function(e){var t=M();t.use(R.urlencoded({extended:!1})),t.use(R.json()),t.get("/token",function(){var e=c()(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.send("\n                <html>\n                    <h1>Authentication Received</h1>\n                    <h3>Return to your terminal to complete the deployment process...</h3>\n                    <script>\n                        var fragmentString = location.hash.substring(1);\n                        var params = {};\n                        var regex = /([^&=]+)=([^&]*)/g, m;\n                        while (m = regex.exec(fragmentString)) {\n                            params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);\n                        }\n                        fetch(`http://localhost:".concat(5e3,"/save-token/${params['access_token']}`)\n                    <\/script>\n                </html>\n            "));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),t.get("/save-token/:token",(function(t,r){var o=t.params.token;fe({token:o}),e(o),r.json({ok:!0}),n.close()}));var n=t.listen(5e3),r=encodeURIComponent("http://localhost:".concat(5e3,"/token")),a=encodeURIComponent("https://www.googleapis.com/auth/cloud-platform");N("https://accounts.google.com/o/oauth2/v2/auth?scope=".concat(a,"&response_type=token&redirect_uri=").concat(r,"&client_id=").concat("1009774431187-m11c1cekqfsnt48pb7cl25d13kq15sj3.apps.googleusercontent.com"))})));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),le=function(){var e=c()(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,S.readFile(_.resolve(".triframe"));case 3:return t=e.sent,e.abrupt("return",JSON.parse(t));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),fe=function(){var e=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=T,e.t1={},e.next=4,le();case 4:return e.t2=e.sent,e.t3={},e.t4=t,t=(0,e.t0)(e.t1,e.t2,e.t3,e.t4),e.abrupt("return",S.writeFile(_.resolve(".triframe"),JSON.stringify(t)));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),me="\n    curl -sL https://deb.nodesource.com/setup_13.x | sudo -E bash -\n    sudo apt-get install -y nodejs\n",de=function(e,t){return'\nsleep 60\ncd home/isaacsmiles\napt-get update\napt-get install authbind\nchmod 500 /etc/authbind/byport/80\ntouch /etc/authbind/byport/80\nchown isaacsmiles /etc/authbind/byport/80\ntouch /etc/authbind/byport/443\nchmod 500 /etc/authbind/byport/443\nchown isaacsmiles /etc/authbind/byport/443\nwget https://dl.google.com/cloudsql/cloud_sql_proxy.linux.amd64 -O cloud_sql_proxy\nchmod +x cloud_sql_proxy\nprintf \'{"type":"service_account","project_id":"spiral-app","private_key_id":"cdf0aabc6ca6d16ee324a02b2fc980f1b66c613e","private_key":"-----BEGIN PRIVATE KEY-----\\\\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDnMN/ljTK6I9LJ\\\\nS3TSuCQkMU23m3aEuC1n3GDsxjCLC2RkUI3tZytFhjK1N2SMO7tMUfCobDnzDoYj\\\\nEAz5dfAbERPDJkGIhkabfElez758KvG0nfusT0zvb5bn4TsBkj+tAC+ZEf/S5KQ5\\\\niUT0kg8M2arczPLvlBFkWLJGsgRIUimvlzLij9BydZSPaQrVMkhrmbLOOkm6Ockn\\\\nFPmF31KM/2iuzYco+YZLd3NREKVqZtu59cPCJ95RNSfSDoAhvTLYSTx5LcGgn+1N\\\\nZFfYuD7dGq38ifM4HOVfksuBbvfnisewih2EVPm+E25a8XjPAmrfDbXBU1ivMUYY\\\\nIC+TslLVAgMBAAECggEACZYEnDXX/GqpCwDejcoy1wlWtp4MmQFmAi0O6JWcxHcr\\\\nD3nDmMXMjOwJxQSdKuKWW1pebZPA1CvHzHZi6bxF9QLzqQWe3AFTtii+H6wV5hVS\\\\nj/GpBZw4JwlsEWtMxHDpXcwCYG9w0xbF56WiC7eh37khLr/H8768LEcwa5WZoqhc\\\\ngjYwcBk4Z8UQvBJPiSbngin0I4Fo44m//VGOg7nlHQAIfDnfOWdzXBFMPYhoUDPu\\\\nujOtButAZ/5VC7cOd3EH/3wyY/zbRTrmZxikZc2kDgePgERiRtYw8FtNQvjN9gcU\\\\niuajcU47B2nBXxlvw/DCPi0yxSiTUBhrtKxSrjrxgQKBgQD4g4ixHKq08DWAc4xz\\\\nTAkNOlKF6gB8daxg3yZDIr7WvRHsR19e54du3Q/EvPqMVyT1mqhtGz9MzgyUz2qq\\\\nJQy5xMHJp2X4PxEsm5n6cm3tpxySMeHzLQHaWjdKAwR4zzlLKMWXF48KN1HuHt79\\\\nJvOWn6sbtaFXvf0ze/JrNCFHNQKBgQDuJ8BncXESS9RLi+1I7EhaDGsKPIDVwFtC\\\\nC4gUV5hP5whO6jt4ATUy92pPQZfzEiQ2Erc01Pf4EAYNiErPtB8Rron3VV2Dz1md\\\\n0bQt88lhDM22EESKfTQfmc5ctUuQoii8KPV2Psr9yQq4eLQZg1fI/IgQUW7YgGfG\\\\nFfLt54sxIQKBgDzQw5TENSpOVml23Xohs11fVm6bEz9h9KtIMK7hQ959KnOuC7LH\\\\n6ibBRmiY7p+Fe+/2xxzcPCNpkT6he7Ljmjej5OCabKPRmzxVX9sgQbKU4LMOLgM6\\\\nkmeDCGC+WEvQOm8gLSqKg2C2pQAm4d8Ftzq3HEKNskwsnFgLDwoZGcO5AoGBAJ06\\\\na0Ef2NmObHrvx1kkfWPN3QEmDpyP4O/Kcy2S4wClc4u+AkLo8TlTtMDcejfEm1mD\\\\no6Zij88arRRUDafwr65Zv8Ylepah1vVlVAIed6316P2w4b9Yh4fxYBc+rcOv+xq2\\\\nI8/MBvHjv4soTSam2tbbOe0kBf0zUM+q//XmrrNhAoGBAPUHOWG74oZcmF3AcyOG\\\\n31G7X7gPY7Q4LecIY8czDWcVoK9CHUa/C9dBi2izC9IyTNEV+ETVdplFrANSwj1w\\\\nsnmF7ayj4nEW7ZsNPvizUr1DB1qkzPn8LwMJKIpkXW3nR41nhPMLUvwdeAP3nWJP\\\\n7YydmTUbHLNjSmiNQ6jOutOV\\\\n-----END PRIVATE KEY-----\\\\n","client_email":"1067453211142-compute@developer.gserviceaccount.com","client_id":"113525226759410066844","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url":"https://www.googleapis.com/robot/v1/metadata/x509/1067453211142-compute%40developer.gserviceaccount.com"}\' > keyfile.json\n./cloud_sql_proxy -instances=spiral-app:us-central1:spiral-db=tcp:5432 -credential_file=./keyfile.json &\ncurl -L -u \''.concat("joshua-miles",":").concat("65dd359783bf161f13d1ec31c515b0e92e9369cc","' '").concat(e,"' | tar xzf - --one-top-level=\"").concat("spiral",'" --strip-components 1\ncd ').concat("spiral","\nmkdir ./.storage\nGOOGLE_APPLICATION_CREDENTIALS=~/keyfile.json gcsfuse ").concat(t,' ./.storage\nnpm install --only=production\nexport DB_HOST="127.0.0.1"\nexport DB_PORT="5432"\nexport DB_NAME="postgres"\nexport DB_USER="postgres"\nexport DB_PASSWORD="myNaAdJkJ1eF44Fz"\nexport BACKEND_PORT=80\nnpm run production\n')},ge=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length,r=0;r<12;r++)e+=t.charAt(Math.floor(Math.random()*n));return e},he=n(18);he.command("deploy <name>").action(q),he.command("new <name>").action((function(e){return m.apply(this,arguments)})),he.command("build type [args...]").action((function(e){var t,n=v()(e),r=n[0],o=n.slice(1);switch(r){case"model":var a={},c=v()(o),s=c[0],i=c[1],u=(h=c.slice(2)).reduce((function(e,t,n){if(t.includes("=")){var r=t.split("="),o=g()(r,2),c=o[0],s=o[1],i=void 0===s?"":s;e="".concat(e,"\n  ").concat(c," = ").concat(i,"\n")}else{var u=t;a[u.split("(")]=!0,e=" ".concat(e,"\n  @").concat(u)}return e}),""),p="import { Resource } from 'triframe/arbiter'\nimport { Model, include, ".concat(Object.keys(a).join(", ")," } from 'triframe/scribe'\nexport class ").concat(i," extends Resource {\n  @include(Model)\n").concat(u,"\n}");b.writeFile("./".concat(s,".js"),p);break;case"form":var l={},f="",m=v()(o),d=(s=m[0],m[1]),h=m.slice(2),x=d;if(d.includes(":")){var y=d.split(":"),k=g()(y,2);x=k[0],d=k[1]}var j=x.toLowerCase(),E=h.reduce((function(e,t,n){var r="TextInput",o=t.split("="),a=g()(o,2),c=a[0],s=a[1],i=void 0===s?"":s;if(c.includes(":")){var u=c.split(":"),p=g()(u,2);r=p[0],c=p[1]}(Number.isNaN(i)||""===i)&&(i='"'.concat(i,'"')),l[r]=!0;var m=w(c);return f="".concat(f,"\n        ").concat(c,": ").concat(i,","),e="".concat(e,"\n            <").concat(r,'\n                label="').concat(m,'"\n                value={').concat(j,".").concat(c,"}\n                onChange={").concat(c," => {\n                    hideErrorsFor('").concat(c,"')\n                    ").concat(j,".").concat(c," = ").concat(c," \n                }}\n            />\n            <HelperText visible={shouldShowErrorsFor('").concat(c,"')} type=\"error\">\n                {errorMessageFor('").concat(c,"')}\n            </HelperText>")}),"");p="import React from 'react'\nimport { tether, Container, Title, Button, HelperText, ".concat(Object.keys(l).join(", ")," } from 'triframe/designer'\n\nexport const ").concat((t=d,function(e,t){for(var n=(e=e.toLowerCase()).split(/[\s_]+/g),r=!0===t?0:1,o=n.length;r<o;++r){var a=n[r];n[r]=a.charAt(0).toUpperCase()+a.substr(1)}return n.join("")}(t,!0))," = tether(function*({  models }) {\n\n    const { ").concat(x," } = models\n\n    const global = yield { errorMessage: '' }\n\n    const ").concat(j," = yield new ").concat(x,"({").concat(f,"\n    })\n    \n    const { errorMessageFor, shouldShowErrorsFor, hideErrorsFor, showAllErrors, isValid } = ").concat(j,".validation\n\n    const handleSubmit = () => {\n        if(isValid){\n            try {\n                console.log('Submitted', ").concat(j,")\n            } catch (err){\n                global.errorMessage = err.message\n            }\n        } else {\n            showAllErrors()\n        }\n    }\n\n    return (\n        <Container>\n            <Title>").concat(w(d),'</Title>\n            <HelperText visible={global.errorMessage.length > 0} type="error">\n                {global.errorMessage}\n            </HelperText>').concat(E,"\n            <Button onPress={handleSubmit}>\n                Submit\n            </Button>\n        </Container>\n    )\n})");b.writeFile("./".concat(s,".js"),p);break;case"view":var T=g()(o,2);s=T[0],d=T[1],p="import React from 'react'\nimport { tether, Container, Title } from 'triframe/designer'\nconst ".concat(d," = tether(function*({  models, props, use, useContext, useHistory, redirect  }) {\nreturn (\n    <Container>\n        <Title>").concat(d,"</Title>\n    </Container>\n)\n})\nexport { ").concat(d," }");b.writeFile("./".concat(s,".js"),p)}})),he.parse(process.argv)}]);